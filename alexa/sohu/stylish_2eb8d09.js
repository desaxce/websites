
define('gdt:mod/stylish.js',function(require,exports,module){var commMod=require('gdt:comm/comm.js'),PageClickManage=require('gdt:comm/clickmanage.js');var Util=commMod.Util,Helper=commMod.Helper;var J=require('jquery');var tpl,conf;var setConf=function(config){tpl=config.tpl;conf=config;};var getOuterConf=function(){var outerConf;try{outerConf=parent.conf;}catch(e){}
outerConf&&J.extend(conf,outerConf);};var render=function(o,posId){var data=o.data,len,pollconf=conf.pollconf;len=data.length;conf.pagestyle&&J.insertCSSLink(conf.pagestyle);conf.cssText&&J.insertStyleSheet(null,conf.cssText);pollconf&&pollconf.perpage&&(pollconf.actualPages=Math.ceil(len/pollconf.perpage));o.pageconf=conf;J(Util.tmpl(conf.tpl,o)).appendTo(J(document.body));if(conf.needPoll){var polltime=pollconf.polltime;var poller=Helper.poller({polltime:polltime,pollcount:pollconf.actualPages,container:conf.container||'container',pollobjcn:pollconf.pollobjcn||'__js_crtcnt',numcn:'__js_numlist',hightlightcn:pollconf.hightlightcn||'on',numtag:pollconf.numtag||'li',onflip:function(num,pollopts){require.async('gdt:comm/manage.js',function(Manage){Manage.updateFrameTime();});Helper.ping(num,pollopts);},data:{posId:posId,list:data,perpage:pollconf.perpage},direction:pollconf.direction});}
if(conf.needSaleInfo){require.async('gdt:mod/sales.js',function(dealer){dealer.dealsales(o.data,{container:'container',salenumcnt:'__salenumcnt',salenum:'__salenum',price:'__saleprice'});});}
if(conf.extradata){loadExtraData(conf.extradata);}};var trimDefault=function(list){J.each(list,function(k,odata){(!odata.olink)&&(odata.olink='href="'+odata.rl+'" target="_blank"');(!odata.cl)&&(odata.cl=k++);});};var addAndRender=function(defconf,data,deflist,renderer){data=data||[];var len=data.length,remain,remainlist=[];deflist=deflist||[];remain=defconf.pageadcount-len;remainlist=deflist.slice(0,remain);data=data.concat(remainlist);renderer(data);};var defaultAdsMap={};var loadPaipaiData=function(url,callback){var filename=url.split("\/").pop();var cbname=filename.slice(0,-3).split(".").pop()+"Callback";var mat=filename.match(/\d{2,}/);var cbnamealter="";mat&&(cbnamealter="showPageData"+mat[0]);if(defaultAdsMap[cbname+"_data"]){callback(defaultAdsMap[cbname+"_data"]);}else if(defaultAdsMap[cbname]){defaultAdsMap[cbname]=defaultAdsMap[cbname]||[];defaultAdsMap[cbname].push(function(def){callback(def);});}else{defaultAdsMap[cbname]=[];window[cbname]=function(def){callback(def);defaultAdsMap[cbname+"_data"]=def;var fn;while(fn=defaultAdsMap[cbname].shift()){fn(def);}};cbnamealter&&(window[cbnamealter]=window[cbname]);GDT.importJs(url,function(def){},"GB2312");}};var loadDef=function(defconf,data,renderer){if(defconf.gDefaultAds){loadPaipaiData(defconf.gDefaultAds,function(def){(typeof def=="undefined")&&(def=[]);def.pageId&&def.data&&(def=def.data);def&&def.pop&&!def[def.length-1]&&def.pop();trimDefault(def);addAndRender(defconf,data,def,renderer);});}
defconf.modDefaultAds&&require.async(conf.modDefaultAds,function(def){addAndRender(defconf,data,def.list,renderer);});};var prepareAndRender=function(o,posId){PageClickManage.init();render(o,posId);}
var loadPoses=function(posId){var cPosList=conf.cPosList,_readycount=0,_ready={},poslist=[posId],poscount,subconf=conf.subposconf;poslist=poslist.concat(cPosList);poscount=poslist.length;var _trimdata=function(o,index){_ready[index]=o;_readycount++;if(poscount==_readycount){var data=[];J.each(new Array(conf.pollconf.pollnum),function(curpage){J.each(poslist,function(k1,cPosId){var sub=subconf[k1].perpage,sublist=[];sublist=_ready[k1].data.slice(curpage*sub,(curpage+1)*sub);J.each(sublist,function(k,v){v.posId=cPosId;});data=data.concat(sublist);});});sMod.prepareAndRender({data:data},posId);}};var dealcb=function(o,index){var len=o&&o.data&&o.data.length||0,csubposConf=subconf[index];if(len<csubposConf.count){sMod.loadDef({gDefaultAds:csubposConf.defaultAds,pageadcount:csubposConf.count},o.data,function(fdata){_trimdata({data:fdata},index);});}else{_trimdata(o,index);}};var req=[];J.each(poslist,function(k,posId){req.push({posId:posId,count:subconf[k].count,onComplete:function(o){dealcb(o,k);}});});GDT.load(req);}
var load=function(posId){getOuterConf();if(!conf.loadPoses){GDT.load({posId:posId,count:conf.pageadcount,onComplete:function(o){var data=[],cfg;if(o&&o.ret){data=o.data;}
cfg=o.cfg;var _render=function(data){J.each(data,function(k,v){v.posId=posId;});prepareAndRender({data:data,cfg:cfg},posId);};if(data.length<conf.pageadcount){loadDef({gDefaultAds:conf.gDefaultAds,modDefaultAds:conf.modDefaultAds,pageadcount:conf.pageadcount},data,_render);}else{_render(data);}}});}else{loadPoses(posId);}};var loadExtraData=function(extra){extra=extra||[];J.each(extra,function(k,v){var cnt=J(v.cntpath),tplobj;tplobj=cnt.find(v.tplpath);tplobj.hide();loadPaipaiData(v.url,function(o){var list=o&&o.data;if(list&&list.length>0){J.each(list,function(vk,dv){if(v.type=='txtlink'&&(vk<v.count)){var cobj=tplobj.clone();cobj.attr('href',dv.rl).html(dv.txt).show().appendTo(cnt);}});}});});};var sMod={load:load,setConf:setConf,loadDef:loadDef,addAndRender:addAndRender,render:render,prepareAndRender:prepareAndRender};module.exports=sMod;});