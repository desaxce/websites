KISSY.add("mui/brandbar",function(a,r,e){var t={show:function(t){t=t||{};var n=this,o=n.domEl;if(!o){r.addStyleSheet("#J_BrandBar{font-size:12px;cursor:pointer;background-color:#EEEEEE;width:120px;margin:2px 5px 0 5px;height:28px;border:solid 1px #d0d0d0;-moz-border-radius: 3px 3px 0px 0px;-khtml-border-radius: 3px 3px 0px 0px;-webkit-border-radius: 3px 3px 0px 0px;border-radius: 3px 3px 0px 0px;}"+"#J_BrandBar:hover,#J_BrandBar.hoverBrandBar{background-color:#d9d1d1;border-color:#bcb0b0}"+'.BrandFlyer{width:20px;height:20px;float:left;margin:4px 0px 4px 12px;background:url(http://img02.taobaocdn.com/tps/i2/T1KMGHXC4dXXcu5FDa-20-20.png);background-repeat:no-repeat;*background:none;*filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src="http://img02.taobaocdn.com/tps/i2/T1KMGHXC4dXXcu5FDa-20-20.png");zoom:1;}'+'.BrandPopup{cursor:pointer;background:url(http://img01.taobaocdn.com/tps/i1/T1wW9HXAdfXXcH0rHA-152-131.png);background-repeat:no-repeat;*background:none;*filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src="http://img01.taobaocdn.com/tps/i1/T1wW9HXAdfXXcH0rHA-152-131.png");background-size:100% 100%;}'+"#J_BrandBar a,#J_BrandBar a:hover{line-height:20px;display:block;margin:4px 4px 4px 0;float:left;color:#181818;text-decoration:none;}");o=n.domEl=r.create('<div id="J_BrandBar" order="20">');var d=t.urlMyBrand||"http://mybrand.tmall.com/";r.html(o,'<div class="BrandFlyer"></div><a href="'+d+'" target="'+(t.newWindow?' target="_blank"':"")+'">\u6211\u5173\u6ce8\u7684\u54c1\u724c</a>');e.on(o,"click",function(a){if(a.target.nodeName!="A"){var e=r.get("a",o);if(e.click){e.click()}else if(document.createEvent){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);e.dispatchEvent(t)}}else{(new Image).src="http://log.mmstat.com/tmallbrand.1001.1.2.3"}});if(a.UA.ie==6){e.on(o,"mouseenter",function(){r.addClass(o,"hoverBrandBar")});e.on(o,"mouseleave",function(){r.removeClass(o,"hoverBrandBar")})}}a.use("mui/bottombar",function(a,e){e=e||a["mui/bottombar"];r.append(r.create("<div>",{css:{width:"23px",height:"13px",left:"87px",top:"-6px",position:"absolute",background:"url(http://img03.taobaocdn.com/tps/i3/T1Zs7TXiNcXXbmSHkB-191-207.png) no-repeat",backgroundPosition:"-158px -75px"}}),o);e.add(o)})},setClass:function(a,e){if(!r.hasClass(a,"ui-brand-btn")){return}e=e===undefined?a._hover:e;var t=r.hasClass(a,"ui-brand-collected")?e?"\u53d6\u6d88":"\u5df2\u5173\u6ce8":r.hasClass(a,"ui-brand-btn-ex-s")&&r.hasClass(a,"ui-brand-btn-ex-bubble")?"\u5173\u6ce8\u54c1\u724c":"\u5173\u6ce8";r.text(r.get("span",a),t)},bindEl:function(t,n){n=n||{};var o=this,d=n.attrName||"data-brandid";var i=e.delegate||function(t,n,o,d,i){e.on(t,n,function(e){var n=false;a.each(r.query(o,t),function(a){if(!n&&(a==e.target||r.contains(a,e.target))){n=true}});if(!n){return}d&&d.apply(this,arguments)},i)};i(document,"click",t,function(a){a.preventDefault();if(a.brandCooked){return}a.brandCooked=true;var e=a.target;while(e&&!(brandId=r.attr(e,d))){e=r.parent(e)}if(!e){return}o.flyAdd(e,brandId,n)});var s=[];a.each(r.query(t),function(a){var t=r.attr(a,d);if(t&&r.hasClass(a,"ui-brand-btn")){s.push(t);e.on(a,"mouseenter",function(){o.setClass(a,a._hover=true)});e.on(a,"mouseleave",function(){o.setClass(a,a._hover=false)})}});if(s[0]){a.use("mui/wishlist",function(a,e){e.queryBrand({ids:s},function(e){a.each(r.query(".j_CollectBrandNum"),function(t){var n=r.attr(t,d);a.each(e.result,function(a){if(a.brandId==n){r.text(t,a.popularity)}})});a.each(r.query(t),function(t){var n=r.attr(t,d);a.each(e.result,function(a){if(a.brandId==n&&a.isMyBrand&&r.hasClass(t,"ui-brand-btn")){r.addClass(t,"ui-brand-collected");o.setClass(t,false)}})})})})}},flyAdd:function(r,e,t){var n=this;a.use("mui/brandbar/fly",function(a,o){a.mix(n,o);n.flyAdd(r,e,t)})}};a.mix(t,a.EventTarget);return t},{requires:["dom","event"]});KISSY.add("mui/mallbar",function(a,t,e,i,r,n,l,o,s,m,b,c,u,d,f,p,g){var h=window.location.href.indexOf("mbar-mock-bubble=1")>-1;var _=['<div class="mui-mbar-plugin {5} mui-mbar-plugin-{0}">','<div class="mui-mbar-plugin-hd">','<a target="{3}" href="{2}" target="_blank" class="mui-mbar-plugin-hd-title {4}">{1}</a>',' <div class="mui-mbar-plugin-hd-tip"></div>',' <div class="mui-mbar-plugin-cover"></div>','<div class="mui-mbar-plugin-hd-close mui-mbar-iconfont">&#xe61b;</div>',"</div>",'<div class="mui-mbar-plugin-bd"><div class="mui-mbar-plugin-load"></div></div>',"</div>"].join("");var v=['<div class="mui-mbar-tab mui-mbar-tab-{2} {4}" style="top:{1}px;">','<div class="mui-mbar-tab-logo mui-mbar-tab-logo-{2}">{7}</div>','<div class="mui-mbar-tab-txt">{3}</div>','<div class="mui-mbar-tab-new" style="display:{5};"></div>','<div class="mui-mbar-tab-sup"></div>','<div class="mui-mbar-tab-tip">{0}<div class="mui-mbar-arr mui-mbar-tab-tip-arr">\u25c6</div></div>','<div class="mui-mbar-arr mui-mbar-tab-logo-arr {8}">\u25c6</div>',"</div>"].join("");var T=['<div class="mui-mbar-tab-sup-bg">','<div class="mui-mbar-tab-sup-bd">{0}</div>',"</div>"].join("");var A=['<div class="mui-mbar-tab-bubble mui-mbar-tab-bubble-{0}"><div class="mui-mbar-tab-bubble-bd"></div></div>'].join("");var E=['<div class="mui-mbar-mini">','  <div class="mui-mbar-mini-avatar-def"></div>','  <div class="mui-mbar-mini-mask"></div>','  <div class="mui-mbar-tab-sup"></div>',"</div>",'<div class="mui-mbar-mini-logo"></div>'].join("");var I=[];var C=true;var B=false;var O=function(t){var e=parseFloat(a.version);d.log("Kissy \u7248\u672c\u68c0\u6d4b\uff1a",a.version,e);if(e<1.3){return}var i=this;t=t||{};t.shopConfig=t.shopConfig||window.shop_config;t.gConfig=window.g_config;var r=a.one(document.body)||document.getElementsByTagName("body");if(r&&r.length>0){r=a.one(r[0])}t.container=t.container?a.one(t.container):r;if(!t.container){d.log(u.M.B);return}O.superclass.constructor.call(i,t);i.init()};O.ATTRS={oldIndex:{value:-1}};a.extend(O,t,{init:function(){var t=this;var e=a.all(d.fm('<div id="J_MUIMallbar" class="mui-mbar-outer j_Mallbar_{0}"><div class="mui-mbar"></div></div>',u.VER)).appendTo(t.get(u.K.CONTAINER));t.set(u.K.ROOT,a.one(".mui-mbar"));t.set(u.K.ROOT_OUTER,e);t.set(u.K.ITEMS,{});var i=new f;t.set(u.K.MODEL,i);i.on(u.E.AFTER_BAR_CHANGE,function(e){d.log(e.type);function i(){a.use("mui/mallbar/guide",function(a,e){new e({isMask:false,callback:function(){t.initBar()}})});setTimeout(function(){if(a.one(".mui-mbar-guide")){a.one(".mui-mbar-guide").remove();t.initBar()}},12*1e3)}d.getStaticConf({cb:function(a){d.log("getStaticConf",a);if(a.topAddHeight){t.set("topAddHeight",a.topAddHeight)}if(a.notWideTab){t.set("notWideTab",a.notWideTab)}var e="";!!window.g_config&&(e=window.g_config.shopId||"");if(a.bubbleBlacklist&&a.bubbleBlacklist.length){var r=a.bubbleBlacklist.length;var n=a.bubbleBlacklist;for(var l=0;l<r;l++){if(e==n[l]){t.set("notWideTab",1)}}}if(a.showCartGuide){if(window.localStorage){g.get({k:u.K.FRM_CART,success:function(a){if(a){t.initBar()}else{g.set({k:u.K.FRM_CART,v:true});i()}}})}else{if(s.get("_mbg")){t.initBar()}else{s.set("_mbg","1",60,u.DEBUG?"tmall.net":"tmall.com","/");i()}}}else{t.initBar()}}})});i.getBar({shopId:t.get(u.K.SHOP_CONFIG)?"1":"",gConfig:t.get(u.K.G_CONFIG),mallbar:t});d.getStaticConf({cb:function(a){var e=a.firstBubbleWaitTime||3;setTimeout(function(){d.log("::mallbar.js::\u9996\u6b21\u6c14\u6ce1\u5df2\u7ecf\u6536\u96c6\u5b8c\u6210");t.firstBubble()},e*1e3)}})},initBar:function(){var t=this;if(t.get(u.K.INITED)){return}t.set(u.K.INITED,true);var e=t.get(u.K.MODEL).get(u.K.BAR);var i=t.get(u.K.ROOT);var l=t.get(u.K.ROOT_OUTER);var o=t.get(u.K.MODEL);var s=o.get(u.K.USERINFO);var m=t.get(u.K.ITEMS);var b,c,f;d.log("::after bucket::",e.l);var g=[];g.push('<div class="mui-mbar-plugins">');for(b=0,c=e.l.length;b<c;++b){f=e.l[b];var h=f.u.indexOf("http")===0;g.push(d.fm(_,f.id,f.n,f.u,h?"_blank":"_self",h?"":"mui-mbar-plugin-hd-title-txt",f.tms?"mui-mbar-plugin-tms":""))}g.push("</div>");var T="mui-mbar-tabs-narrow";g.push('<div class="mui-mbar-tabs  '+T+'">');for(b=0,c=e.l.length;b<c;++b){f=e.l[b];g.push(d.fm(A,f.id))}g.push('<div class="mui-mbar-tabs-mask">');g.push('<div class="mui-mbar-tabs-top-wide"><div class="mui-mbar-tab-top-left"></div></div>');for(b=0,c=e.l.length;b<c;++b){f=e.l[b];var I="";if(f.id=="nav"){I='<div class="mui-mbar-tab-logo-nav-top"></div>'}var C="";if(f.specail){C="mui-mbar-tab-logo-arr-show"}g.push(d.fm(v,f.n,0,f.id,f.nick,f.custom?"mui-mbar-tab-custom":"",f.isNew?"block":"none",f.text?f.text:"",I,C))}g.push("</div>");g.push("</div>");g.push(E);i.html(g.join(""));var O=a.one(window);var S=i.one(".mui-mbar-mini");var L=i.one(".mui-mbar-mini-logo");var N=i.one(".mui-mbar-tabs");var R=i.one(".mui-mbar-tabs-mask");var U=i.one(".mui-mbar-plugins");var M=N.all(".mui-mbar-tab");var P;var w;for(b=0,c=M.length;b<c;++b){var D=a.one(M[b]);var F=e.l[b];m[F.id]=new p({mallbar:t,index:b,data:F,tab:D,bubble:i.one(".mui-mbar-tab-bubble-"+F.id),plugin:U.one(".mui-mbar-plugin-"+F.id)});if(u.P.CART===F.id){P=m[F.id].get(u.K.TAB)}if(u.P.TOP===F.id){w=m[F.id].get(u.K.TAB)}if(n.ie&&n.ie===6&&F.ie6Tab){D.one(".mui-mbar-tab-logo").css({backgroundImage:d.fm("url({0})",F.ie6Tab)})}}function y(){a.each(m,function(a){a.fire(u.E.VISIBILITY_CHANGE,{visible:false})})}t.on(u.E.STATUS_CHANGE,function(e){d.log("::status change::",e.status);var n=e.status;if(t.get(u.K.STATUS)===n){return}var l=t.get(u.K.STATUS);t.set(u.K.STATUS,n);switch(n){case u.S.MINI:{i.removeClass("mui-mbar-status-standard");i.removeClass("mui-mbar-status-expand");i.addClass("mui-mbar-status-mini");r(i,{right:-i.width()+"px"},.2,u.EASE).run();P&&r(P,{left:"-35px"},.2,u.EASE).run();r(w,{left:"-35px"},.2,u.EASE).run();t.fire(u.E.SUPTIP_CHANGE);y();L.css("visibility","hidden");u.S.STANDARD===l&&d.sendLog(u.ARR.S21)}break;case u.S.STANDARD:{i.addClass("mui-mbar-status-standard");i.removeClass("mui-mbar-status-expand");i.removeClass("mui-mbar-status-mini");r(i,{right:-i.width()+N.width()+"px"},.2,u.EASE).run();P&&r(P,{left:"0px"},.2,u.EASE).run();r(w,{left:"0px"},.2,u.EASE).run();L.css("visibility","hidden");y();u.S.MINI===l&&d.sendLog(u.ARR.S12);u.S.EXPAND===l&&d.sendLog(u.ARR.S32)}break;case u.S.EXPAND:{i.removeClass("mui-mbar-status-standard");i.removeClass("mui-mbar-status-mini");i.addClass("mui-mbar-status-expand");r(i,{right:"0px"},.31,u.EASE).run();P&&r(P,{left:"0px"},.31,u.EASE).run();r(w,{left:"0px"},.31,u.EASE).run();L.css("visibility","visible");B=true}break}t.broadcast(u.E.MALLBAR_STATUS_CHANGE,{status:n});if(!e.noToClose){var o=t.get(u.K.ITEMS);if(o){a.each(o,function(a){var t=a.get(u.K.BUBBLE);!!t&&t.hide()})}}});t.on(u.E.SUPTIP_CHANGE,function(a){});var G=function(a){var e=t.get(u.K.STATUS);var i;switch(e){case u.S.MINI:{i=u.S.STANDARD;d.sendLog(u.ARR.S12_ACTIVE)}break;case u.S.STANDARD:{i=u.S.MINI;d.sendLog(u.ARR.S21_ACTIVE)}break;case u.S.EXPAND:{if(!t.isMiniWidth()){i=u.S.STANDARD;d.sendLog(u.ARR.S32_ACTIVE)}else{i=u.S.MINI;d.sendLog(u.ARR.S31_ACTIVE)}}break}t.fire(u.E.STATUS_CHANGE,{status:i})};L.on("click",G);t.on(u.E.PAGE_VISIBILITY_CHANGE,function(t){if(!t.pageVisible||!s.isLogin){return}if(u.S.BAR_NO_MSG===e.s){return}if(u.SAMPLING<Math.random()){return}var i=[];a.each(m,function(a,t){i.push(t)});d.getStaticConf({cb:function(t){if(!t.notGetMessageWarn){d.ajax({url:d.fm(u.URL.GET_MSG),jsonpCallback:"__mallbarGetMessageWarn",data:{id:i.join(",")},success:function(t){if(!t){return}var e=t.s;if(e===u.S.BAR_SUCCESS||e===u.S.BAR_NOT_LOGIN||e===u.S.BAR_NO_MSG){a.each(t.q,function(a){var t=m[a.id];if(t){t.fire(u.E.SUPTIP_CHANGE,{show:a.m>0})}})}}})}}})});if(n.ie&&n.ie<7){O.on("scroll",function(){l.css("top",O.scrollTop()+"px")});l.css("top",O.scrollTop()+"px")}i.on("click",function(a){a.stopPropagation()});var K=a.one(document);K.on("click",function(a){d.log("document click");if(u.S.EXPAND===t.get(u.K.STATUS)){t.fire(u.E.STATUS_CHANGE,{status:t.isMiniWidth()?u.S.MINI:u.S.STANDARD})}});var X=0;var x=t.get(u.K.G_CONFIG);K.on("mousemove",a.buffer(function(e){if(!t.isMiniWidth()&&!x.forceMallBarMini){return}var i=a.DOM.viewportWidth()-e.pageX+K.scrollLeft();var r=t.get(u.K.STATUS);var n=i<=u.MINI_HIT_WIDTH;if(n&&u.S.MINI===r){d.sendLog(u.ARR.S12_USER_TRIGGER);t.fire(u.E.STATUS_CHANGE,{status:u.S.STANDARD})}X=n},300));i.on("mouseleave",a.buffer(function(){if(!t.isMiniWidth()&&!x.forceMallBarMini){return}var a=t.get(u.K.STATUS);if(u.S.STANDARD===a){t.fire(u.E.STATUS_CHANGE,{status:u.S.MINI})}}));O.on("focus",a.buffer(function(a){t.broadcast(u.E.PAGE_VISIBILITY_CHANGE,{pageVisible:true})},u.COMMON_DELAY,t));O.on("blur",a.buffer(function(a){t.broadcast(u.E.PAGE_VISIBILITY_CHANGE,{pageVisible:false})},u.COMMON_DELAY,t));var k=false;var H=true;function V(){d.log("onresize");var r=a.DOM.viewportWidth();var n=a.DOM.viewportHeight();l.height(n);i.height(n);N.height(n);R.height(n);U.height(n);a.each(U.all(".mui-mbar-plugin"),function(t){t=a.one(t);t.height(n);var e=t.one(".mui-mbar-plugin-hd");var i=t.one(".mui-mbar-plugin-bd");i.height(n-e.height())});var o=0;a.each(e.l,function(a,t){if(!a.custom&&!a.bottom&&a.on&&!a.defaultHide){var e=m[a.id].get(u.K.TAB);o+=e.height()+(a.margin*2||0)}});var s=0;if(a.one(".mui-mbar-tabs-narrow")){s=t.get("topAddHeight")||50}var p=(n-o)/2+s;var g=p;var h=0;var _=0;for(b=0,c=e.l.length;b<c;++b){f=e.l[b];var v=m[f.id];var T=v.get(u.K.TAB);var A=f.margin||0;if(f.custom){g-=A;g-=T.height();T.css("position","absolute");T.css("top",g+"px");if(f.id=="nav"&&g>0){var E=a.one(".mui-mbar-tabs-narrow")||"";if(E){var I=E.one(".mui-mbar-tab-logo-nav-top");t.set("offsetYCustom",g);if(I){I.css("height",g+"px");I.css("top",-g+"px")}}}}else if(f.bottom){h+=A;T.removeAttr("style");T.css("bottom",h+"px");T.css("position","absolute");h+=T.height()}else{if(f.id=="prof"){if(p<35){p=35}T.css("margin",p+"px 0 "+_+"px")}else{T.css("margin",A+"px 0")}}v.resetBubble()}t.set("baseY",p);function C(){a.one(".mui-mbar").one(".mui-mbar-tabs").removeClass("mui-mbar-tabs-wide");var e=t.get("offsetYCustom")||0;var i=a.one(".mui-mbar-tabs-narrow")||"";if(i){var r=i.one(".mui-mbar-tab-logo-nav-top");if(r){if(e<20){r.css("background-image","none")}else{r.css("background-image","url(http://gtms02.alicdn.com/tps/i2/TB17IYEGpXXXXcPXXXX4wBMGpXX-35-20.png)")}}}var n=a.one(".mui-mbar").one(".mui-mbar-tabs-top-wide");!!n&&n.css("height","0px")}function B(){if(t.get("notWideTab")){return}a.one(".mui-mbar").one(".mui-mbar-tabs").addClass("mui-mbar-tabs-wide");t.get("offsetYCustom");var e=a.one(".mui-mbar-tabs-narrow")||"";if(e){var i=e.one(".mui-mbar-tab-logo-nav-top");if(i){if(g<40){i.css("background-image","none")}else if(g>40&&g<90){i.css("background-image","url(http://gtms03.alicdn.com/tps/i3/TB1SqR8GFXXXXbxXpXXkEFUJpXX-85-30.jpg)")}else{i.css("background-image","url(http://gtms04.alicdn.com/tps/i4/TB1kX0sGFXXXXaSXpXXXUh4JpXX-85-80.jpg)")}}}var r=a.one(".mui-mbar").one(".mui-mbar-tabs-top-wide");var n=t.get("baseY")||0;!!r&&r.css("height",n+"px")}if(t.isMiniWidth()||x.forceMallBarMini){if(a.one(".mui-mbar").one(".mui-mbar-tabs")){C(g)}t.fire(u.E.STATUS_CHANGE,{status:u.S.MINI});if(H){d.sendLog(u.ARR.S1_DEFAULT);H=false}}else{if(a.DOM.viewportWidth()<1380){C()}else{if(!(a.UA.ie<8)){B()}}t.fire(u.E.STATUS_CHANGE,{status:u.S.STANDARD})}if(t.isMiniWidth()){!k&&Math.random()<u.SAM_PV&&d.sendLog(u.ARR.EXP1);k=true}}V();i.css("visibility")==="hidden"&&i.css("visibility","visible");var Y={w:a.DOM.viewportWidth(),h:a.DOM.viewportHeight()};O.on("resize",a.buffer(function(e){d.log(e.type,Y);var i={w:a.DOM.viewportWidth(),h:a.DOM.viewportHeight()};var r=true;if(Y.h===i.h&&Y.w!==i.w&&u.S.EXPAND===t.get(u.K.STATUS)){r=false}Y=i;r&&V()},u.COMMON_DELAY,t));var W=a.one("body");W.delegate("click",".mui-favor-add",function(e){var i=a.one(e.currentTarget).attr("data-itemId");t._addFavor(i,e);e.halt()});W.delegate("click",".mui-favor-delete",function(e){var i=a.one(e.currentTarget).attr("data-itemId");t._deleteFavor(i);e.halt()});Math.random()<u.SAM_PV&&d.sendLog(u.ARR.PV);t.get(u.K.LOADED)&&setTimeout(function(){t.get(u.K.LOADED)(t)},10)},addFavor:function(a){d.log("::mallbar addFavor::start");var t=a.favorAd||"",e=a.itemId||"",i={},r=a.callback||"",n=a.e||"";if(!e){return}i={sellerId:a.sellerId||"",categoryId:a.categoryId||""};var l=this;var o=l.get(u.K.MODEL).get(u.K.USERINFO);if(o.isLogin){new m({url:u.URL.FAVORITE_ITEM,scriptCharset:"gbk",dataType:"jsonp",type:"GET",data:{itemId:e,favorite:"1",_tb_token_:l.get("token")||""},success:function(a){if(a.s==1){l.driving({type:"favor",e:n,bubble:true,callback:r,id:e,params:i,favorAd:t,speed:2})}else{d.codeTracker.sendTrack(u.T.NUMLEV,"mallbar.favor.addFavor.status.error","\u6536\u85cf\u63a5\u53e3\u72b6\u6001\u5f02\u5e38")}},error:function(){d.codeTracker.sendTrack(u.T.NUMLEV,"mallbar.favor.addFavor.data.error","\u6536\u85cf\u63a5\u53e3\u8bf7\u6c42\u5931\u8d25")}})}else{}},_addFavor:function(a,t,e){var i=this;TB.Global.loginStatusReady(function(r){new m({url:u.URL.FAVORITE_ITEM,scriptCharset:"gbk",dataType:"jsonp",type:"GET",data:{itemId:a,favorite:"1",_tb_token_:r["tbToken"]},success:function(a){if(a.s==1){i.driving({type:"favor",e:t,speed:2,bubble:true,callback:e})}else{d.codeTracker.sendTrack(u.T.NUMLEV,"mallbar.favor.addFavor.status.error","\u6536\u85cf\u63a5\u53e3\u72b6\u6001\u5f02\u5e38")}},error:function(){d.codeTracker.sendTrack(u.T.NUMLEV,"mallbar.favor.addFavor.data.error","\u6536\u85cf\u63a5\u53e3\u8bf7\u6c42\u5931\u8d25")}})})},_deleteFavor:function(a,t){var e=this;TB.Global.loginStatusReady(function(e){new m({url:u.URL.FAVORITE_ITEM,dataType:"jsonp",scriptCharset:"gbk",type:"GET",data:{itemId:a,favorite:"0",_tb_token_:e["tbToken"]},success:function(a){if(a.s==1){t()}else{d.codeTracker.sendTrack(u.T.NUMLEV,"mallbar.favor.deleteFavor.status.error","\u53d6\u6d88\u6536\u85cf\u63a5\u53e3\u72b6\u6001\u5f02\u5e38")}},error:function(){d.codeTracker.sendTrack(u.T.NUMLEV,"mallbar.favor.addFavor.data.error","\u53d6\u6d88\u6536\u85cf\u63a5\u53e3\u8bf7\u6c42\u5931\u8d25")}})})},getCueMsgInfo:function(t){var e=this;this.cueMsgCallbacks=this.cueMsgCallbacks||[];this.cueMsgCallbacks.push(t);if(!this.sendCueMsg){e.sendCueMsg=true;var i=e.get("sellerId");var r=e.get("itemId");var n=e.get("brandId");if(i||r||n){d.getStaticConf({cb:function(t){if(!t.notGetCueMsgInfo){d.ajax({url:u.URL.GET_PLUGIN_ASSET_TIP,data:{sellerId:i,itemId:r,brandId:n},timeout:4,jsonpCallback:"__mallbarCueAssetMsg",success:function(t){e.cueMsgData=t;a.each(e.cueMsgCallbacks,function(e){if(a.isFunction(e)){e(t)}});e.cueMsgCallbacks=[]},error:function(){d.codeTracker.sendTrack(u.T.NUMLEV,"mallbar.mallbar.getCueMsgInfo.get.failure","mallbar\u83b7\u53d6\u6c14\u6ce1\u4fe1\u606f\u5931\u8d25")}})}}})}}else if(e.cueMsgData){a.each(e.cueMsgCallbacks,function(a){a(e.cueMsgData)});e.cueMsgCallbacks=[]}},isMiniWidth:function(){return a.DOM.viewportWidth()<1260},broadcast:function(t,e){var i=this;i.fire(t,e);var r=i.get(u.K.ITEMS);a.each(r,function(a){a.fire(t,e)})},toggle:function(a){var t=a.obj;r(t,{right:a.expand?0:-t.outerWidth()+"px"},a.duration||.3,a.easing||u.EASE,function(){a.cb&&a.cb()}).run()},isValid:function(t){var e=false;t=t.toUpperCase();a.each(u.P,function(a,i){if(t===i){e=true;return false}});return e},collapse:function(a){var t=this;d.log("mallbar collapse",a);a=a||{};var e=u.S.MINI===a.status?u.S.MINI:u.S.STANDARD;t.fire(u.E.STATUS_CHANGE,{status:e})},expand:function(a){var t=this;d.log("mallbar expand",a);a=a||{};var e=a.type.toUpperCase();if(!t.isValid(e)){return}var i=t.get(u.K.ITEMS)[u.P[e]];return i&&i.expand()},getPoint:function(a){var t=this;d.log("mallbar getPoint",a);a=a||{};var e=a.type.toUpperCase();if(!t.isValid(e)){return null}if(e=="BRAND"){if(t.get(u.K.ITEMS)[u.P[e]]){e="BRAND"}else if(t.get(u.K.ITEMS)["my1111"]){u.P.BRAND="my1111"}}var i=t.get(u.K.ITEMS)[u.P[e]];return i?i.getPoint():null},_bubbleTips:function(t){var e=this;d.log("mallbar favor or cart bubble",t);t=t||{};var i=t.type.toUpperCase();if(!e.isValid(i)){return}if(!(i=="FAVOR"||i=="CART")){return}var r=e.get(u.K.ITEMS)[u.P[i]];var n=t.bubble===undefined?true:t.bubble;if(r){t.item=r;d.getStaticConf({cb:function(a){if(!a.notFavorDefaultBubble&&i=="FAVOR"||!a.notCartDefaultBubble&&i=="CART"||h){l(t)}}})}function l(t){var i=new b(['<div class="mui-mbar-bubble mui-mbar-bubble-recommend mui-mbar-bubble-recommend-cart" >','<div class="mui-mbar-arr mui-mbar-bubble-recommend-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-prof-login-close"></div>','<div class="mui-mbar-bubble-recommend-bd">','<div class="mui-mbar-bubble-recommend-content-head">'+'<span class="mui-mbar-iconfont mui-mbar-bubble-recom-hd-logo">&#xe60c;</span>','<div class="mui-mbar-bubble-recom-hd-p">','<p class="mui-mbar-bubble-recom-hd-p-1"><b>\u6210\u529f\u52a0\u5165\u8d2d\u7269\u8f66\uff01</b>{{#if showNum}}\u5df2\u6709<span>{{cartNum}}</span>\u4eba\u52a0\u5165\u8d2d\u7269\u8f66\uff0c\u8fd8\u4e0d\u5feb\u62a2\uff01{{/if}}</p>','<p class="mui-mbar-bubble-recom-hd-p-2">\u60a8\u53ef\u4ee5<a href="http://cart.tmall.com?scm=1048.1.12.2" target="_blank">\u53bb\u8d2d\u7269\u8f66\u7ed3\u7b97</a>{{#if goRoom}}\u6216<a href="http://www.tmall.com/go/market/brand/worth.php?from=mybrand_tab?scm=1048.1.12.6" target="_blank">\u53bb\u60a8\u7684\u4e13\u5c5e\u63a8\u8350</a>{{/if}}{{#if goAsset}}<a  target="_blank" href="http://chong.alipay.com/i/chong.htm?scm=1048.1.12.4" class="mui-mbar-bubble-recom-hd-ad">\u5145\u503c\u5929\u732b\u5b9d\uff0c\u53cc11\u652f\u4ed8\u4e0d\u6392\u961f</a>{{/if}}</p>',"</div>","</div>",'<div class="mui-mbar-bubble-recommend-content-blow">','<p class="mui-mbar-bubble-recom-bd-p">\u8fbe\u4eba\u7684\u8d2d\u7269\u8f66\u91cc\u90fd\u6709\u5565 <a target ="_blank" href="http://www.tmall.com/go/market/brand/worth.php?from=cart&scm=1048.1.12.5&invalidItems={{itemParam}}">\u67e5\u770b\u66f4\u591a</a></p>','<div class="mui-mbar-recom-list-slide mui-mbar-recom-list-slide-cart">','<div class="mui-mbar-recom-list-slide-cont mui-mbar-recom-list-slide-cont-cart">',"{{#each data}}",'<div class="mui-mbar-bubble-recom-list-item mui-mbar-bubble-recom-list-item-cart">','<a target="_blank" href="{{itemUrl}}">                        <img src="{{pictUrl}}_120x120" width="120" height="120"/>                        <p><span class="mui-price-font">&yen;</span>{{promotionPrice}}</p>                    </a>',"</div>","{{/each}}",'</div><span class="mui-mbar-iconfont mui-mbar-recom-list-slide-prev mui-mbar-recom-list-slide-prev-cart">&#xe60d;</span><span class="mui-mbar-iconfont mui-mbar-recom-list-slide-next mui-mbar-recom-list-slide-next-cart">&#xe60e;</span></div>',"</div>","</div>","</div>"].join(""));var r=new b(['<div class="mui-mbar-bubble mui-mbar-bubble-recommend mui-mbar-bubble-recommend-favor{{#if favorAd}} mui-mbar-bubble-recommend-favor-ad {{/if}}" >','<div class="mui-mbar-arr mui-mbar-bubble-recommend-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-prof-login-close"></div>','<div class="mui-mbar-bubble-recommend-bd">','<div class="mui-mbar-bubble-recommend-content-head">'+'<span class="mui-mbar-iconfont mui-mbar-bubble-recom-hd-logo">&#xe60c;</span>','<div class="mui-mbar-bubble-recom-hd-p">','<p class="mui-mbar-bubble-recom-hd-p-1"><b>\u6210\u529f\u52a0\u5165\u6536\u85cf\u5939\uff01</b></p>','<p class="mui-mbar-bubble-recom-hd-p-2">\u60a8\u53ef\u4ee5<a href="http://favorite.taobao.com/item_collect.htm?scm=1048.1.12.1" target="_blank">\u67e5\u770b\u6536\u85cf\u5939</a>{{#if goRoom}}\u6216<a href="http://www.tmall.com/go/market/brand/worth.php?from=mybrand_tab?scm=1048.1.12.7" target="_blank">\u53bb\u60a8\u7684\u4e13\u5c5e\u63a8\u8350</a>{{/if}}{{#if goAsset}}<a  target="_blank" href="http://chong.alipay.com/i/chong.htm?scm=1048.1.12.3" class="mui-mbar-bubble-recom-hd-ad">\u5145\u503c\u5929\u732b\u5b9d\uff0c\u53cc11\u652f\u4ed8\u4e0d\u6392\u961f</a>{{/if}}</p>',"</div>","","</div>",'<div class="mui-mbar-bubble-recommend-content-blow">','<p class="mui-mbar-bubble-recom-bd-p">\u770b\u770b\u5927\u5bb6\u90fd\u6536\u85cf\u4e86\u5565 </p>','<div class="mui-mbar-recom-list-slide mui-mbar-recom-list-slide-favor">','<div class="mui-mbar-recom-list-slide-cont mui-mbar-recom-list-slide-cont-favor">',"{{#each data}}",'<div class="mui-mbar-bubble-recom-list-item mui-mbar-bubble-recom-list-item-favor">','<a target="_blank" href="{{itemUrl}}">                        <img src="{{pictUrl}}_120x120" width="120" height="120" alt="{{itemTitle}}"/>                        <p><span class="mui-price-font">&yen;</span>{{promotionPrice}}</p>                    </a>',"</div>","{{/each}}",'</div><span class="mui-mbar-iconfont mui-mbar-recom-list-slide-prev mui-mbar-recom-list-slide-prev-favor">&#xe60d;</span><span class="mui-mbar-iconfont mui-mbar-recom-list-slide-next mui-mbar-recom-list-slide-next-favor">&#xe60e;</span></div>','{{#if favorAd}} <div class=" mui-mbar-bubble-recommend-favor-ad-cont" > {{/if}}',"{favorAdHtml}","{{#if favorAd}} </div> {{/if}}","</div>","</div>","</div>"].join(""));var n=t.id||"";var l=t.item;var o=t.type;var s="";var m="";var f={};d.log("obj",t);if(o!="CART"&&o!="FAVOR"){return}if(o=="CART"){s=u.URL.GET_MBAR_ADD_CART_RECOMMEND;m="_mallbarCartBubbleRecommend";if(!t.params){return}var p=t.params;f={itemId:p.itemId||"",sellerId:p.sellerId||"",categoryId:p.categoryId||""}}if(o=="FAVOR"){s=u.URL.GET_MBAR_ADD_FAVOR_RECOMMEND;m="_mallbarFavorBubbleRecommend";var p=t.params||{};f={itemId:n,sellerId:p.sellerId||"",categoryId:p.categoryId||""}}d.ajax({url:s,jsonpCallback:m,dataType:"jsonp",data:f,timeout:5,success:function(n){if(!n){return}var s="";d.getStaticConf({cb:function(m){var b=e.get(u.K.MODEL).get(u.K.TIMESTAMP);if(m.bubbleShowGo11){var f=m.bubbleShowGo11;var p=f.s?f.s:"";var g=f.e?f.e:"";if(b>p&&b<g){n.goRoom=true}}if(m.bubbleShowCharge){var f=m.bubbleShowCharge;var p=f.s?f.s:"";var g=f.e?f.e:"";if(b>p&&b<g){n.goAsset=true}}n.showNum=true;if(m.notCartBubbleNum){n.showNum=false}if(o=="CART"){if(!n.data||!n.data.length){return}if(!n.cartNum||n.cartNum<1){n.showNum=false}s=i.render(n);n.tab="cart"}if(o=="FAVOR"){if(!n.data||!n.data.length){return}if(t.favorAd){n.favorAd=true}s=r.render(n).replace("{favorAdHtml}",t.favorAd);n.tab="favor"}l.fire(u.E.BUBBLE_CHANGE,{show:true,html:s,customConentType:3,isCustomContent:true,isNotTabFire:true,bubbleType:0,isToForever:true,showed:function(){!!n.exposureParam&&d.sendLog(n.exposureParam);!!n.acurl&&d.sendLog(n.acurl);d.sendLog(u.ARR["MBAR_RECOMMEND_BUBBLE_"+o]);var t=new c(a.one(".mui-mbar-recom-list-slide-"+n.tab),{effect:"hSlide",autoSlide:false,contentClass:"mui-mbar-recom-list-slide-cont-"+n.tab,pannelClass:"mui-mbar-bubble-recom-list-item-"+n.tab,carousel:true,colspan:4,speed:500});a.one(".mui-mbar-recom-list-slide-prev-"+n.tab).on("click",function(){t.previous()});a.one(".mui-mbar-recom-list-slide-next-"+n.tab).on("click",function(){t.next()})},colsedClicked:function(){var t=a.one(".mui-mbar-bubble mui-mbar-bubble-recommend");!!t&&a.DOM.remove(t)}})}})},error:function(){d.codeTracker.sendTrack(u.T.NUMLEV,"mallbar.bubble.recommend.get.failure-"+o,"\u83b7\u53d6\u6c14\u6ce1\u63a8\u8350\u5185\u5bb9\u5931\u8d25")}})}},onFinish:function(t){var e=this;d.log("mallbar onFinish",t);t=t||{};var i=t.type.toUpperCase();if(!e.isValid(i)){return}if(i=="FAVOR"||i=="CART"){return}var r=e.get(u.K.ITEMS)[u.P[i]];var n=t.bubble===undefined?true:t.bubble;if(r){r.fire(u.E.FLYIN_END);if(n){r.fire(u.E.BUBBLE_CHANGE,{show:false,cb:function(){var e="";var n="";var l="";var o={};var s=true;switch(i){case"BRAND":n=u.ARR.BRAND_FLY_BUB_SHOW;l=u.ARR.BRAND_FLY_BUB_CLICK;if(t.id){e=d.fm('<span class="mui-mbar-bubble-em">\u54c1\u724c\u5173\u6ce8\u6210\u529f\uff01</span><br><p class="mui-mbar-bubble-href"><a class="j_BubbleLink " target="_blank" href="http://mybrand.tmall.com/brandInfo.htm?brandId={0}&scm={1}">\u67e5\u770b\u6700\u65b0\u52a8\u6001</a></p>',t.id,u.SCM.BRAND_FLY_BUB_LINK)}else{e='<span class="mui-mbar-bubble-em">\u54c1\u724c\u5173\u6ce8\u6210\u529f\uff01</span><br><p class="mui-mbar-bubble-href"><a>\u67e5\u770b\u65b0\u52a8\u6001</a></p>'}break;case"ASSET":n=u.ARR.COUPON_FLY_BUB_SHOW;l=u.ARR.COUPON_FLY_BUB_CLICK;e='<span class="mui-mbar-bubble-em">\u4f18\u60e0\u5238\u9886\u53d6\u6210\u529f</span><br><p class="mui-mbar-bubble-href"><a>\u7acb\u5373\u67e5\u770b</a></p>';break;case"BONUS":n=u.ARR.BONUS_FLY_BUB_SHOW;l=u.ARR.BONUS_FLY_BUB_CLICK;e='<span class="mui-mbar-bubble-em">\u7ea2\u5305\u9886\u53d6\u6210\u529f\uff01</span><br>\u7ea2\u5305\u4f1a\u572824\u5c0f\u65f6\u5230\u8d26\uff0c\u67e5\u770b\u6211\u5df2\u9886\u7528\u7684\u7ea2\u5305\uff01';break;case"GUESS_POINT":n=u.ARR.POINT_SHOW;l=u.ARR.POINT_BUB_CLICK;e='<span class="mui-mbar-bubble-em">\u5929\u732b\u79ef\u5206\u9886\u53d6\u6210\u529f\uff01</span><br><p class="mui-mbar-bubble-href"><a class="j_BubbleLink " target="_blank" href="http://vip.tmall.com/vip/index.htm?scm=1048.1.3.27">\u53bb\u770b\u770b\u79ef\u5206</a></p>';break;case"SIGN_POINT":n=u.ARR.POINT_SHOW;l=u.ARR.POINT_BUB_CLICK;e='<span class="mui-mbar-bubble-em">\u5929\u732b\u79ef\u5206\u9886\u53d6\u6210\u529f\uff01</span><br><p class="mui-mbar-bubble-href"><a class="j_BubbleLink " target="_blank" href="http://vip.tmall.com/vip/index.htm?scm=1048.1.3.27">\u53bb\u770b\u770b\u79ef\u5206</a></p>';break;case"GET_COUPON":n=u.ARR.GET_COUPON_BUB_SHOW;l=u.ARR.GET_COUPON_BUB_CLICK;e='<span class="mui-mbar-bubble-em">\u4f18\u60e0\u5238\u9886\u53d6\u6210\u529f</span><br><p class="mui-mbar-bubble-href"><a class="j_BubbleLink " target="_blank" href="http://mybrand.tmall.com/myCoupon.html?scm=1048.1.3.28">\u53bb\u770b\u770b\u4f18\u60e0\u5238</a></p>';break;case"FOOT":n=u.ARR.FOOT_FLY_BUB_SHOW;l=u.ARR.FOOT_FLY_BUB_CLICK;e='<span class="mui-mbar-bubble-em">\u60a8\u9489\u4f4f\u7684\u5546\u54c1\u5728\u8fd9\u91cc\u54e6\uff01</span><br><p class="mui-mbar-bubble-href"><a>\u53bb\u770b\u770b</a></p>';o.height="110px";break;case"FAVOR":s=false;break;case"DELETE_FAVOR":n=u.ARR.DELETE_FAVOR_FLY_BUB_SHOW;l=u.ARR.DELETE_FAVOR_FLY_BUB_CLICK;e='<span class="mui-mbar-bubble-em">\u53d6\u6d88\u6536\u85cf\u6210\u529f\uff01</span><br><p class="mui-mbar-bubble-href"><a>\u53bb\u770b\u770b</a></p>';break;case"CART":s=false;break}if(s){r.fire(u.E.BUBBLE_CHANGE,a.mix(o,{show:true,html:e,customConentType:1,isNotTabFire:false,showDelay:10,hideDelay:t.hideDelay===undefined?"":t.hideDelay,showed:function(a){n&&d.sendLog(n);var t=a.one(".j_BubbleLink");if(t){t.on("click",function(a){switch(i){case"BRAND":d.sendLog(u.ARR.BRAND_FLY_BUB_LINK_CLICK);break;case"GET_COUPON":d.sendLog(u.ARR.GET_COUPON_BUB_LINK_CLICK);break;case"SIGN_POINT":d.sendLog(u.ARR.POINT_BUB_LINK_CLICK);break;case"GUESS_POINT":d.sendLog(u.ARR.POINT_BUB_LINK_CLICK);break}a.stopPropagation()});d.getStaticConf({cb:function(a){a.brandBubUrl&&t.attr("href",a.brandBubUrl)}})}},clicked:function(){l&&d.sendLog(l)}}))}}})}else{var l="",o="";switch(i){case"BRAND":l=u.ARR.BRAND_FLY_BUB_SHOW;o=u.ARR.BRAND_FLY_BUB_CLICK;break;case"ASSET":l=u.ARR.COUPON_FLY_BUB_SHOW;o=u.ARR.COUPON_FLY_BUB_CLICK;break;case"BONUS":l=u.ARR.BONUS_FLY_BUB_SHOW;o=u.ARR.BONUS_FLY_BUB_CLICK;break;case"GUESS_POINT":l=u.ARR.POINT_SHOW;o=u.ARR.POINT_BUB_CLICK;break;case"SIGN_POINT":l=u.ARR.POINT_SHOW;o=u.ARR.POINT_BUB_CLICK;break;case"GET_COUPON":l=u.ARR.GET_COUPON_BUB_SHOW;o=u.ARR.GET_COUPON_BUB_CLICK;break;case"FOOT":l=u.ARR.FOOT_FLY_BUB_SHOW;o=u.ARR.FOOT_FLY_BUB_CLICK;break;case"CART":break}l&&d.sendLog(l);o&&d.sendLog(o)}}},fly:function(t){var e=this;var i=t.type.toUpperCase();if(!e.isValid(i)){return}var n=e.getPoint({type:i});if(!n){return}var l=t.flyer,s=t.start,m=t.target,b=t.unAnim,c=t.speed?t.speed:1.16,d=t.bubble===undefined?true:t.bubble,f=t.hideDelay?t.hideDelay:"",p={left:n.x,top:n.y}||o.offset(m),g=a.UA.ie!=6,h=t.targetOffset||{left:0,top:0},_=t.flyerOffset||{left:0,top:0},v=t.flyerResize||{x:16,y:16},T=-1,A;e._bubbleTips({type:i,id:t.id,params:t.params,favorAd:t.favorAd,bubble:d,hideDelay:f});var E=function(){var n=a.UA.ie==6;var s=e._popEl,m=a.UA.webkit,b=m?2:0,c={opacity:0,top:p.top-8-35-b+(n?o.scrollTop():0)+"px"},g={position:n?"absolute":"fixed",opacity:0,left:p.left-8-b+(n?o.scrollLeft():0)+"px",top:p.top-8-b+(n?o.scrollTop():0)+"px"};if(!s){var h=e.get(u.K.ITEMS);var _;if(h){_=h[t.type];if(_){_=_.get(u.K.POBJ);_.fire(u.E.DATA_CHANGE)}}s=e._popEl=o.create("<div>1</div>",{css:a.mix({display:"none",textAlign:"center",backgroundColor:"#b3000e",color:"#ffffff",zIndex:1000001},m?{width:"20px",height:"20px",borderRadius:"10px",color:"#ffffff",lineHeight:"20px",fontSize:"12px",transform:"scale(0.8)",WebkitTransform:"scale(0.8)"}:{width:"16px",height:"16px",borderRadius:"8px",lineHeight:"16px",fontSize:"10px"})});o.append(s,document.body)}function v(){o.hide(l);if(i=="FAVOR"){return}o.css(s,g);o.show(s);r(s,{opacity:1},.1,"easeOut",function(){r(s,c,1,"easeOut",function(){o.hide(s);e.onFinish({type:i,id:t.id,params:t.params,favorAd:t.favorAd,bubble:d,hideDelay:f});t.complete&&t.complete()}).run()}).run()}if(n){v()}else{r(l,{opacity:0},.8,"easeOut",v).run()}};if(v){A={x:o.width(l),y:o.height(l)}}o.append(l,document.body);o.css(l,{position:g?"fixed":"absolute",zIndex:1e6});if(g){s={left:s.left-o.scrollLeft(),top:s.top-o.scrollTop()};if(m){p={left:parseFloat(o.css(m,"left")),top:parseFloat(o.css(m,"top"))}}}else{if(m){p=o.offset(m)}else{p.left+=o.scrollLeft();p.top+=o.scrollTop()}}p.top+=h.top-4;var I=g?0:o.scrollTop();var C=Math.min(s.top,p.top)-Math.abs(s.left-p.left)*(1/3);if(C<I){if(s.left==p.left){C=p.top}C=Math.min(I,Math.min(s.top,p.top))}c=a.UA.ie==6?c:c/2;var B=Math.sqrt(Math.pow(s.top-p.top,2)+Math.pow(s.left-p.left,2));var O=Math.ceil(Math.min(Math.max(Math.log(B)/.05-75,30),100)/c);var S=s.top==C?0:-Math.sqrt((p.top-C)/(s.top-C)),L=(S*s.left-p.left)/(S-1),N=p.left==L?0:(p.top-C)/Math.pow(p.left-L,2);l.fadeIn();if(v){A={x:o.width(l),y:o.height(l)}}if(!b){var R=setInterval(function(){++T;var a=s.left+(p.left-s.left)*T/O;var t=N==0?s.top+(p.top-s.top)*T/O:N*Math.pow(a-L,2)+C;var e={left:a,top:t};if(v){var i=O/2;var r=v.x-(v.x-A.x)*Math.cos(T<i?0:(T-i)/(O-i)*Math.PI/2),n=v.y-(v.y-A.y)*Math.cos(T<i?0:(T-i)/(O-i)*Math.PI/2);o.css(l,{width:r+"px",height:n+"px","font-size":Math.min(r,n)+"px"});_.left=-r/2;_.top=-n/2}o.css(l,{left:e.left+_.left+"px",top:e.top+_.top+"px"});if(T==0){o.show(l)}if(T==O){clearInterval(R);E()}},16)}else{E()}},driving:function(t){d.log("driving\u65b9\u6cd5\u4f20\u5165\u53c2\u6570\uff1a",t);var e=this;var i=[{id:"asset",name:"&#xe606;"},{id:"get_coupon",name:"&#xe606;"},{id:"brand",name:"&#xe600;"},{id:"guess_point",name:"&#xf000a;"},{id:"sign_point",name:"&#xf000a;"},{id:"foot",name:"&#xe607;"},{id:"favor",name:"&#xe607;"}];function r(t,e){var i="";a.each(e,function(a){if(a.id==t){i=a.name;return true}});return i}if(t){var n,l,o;n=t.e;l=t.type||a.one(n.target).attr("data-type");if(!n||!l){return}if(l=="brand"){if(e.get(u.K.ITEMS)[l]){l="brand"}else{u.P.BRAND="my1111"}}var s=n.target;var m=a.DOM;o=t.callback||"";var b;if(t.flyer){var c=t.width?t.width:50;var f=t.height?t.height:50;var p=a.UA.ie<9;var g="";if(p){g='<img width="{2}" height="{3}" src="{4}"/>'}else{g='<div class="mui-mbar-pan" style="border-radius: 50%; -webkit-border-radius: 50%; width: {2}px; height: {3}px; background:{4}; background-size: 100%;"></div>'}b=a.one(g.replace("{2}",c).replace("{3}",f).replace("{4}",p?t.flyer:"url("+t.flyer+")")).appendTo(document.getElementsByTagName("body")[0])}else{b=a.one('<div class="mui-mbar-pan mui-mbar-{0}-pan">{3}</div>'.replace("{0}",r(l,i)?l:"default").replace("{3}",r(l,i)?r(l,i):"")).appendTo(document.getElementsByTagName("body")[0])}if(l!="cart"){n.pageX=m.offset(s).left+(m.width(s)-b.width())/2;n.pageY=m.offset(s).top-b.height()/2}b.css({left:n.pageX-m.scrollLeft(),top:n.pageY-m.scrollTop()});if(l=="cart"||l=="favor"){t.bubble=t.bubble===undefined?true:t.bubble}if(l=="cart"){var h=e.get(u.K.ITEMS);var _;if(h){_=h.cart;if(_){_=_.get(u.K.POBJ);_.fire("addCartItem")}}}var v;var T;if(b&&b.width){v=n.pageX+b.width()/2;T=n.pageY+b.height()/2}else{v=n.pageX;T=n.pageY}this.fly({id:t.id||t.itemId||"",type:l,flyer:b,start:{left:v,top:T},target:t.target?t.target:null,unAnim:t.unAnim||false,bubble:t.bubble===false?t.bubble:true,speed:t.speed?t.speed:1.16,hideDelay:t.hideDelay?t.hideDelay:"",params:t.params||"",favorAd:t.favorAd||"",complete:function(){if(typeof o=="function"){o()
}}})}},bubble:function(a){var t=this;a=a||{};a.show=typeof a.show=="undefined"?a.show=true:a.show;a.tab=a.tab||"PROF";a.title=a.title||"";a.content=a.content||"";a.isCustomContent=!!a.isCustomContent;var e=a.customContentType||2;if(typeof a.bubbleType=="undefined"){a.bubbleType=1}if(typeof a.isNotTabFire=="undefined"){a.isNotTabFire=true}var i={PROF:1,CART:2,ASSET:3,BRAND:4,PROMOTION:5};var r=t.get(u.K.ITEMS)[u.P[a.tab]];if(!r){return}if(a.show){d.log("isMallbarExpend",B);if(C){var n={tab:a.tab,id:a.flag||i[a.tab],item:r,opt:a};I.push(n);return}else if(!B&&!a.first){return}}if(a.show){if(a.tab=="PROF"){r.get("pluginObj").fire(u.E.PROF_HIDE)}}r.fire(u.E.BUBBLE_CHANGE,{show:a.show,html:a.content,height:a.height||"",showDelay:500,contentTitle:a.title,bubbleType:a.bubbleType,customContentType:e,isNotTabFire:a.isNotTabFire,hideDelay:a.hideDelay||"",showDelay:a.showDelay,dismiss:a.dismiss||"",showed:a.showed||"",clicked:a.clicked||"",arrClicked:a.arrClicked||"",arrShowed:a.arrShowed||"",colsedClicked:a.colsedClicked||""})},firstBubble:function(){var a=this;C=false;d.log("arrBubble",I);if(I&&I.length){var t=0,e={},i=I.length;for(var r=0;r<i;r++){for(t=r;t<i;t++){if(I[r].id>I[t].id){e=I[r];I[r]=I[t];I[t]=e}}}d.log("arrBubble sort",I);var n=I[0].opt;if(n.showTwo){if(I[1]){var l=I[1].opt;l.first=true;var o=n.dismiss||"";n.dismiss=function(){!!o&&o();a.bubble(l)}}}if(n){n.first=true;a.bubble(n)}I=[]}}});return O},{requires:["base","event","node","anim","ua","swf","dom","cookie","ajax","xtemplate","gallery/slide/1.3/","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/model","mui/mallbar/item","mui/mallbar/store","mui/mallbar/mallbar.css","mui/mallbar/mallbar-tab.css","mui/mallbar/guide","mui/mallbar/plugin/prof","mui/mallbar/plugin/asset","mui/mallbar/plugin/brand","mui/mallbar/plugin/live","mui/mallbar/plugin/foot","mui/mallbar/plugin/trip","mui/mallbar/plugin/top","mui/mallbar/plugin/ue","mui/mallbar/plugin/qrcode","mui/mallbar/plugin/favor","mui/mallbar/plugin/charge","mui/mallbar/plugin/promotion","mui/mallbar/plugin/cart","mui/mallbar/plugin/nav","mui/mallbar/plugin/my1111"]});KISSY.add("mui/mallbar/conf",function(a){var t=location.href;var l=t.indexOf("mbar-debug=1")>-1;var _=t.indexOf("mbar-debug-tms=1")>-1;var m=t.indexOf("mbar-debug-log=1")>-1;var r="2014-03-06 03:20";var n=window.TB;var E=n&&n.globalToolFn&&a.isFunction(n.globalToolFn.isDaily)?n.globalToolFn.isDaily():location.hostname.indexOf(".net")>=0||location.hostname.indexOf(".com.hk")>=0;var O="http://gm.mmstat.com";var e={VER:"2.2.3",DEBUG:l,DEBUG_LOG:m,IS_DAILY:E,SKIN:"mui-mbar-d11",TAB_W:50,MINI_HIT_WIDTH:50,TAB_W_C:100,ZINDEX:999999,SAMPLING:5/1e3,SAM_PV:1/1e3,EASE:"easeOut",BUBBLE_PAD:5,COMMON_DELAY:100,TIMEOUT_TOP:5*1e3,TIMEOUT_STORAGE:3*1e3,DEGRADE:-99,BUBBLE_HIDE_DELAY:12*1e3,AVATAR:E?"http://wsapi.jianghu.daily.taobao.net/avatar/getAvatar.do?userId={0}&width={1}&height={1}&type=ww":"http://wwc.taobaocdn.com/avatar/getAvatar.do?userId={0}&width={1}&height={1}&type=ww",CAT:"http://img04.taobaocdn.com/tps/i4/T1VaaiFdpdXXXtxVjX.swf",AR:O,CK_USED:"_mr",NO_IMG:"http://img01.taobaocdn.com/tps/i1/T1aYCaFaVcXXX6DYsb-100-100.gif",STORAGE_PROXY:"http://www.tmall.com/go/act/storage-proxy.php",DOMAIN:E?".tmall.net":".tmall.com",RECOMMEND_APPID:"03159",ARR:{S1_DEFAULT:O+"/tmallbrand.999.102",S12:O+"/tmallbrand.99.1",S21:O+"/tmallbrand.99.2",S12_ACTIVE:O+"/tmallbrand.99.48",S21_ACTIVE:O+"/tmallbrand.99.49",S32_ACTIVE:O+"/tmallbrand.99.70",S31_ACTIVE:O+"/tmallbrand.99.71",S32:O+"/tmallbrand.99.9",S12_USER_TRIGGER:O+"/tmallbrand.99.113",S21_ICON_CLOSE:O+"/tmallbrand.99.114",QRCODE:O+"/tmallbrand.99.66",PROF:O+"/tmallbrand.99.3",PROF_LOGIN:O+"/tmallbrand.99.62",PROF_BUB_SHOW:O+"/tmallbrand.99.19",PROF_BUB_CLICK:O+"/tmallbrand.99.20",PROF_BUB_LINK_CLICK:O+"/tmallbrand.99.21",PROF_BUB_T0_SHOW:O+"/tmallbrand.99.89",PROF_BUB_T0_CLICK:O+"/tmallbrand.99.90",ASSETS_TAB_CLICK:O+"/tmallbrand.99.116",COUPON_AVAILABLE_SHOW:O+"/tmallbrand.99.7",COUPON_AVAILABLE_CLICK:O+"/tmallbrand.99.10",COUPON_MEMBER_BUBBLE_A_SHOW:O+"/tmallbrand.99.85",COUPON_MEMBER_BUBBLE_A_CLICK:O+"/tmallbrand.99.86",COUPON_MEMBER_BUBBLE_B_SHOW:O+"/tmallbrand.99.87",COUPON_MEMBER_BUBBLE_B_CLICK:O+"/tmallbrand.99.88",COUPON_7_SHOW:O+"/tmallbrand.99.13",COUPON_1_SHOW:O+"/tmallbrand.99.14",COUPON_7_CLICK:O+"/tmallbrand.99.15",COUPON_1_CLICK:O+"/tmallbrand.99.16",COUPON_COULD_SHOW:O+"/tmallbrand.99.59",COUPON_COULD_CLICK:O+"/tmallbrand.99.58",COUPON_FLY_BUB_SHOW:O+"/tmallbrand.99.26",COUPON_FLY_BUB_CLICK:O+"/tmallbrand.99.27",BONUS_FLY_BUB_SHOW:O+"/tmallbrand.99.28",BONUS_FLY_BUB_CLICK:O+"/tmallbrand.99.29",BONUS_AVAILABLE_BUB_SHOW:O+"/tmallbrand.99.30",BONUS_AVAILABLE_BUB_CLICK:O+"/tmallbrand.99.31",POINT_SHOW:O+"/tmallbrand.99.64",POINT_BUB_CLICK:O+"/tmallbrand.99.63",POINT_BUB_LINK_CLICK:O+"/tmallbrand.99.67",GET_COUPON_BUB_SHOW:O+"/tmallbrand.99.65",GET_COUPON_BUB_CLICK:O+"/tmallbrand.99.68",GET_COUPON_BUB_LINK_CLICK:O+"/tmallbrand.99.69",BRAND_FLY_BUB_SHOW:O+"/tmallbrand.99.23",BRAND_FLY_BUB_CLICK:O+"/tmallbrand.99.24",BRAND_FLY_BUB_LINK_CLICK:O+"/tmallbrand.99.25",LIVE_SHOW:O+"/tmallbrand.99.8",LIVE_CLICK:O+"/tmallbrand.99.11",LIVE_BUB_LINK_CLICK:O+"/tmallbrand.99.22",FOOT_BUBBLE:O+"/tmallbrand.99.17",FOOT_BUBBLE_CLICK:O+"/tmallbrand.99.18",FOOT_FLY_BUB_SHOW:O+"/tmallbrand.99.32",FOOT_FLY_BUB_CLICK:O+"/tmallbrand.99.33",FOOT_PIN_ITEM:O+"/tmallbrand.99.40",FOOT_DELETE_ITEM:O+"/tmallbrand.99.41",FOOT_CLEAR_HISTORY:O+"/tmallbrand.99.42",FOOT_UNPIN_ITEM:O+"/tmallbrand.99.43",CAL_REMIND:O+"/tmallbrand.99.53",CAL_BUB_SHOW:O+"/tmallbrand.99.54",CAL_BUB_CLICK:O+"/tmallbrand.99.55",CAL_BUB_LINK_CLICK:O+"/tmallbrand.99.57",CAL_DATE:O+"/tmallbrand.99.56",BACKTOP_CLICK:O+"/tmallbrand.99.115",PV:O+"/tmallbrand.999.1",LOGIN1:O+"/tmallbrand.999.2",LOGIN2:O+"/tmallbrand.999.3",RETINA:O+"/tmallbrand.999.4",FOOT_MORE_CLICK:O+"/tmallbrand.999.9",EXP1:O+"/tmallbrand.999.11",EXP2:O+"/tmallbrand.999.12",EXP3:O+"/tmallbrand.999.13",TIME1s:O+"/tmallbrand.999.14",TIME1m:O+"/tmallbrand.999.15",TIME1h:O+"/tmallbrand.999.16",TIME1d:O+"/tmallbrand.999.17",INCOGNITO:O+"/tmallbrand.999.18",CLEAR:O+"/tmallbrand.999.19",EXP7:O+"/tmallbrand.999.20",FAVOR_TO_MATCH:O+"/tmallbrand.99.77",FAVOR_TO_FX:O+"/tmallbrand.99.78",FAVOR_DELETE:O+"/tmallbrand.99.79",FAVOR_BACK:O+"/tmallbrand.99.80",FAVOR_CATE_CHECK:O+"/tmallbrand.99.81",FOOT_ADD_FAVOR:O+"/tmallbrand.99.82",PROMOTION_SHOW:O+"/tmallbrand.99.84",CART_TAB_CLICK:O+"/tmallbrand.99.101",CART_TAB_CLICK_DOWN:O+"/tmallbrand.99.102",PROMOTION_BUBBLE_SHOW:O+"/tmallbrand.99.91",PROMOTION_BUBBLE_CLICK:O+"/tmallbrand.99.92",LIVE_SHOP_CHAT_BUBBLE_SHOW:O+"/tmallbrand.99.121",LIVE_CHAT_BUBBLE_CLICK_TO_WW:O+"/tmallbrand.99.122",LIVE_CHAT_BUBBLE_CLICK_TO_LIVE:O+"/tmallbrand.99.123",QRCODE_BUBBLE_NO_LOGIN_QRCODE_SHOW:O+"/tmallbrand.99.124",QRCODE_BUBBLE_TUSER_QRCODE_SHOW:O+"/tmallbrand.99.125",QRCODE_BUBBLE_TUSER_QRCODE_CLICK:O+"/tmallbrand.99.126",ADD_FAVOR_FLY_BUB_SHOW:O+"/tmallbrand.99.127",ADD_FAVOR_FLY_BUB_CLICK:O+"/tmallbrand.99.128",DELETE_FAVOR_FLY_BUB_SHOW:O+"/tmallbrand.99.129",DELETE_FAVOR_FLY_BUB_CLICK:O+"/tmallbrand.99.130",MBAR_RECOMMEND_BUBBLE_CART:O+"/tmallbrand.99.131",MBAR_RECOMMEND_BUBBLE_FAVOR:O+"/tmallbrand.99.132",LIVE_EXPEND_TO_WW:O+"/tmallbrand.99.134",TMALLBAO_BUBBLE_SHOW:O+"/tmallbrand.99.135",TMALLBAO_BUBBLE_CLICK:O+"/tmallbrand.99.136",WORTH_BUBBLE_SHOW:O+"/tmallbrand.99.138",WORTH_BUBBLE_CLICK:O+"/tmallbrand.99.139"},PE:{},SCM:{PROF:"1048.1.2.2",LIVE:"1048.1.5.2",LIVE_BUB_LINK:"1048.1.5.3",BRAND_FLY_BUB_LINK:"1048.1.4.15",CAL_ACT:"1048.1.10.2",FAVOR_ITEM:"1048.1.11.1"},URL:{GET_BAR:E?"http://bar.daily.tmall.net/getMallBar.htm?shopId={0}&v={1}&bizId={2}&sellerId={3}":"http://bar.tmall.com/getMallBar.htm?shopId={0}&v={1}&bizId={2}&sellerId={3}",GET_MSG:E?"http://bar.daily.tmall.net/getMessageWarn.htm":"http://bar.tmall.com/getMessageWarn.htm",GET_PLUGIN_EXAMPLE:"example.do",GEI_PLUGIN_PROF:E?"http://bar.daily.tmall.net/getMyInfo.htm":"http://bar.tmall.com/getMyInfo.htm",GET_PLUGIN_ASSET:E?"http://bar.daily.tmall.net/getMyAssets.htm":"http://bar.tmall.com/getMyAssets.htm",GET_PLUGIN_ASSET_COUPON_DUE_TIP:E?"http://bar.daily.tmall.net/cueCouponInfo.htm":"http://bar.tmall.com/cueCouponInfo.htm",GET_PLUGIN_ASSET_COUPON_DISABLE_TIP:E?"http://bar.daily.tmall.net/disableCouponInfo.htm":"http://bar.tmall.com/disableCouponInfo.htm",GET_PLUGIN_ASSET_TIP:E?"http://bar.daily.tmall.net/cueAssetMsg.htm":"http://bar.tmall.com/cueAssetMsg.htm",GET_PLUGIN_MEMBER_RIGHT:E?"http://bar.daily.tmall.net/getMemberRight.htm":"http://bar.tmall.com/getMemberRight.htm",GET_PLUGIN_BRAND_TIP:E?"http://bar.daily.tmall.net/cueAssetMsg.htm":"http://bar.tmall.com/cueAssetMsg.htm",GET_PLUGIN_BRAND:"brand.do",GET_PLUGIN_GET_BRAND:E?"http://mybrand.daily.tmall.net/ajax/mybrands/getMallBarMyBrands.htm?type=2":"http://mybrand.tmall.com/ajax/mybrands/getMallBarMyBrands.htm?type=2",GET_PLUGIN_LIVE:E?"http://tmm.daily.taobao.net/messagebox/readRadiateMsg.do":"http://tmm.taobao.com/messagebox/readRadiateMsg.do?mconf=1",GET_PLUGIN_LIVE_TIP:E?"http://bar.daily.tmall.net/getActiveMessage.htm":"http://bar.tmall.com/getActiveMessage.htm",GET_PLUGIN_FOOT_ITEMS:E?"http://bar.daily.tmall.net/getItemList.htm":"http://bar.tmall.com/getItemList.htm",GET_PLUGIN_FOOT_ITEMS2:E?"http://bar.daily.tmall.net/getItemList.htm":"http://bar.tmall.com/getItemList.htm",GET_PLUGIN_FOOT_PINITEM:E?"http://bar.daily.tmall.net/pinItem.htm":"http://bar.tmall.com/pinItem.htm",GET_CALENDAR:E?"http://cdnprepub.tms.taobao.com/go/act/getcalendar.php?date={0}":"http://www.tmall.com/go/act/getcalendar.php?date={0}",GET_CONF:l?"data/mallbar-conf.js":E?"http://tms.taobao.com/go/act/mallbar-conf.php":"http://www.tmall.com/go/act/mallbar-conf.php",GEI_PUSH_ITEMS:E?"http://110.75.14.52/recommend.htm":"http://ald.taobao.com/recommend.htm",GET_PLUGIN_ASSET_OBTAIN_COUPON_LIST:E?"http://bar.daily.tmall.net/cueAssetMsg.htm":"http://bar.tmall.com/cueAssetMsg.htm",GET_PLUGIN_ASSET_OBTAIN_COUPON:E?"http://bar.daily.tmall.net/obtainCoupon.htm":"http://bar.tmall.com/obtainCoupon.htm",GET_PLUGIN_FAVOR_INFO:E?"http://bar.daily.tmall.net/getCollectInfo.htm":"http://bar.tmall.com/getCollectInfo.htm",GET_PLUGIN_FAVOR_FX:"http://ald.taobao.com/recommend.htm?appId=03276",GET_PLUGIN_FAVOR_MATCH:"http://ald.taobao.com/recommend.htm?appId=03278",FAVORITE_ITEM:E?"http://bar.daily.tmall.net/favorite/favoriteItem.htm":"http://bar.tmall.com/favorite/favoriteItem.htm",GET_PLUGIN_PROF_QUERY_T0_USER:E?"http://bar.daily.tmall.net/activate/queryT0User.htm":"http://bar.tmall.com/activate/queryT0User.htm",GET_PLUGIN_PROF_SET_T0_USER:E?"http://bar.daily.tmall.net/activate/setT0User.htm":"http://bar.tmall.com/activate/setT0User.htm",GET_PLUGIN_WORTH_RECOMMEND:"http://ald.taobao.com/recommend.htm?appId=03343",GET_PLUGIN_WORTH_LISTS:"http://ald.taobao.com/recommend.htm?appId=03342",GET_PLUGIN_LIVE_SHOP_INFO:E?"http://bar.daily.tmall.net/wwDataSet.htm":"http://bar.tmall.com/wwDataSet.htm",GET_MBAR_ADD_FAVOR_RECOMMEND:"http://aldcdn.tmall.com/recommend.htm?appId=03136",GET_MBAR_ADD_CART_RECOMMEND:"http://ald.taobao.com/recommend.htm?appId=03348",GET_SHOP_CARD:E?"http://neo.daily.tmall.net/shopcard/showMyCards.do":"http://neo.tmall.com/shopcard/showMyCards.do",GET_CLOSE_SALE_NUM:E?"http://bar.daily.tmall.net/closeSaleNum.htm":"http://bar.tmall.com/closeSaleNum.htm"},P:{PROF:"prof",ASSET:"asset",GET_COUPON:"asset",BONUS:"asset",GUESS_POINT:"asset",SIGN_POINT:"asset",BRAND:"brand",LIVE:"live",FOOT:"foot",CAL:"cal",TRIP:"trip",CART:"cart",NAV:" nav",QRCODE:"qrcode",TOP:"top",UE:"ue",CHARGE:"charge",FAVOR:"favor",PROMOTION:"promotion",WORTH:"worth",MY1111:"my1111"},E:{AFTER_BAR_CHANGE:"afterBarChange",MALLBAR_STATUS_CHANGE:"mallbarStatusChange",STATUS_CHANGE:"statusChange",SUPTIP_CHANGE:"suptipChange",BUBBLE_CHANGE:"bubbleChange",PAGE_VISIBILITY_CHANGE:"pageVisibilityChange",VISIBILITY_CHANGE:"visibilityChange",DATA_CHANGE:"dataChange",FLYIN_END:"flyinEnd",ERROR:"error",LOGIN:"login",LOGIN_SUCCESS:"loginSuccess",AFTER_EXPAND_CHANGE:"afterExpandChange",AFTER_TITLE_CHANGE:"afterTitleChange",PROF_CHANGE:"profChange",QRCODE_CHANGE:"qrcodeChange",ON_LOAD:"onLoad",PROF_HIDE:"hideProf",RIGHT_TAB_ITEM_CLICK:"rightTabItemClick"},K:{BAR:"bar",USERINFO:"userinfo",STATIC_CONF:"staticConf",TIMESTAMP:"timestamp",ACCESSED:"__mallbar_accessed",FRM_INIT:"mui/mallbar/frm/init",FRM_USERINFO:"mui/mallbar/frm/userinfo",FRM_ACCESS:"mui/mallbar/frm/access",FRM_STATUS:"mui/mallbar/frm/status",FRM_CART:"mui/mallbar/frm/cart",IFRAME:"iframe",XD:"xd",XD_TIMEOUT:"xdTimeout",IFRAME_TIMEOUT:"iframeTimeout",PROXY:"proxy",CALLBACK_LIST:"callbackList",CACHED_ACTION_LIST:"cachedActionList",PROXY_READY:"proxyReady",INITED:"inited",CONTAINER:"container",G_CONFIG:"gConfig",SHOP_CONFIG:"shopConfig",ITEMS:"items",MODEL:"model",ROOT:"root",ROOT_OUTER:"rootOuter",STATUS:"status",OLD_INDEX:"oldIndex",LOADED:"loaded",MALLBAR:"mallbar",MALLBAR_ITEM:"mallbarItem",TIP_CONTAINER:"tipContainer",TAB:"tab",TITLE:"title",INDEX:"index",BUBBLE:"bubble",PLUGIN:"plugin",SCR:"scr",EXPAND:"expand",POBJ:"pluginObj",PG_FISRT_VISIBLE:"pgFirstVisible",DATA:"data",SHOW_SUPTIP:"showSuptip",SUPTIP_NUM:"suptipNum",BUBBLE_TYPE:"bubbleType",SHOW_BUBBLE:"showBubble",NOT_TO_SUPTIP:"notToSuptip",COUPON_ANCHOR:"anchor",ADD_CART_ITEM:"addCartItem"},B:{FOREVER:1},S:{MINI:1,STANDARD:2,EXPAND:3,SCREEN:4,BAR_NO_MSG:-4,BAR_NOT_LOGIN:-2,BAR_SUCCESS:1},C:{TAB_HIGHLIGHT:"mui-mbar-tab-hover",TABS_SHADOW:"mui-mbar-tabs-shadow",MINI_CLOSE:"mui-mbar-mini-logo-close",CAT_LEFT:"mui-mbar-cat-left",SCALE_DOWN:"mui-mbar-plugin-scaleDown"},M:{B:"\u672c\u9875\u9762\u4e0d\u652f\u6301\u5de5\u5177\u680f",T:"\u63d2\u4ef6\u7c7b\u578b\u53ea\u652f\u6301\uff1abrand\u3001asset\u3001prof\u3001live\u3001foot"},U:{PROF_INTERACT:E?"http://www.daily.tmall.net/go/act/tmall/2013-khc.php":"http://1111.tmall.com",TRIP_TMS:_?"http://demo.tmall.net/sell/gonglue/":"http://www.tmall.com/go/rgn/promotion-act/strategytools.php",NAV_TMS:_?"http://cdnprepub.tms.taobao.com/go/act/1212/mallbar-nav.php":E?"http://cdnprepub.tms.taobao.com/go/act/1212/mallbar-nav.php":"http://www.tmall.com/go/act/1212/mallbar-nav.php",ETC:{DAILY:"http://cdnprepub.tms.tmall.com/go/rgn/2014/mallbar/config/mconf-pub-2_3_0.php",STB:"http://www.tmall.com/go/rgn/2014/mallbar/config/mconf-pub-2_3_0.php",PRE:"http://cdnprepub.tms.tmall.com/go/rgn/2014/mallbar/config/mconf-pub-2_3_0.php",ONLINE:"http://www.tmall.com/go/rgn/2014/mallbar/config/mconf-pub-2_3_0.php"},QR:"http://gtms01.alicdn.com/tps/i1/TB1DV.LGXXXXXXgXFXXszjdGpXX-140-140.png",WW_MODULE:"http://g.tbcdn.cn/aliww/ww/tlight/base.js"},T:{NUMLEV:13}};return e});KISSY.add("mui/mallbar/util",function(a,e,i,t,r,s,o,n,l){var m=/^(https?:\/\/.+?)(\?(.*?))?(#(.*?))?$/;var u={log:function(){if(!o.DEBUG_LOG){return}if(window.console&&window.console.log&&window.console.log.apply){window.console.log.apply(window.console,arguments)}},fm:function(){if(arguments.length==0){return""}else if(arguments.length==1){return arguments[0]}var a=arguments[0],e;for(e=1;e<arguments.length;++e){var i=new RegExp("\\{"+(e-1)+"\\}","g");a=a.replace(i,arguments[e])}return a},segment:function(a){var e={url:"",qs:"",hash:""};if(!a){return e}a+="";var i=m.exec(a);if(!i){return e}e.url=i[1]?i[1]:"";e.qs=i[3]?i[3]:"";e.hash=i[5]?i[5]:"";return e}};var c=u;c.getViewportWidth=function(){var a=document.documentElement;return window.innerWidth||a&&a.clientWidth||document.body.clientWidth};c.getViewportHeight=function(){var a=document.documentElement;return window.innerHeight||a&&a.clientHeight||document.body.clientHeight};c.getViewportSize=function(){return{w:c.getViewportWidth(),h:c.getViewportHeight()}};c.sendLog=function(a){if(!a){return}var e="__mbar_"+ +new Date+Math.random();var i=new Image;window[e]=i;i.src=c.fm("{0}{1}r{2}=1",a,a.indexOf("?")>-1?"&":"?",+new Date);i.onload=function(){window[e]=null}};var b;var d=false;var p=[];c.getStaticConf=function(e){if(b){e.cb&&e.cb(b);return}else{e.cb&&p.push(e.cb)}if(e.url){c.ajax({url:e.url,jsonpCallback:"__mallbarGetConf",scriptCharset:"gbk",error:function(a){c.log("__mallbarGetConf error\uff1a",a)},success:function(e){c.log("__mallbarGetConf",e);if(e){b=e;a.each(p,function(a){a(e)});p=[]}}})}};c.ajax=function(e){var i=e.success;var t=e.complete;var r=location.href;var s=r.indexOf("mbar-local=1")>-1;if(s&&o.DEBUG&&e.url.indexOf("mconf")>=0){e.type="get";e.dataType="script";var n="";var l=e.url;if(e.url.indexOf("?")>=0){var m=e.url.split("?");l=m[0];n=m[1]}var u=l.substring(l.lastIndexOf("/")+1,l.lastIndexOf(".")>=0?l.lastIndexOf("."):l.length);l=c.fm("data/{0}.js{1}",u,n?"?"+n:"");e.url=e._mockUrl?e._mockUrl:l;e.success=function(){i&&i(exports.response)}}else{e.type=e.type||"get";e.dataType=e.dataType||"jsonp";e.success=function(a){i&&i(a)}}var b=e.url.lastIndexOf("?")>-1;e.url=c.fm("{0}{1}_input_charset=UTF-8",e.url,b?"&":"?");e.timeout=e.timeout||5;e.error=e.error||function(a){c.log("U.ajax error: ",a)};var d=window.g_config||{};e.data=e.data||{};e.data.bizInfo=[d.bizId||"",d.sysId||"",d.devId||"pc"].join(".");e.complete=function(a){t&&t(a)};e.scriptCharset="gbk";a.ajax(e)};c.deepMerge=function(e,i){if(!a.isObject(e)||!a.isObject(i)){return e}a.each(i,function(i,t){if(a.isObject(e[t])){c.deepMerge(e[t],i)}else{e[t]=i}});return e};c.noScroll=function(a){if(!a){return}t.on(a,"mousewheel",function(a){var e=a.delta;var i=this.scrollTop;if(e>0&&0===i||e<0&&i+r.outerHeight(this)>=this.scrollHeight){a.halt()}})};var f=/^(\d+?)-(\d+?)-(\d+?) (\d+?):(\d+?):(\d+?)$/;var v=/^(\d+?)-(\d+?)-(\d+?)$/;c.getDateStr=function(a){a=a instanceof Date?a:new Date(a);return c.fm("{0}-{1}-{2}",a.getFullYear(),a.getMonth()+1,a.getDate())};c.parseDate=function(a){var e;e=f.exec(a);if(e){return new Date(e[1],parseInt(e[2],10)-1,e[3],e[4],e[5],e[6])}e=v.exec(a);if(e){return new Date(e[1],parseInt(e[2],10)-1,e[3])}return null};c.addSCM=function(a,e){var i=c.segment(a);i.qs=c.fm("?{0}{1}scm={2}",i.qs,i.qs?"&":"",e);return c.fm("{0}{1}{2}",i.url,i.qs,i.hash?"#"+i.hash:"")};var h=/^(\d+)\.(\d+)\.(\d+)$/;c.compareVersion=function(a,e){if(!h.test(a)||!h.test(e)){return-2}a=h.exec(a);e=h.exec(e);a=parseInt(a[1],10)*100+parseInt(a[2],10)*10+parseInt(a[3],10);e=parseInt(e[1],10)*100+parseInt(e[2],10)*10+parseInt(e[3],10);if(a===e){return 0}else if(a<e){return-1}else if(a>e){return 1}};c.sub=function(a,e){var i=/[^\x00-\xff]/g;if(a.replace(i,"mm").length<=e)return a;e=e-3;var t=Math.floor(e/2);for(var r=t;r<a.length;r++){if(a.substr(0,r).replace(i,"mm").length>=e){return a.substr(0,r)+"..."}}return a};if(a.isFunction(l)){c.codeTracker=new l;c.codeTracker.config({numLev:13,url:"http://mallbar.tmall.com/code-tracker"})}else{c.codeTracker=l}c.getSysId=function(){var a="";var e=window.g_config.appId==1;var i=window.g_config.sysId=="list";var t=window.g_config.appId==2||window.g_config.appId==7;!!i&&(a="list");!!e&&(a="detail");!!t&&(a="shop");return a};return c},{requires:["cookie","ajax","event","dom","ua","mui/mallbar/conf","mui/minilogin","mui/code-tracker"]});window.MLoginTimer=0;window.MLoginShow=0;KISSY.add("mui/minilogin",function(e,n){var i=function(e){var n=location.hostname.split(".");return n.splice(n.length-e>0?n.length-e:0,e).join(".")}(2),o=location.hostname.indexOf(".net")>=0||location.hostname.indexOf(".com.hk")>=0,t=o?"daily.taobao.net":"taobao.com",a=o?"daily.tmall.net":"tmall.com",r=o?"daily.tmall.com.hk":"tmall.hk",l,c="assets_css=2.0.0/login_mini.css&enup_css=2.0.0/enup_mini.css",m="http"+(o?"":"s")+"://login."+t+"/member/login.jhtml?style=miniall&&enup=true&from=tmall&allp="+escape(c)+"&tpl_redirect_url=";var s={check:true,needRedirect:false,sub:false,proxy:{tmall:"http://vip."+a+"/miniLoginProxy.htm",hk:"http://www."+r+"/loginproxy.htm",yao:"http://yao.95095.com/go/rgn/95095/loginproxy.php",etao:"http://vip.daily.tmall.net/miniLoginProxy.htm"}};function d(e){var n=document.createElement("a");n.href=e;return n.hostname===location.hostname}var w={show:function(n,i){window.goldlog&&window.goldlog.send("http://log.mmstat.com/tmallmember.9.2",{});w.Analytics.MLstar=new Date*1;var o=this;if(typeof n!=="function"){i=n;n=null}i=e.merge(s,i);var t=new Date;t.setDate(t.getDate()-1);document.cookie="cookie2=;expires="+t.toGMTString()+";path=/;domain=.tmall.com";if(i.check===false){this._show(n,i)}else{this._check(function(e){w.Analytics.MLcheckStar=new Date*1;if(e){if(window.MLoginShow<=1){TB.Global&&TB.Global.updateLoginInfo()}n&&n();window.MLoginShow+=1}else{o._show(n,i)}},i)}},_checkPage:function(){return window.TB&&window.TB.userInfo&&window.TB.userInfo.isLogin},_check:function(n,i){w.Analytics.MLcheckStar=new Date*1;var o=this;var t=i.checkTimeout||5;var r=false,l=e.later(function(){if(!r){n(o._checkPage())}l&&l.cancel()},t*1e3);if(i&&i.checkApi&&i.checkApi.indexOf(".tmall.")==-1){i.checkApi=undefined}return e.io({type:"get",url:i.checkApi?i.checkApi:"http://miaoxin."+a+"/member/user_login_info2.do",success:function(e){w.Analytics.MLcheckEnd=new Date*1;e=e||{};if(e.status==1111){r=true;n(o._checkPage());return}r=true;n(e.login)},error:function(){r=true;n(o._checkPage())},timeout:t,dataType:"jsonp",charset:"utf-8",cache:false,headers:{"X-Requested-With":false}})},_show:function(o,t){w.Analytics.MLshowStar=new Date*1;window.MLoginTimer+=1;if(!!t.insert){window.MLoginTimer=0}if(window.MLoginTimer>1){return}var a,r=m,c="",s=window.location.hostname,h="";if(!!window.navigator.userAgent.match(/(TM-PD|TB-PD)/)){c=window.location.href;r=r.replace("tpl_redirect_url","redirectURL")+encodeURIComponent(c);window.location.href=r;window.MLoginTimer=0;return false}if(t.needRedirect){var f=t.redirectUrl?t.redirectUrl:location.href.split("#")[0];r+=encodeURIComponent(f)+"&full_redirect=true"}else{a="g_tml_callbak"+(new Date).getTime();window[a]=function(){var e=window.TB||{};l&&l.hide();e.Global&&e.Global.updateLoginInfo();window.MLoginTimer=0;window.MLoginShow+=1;o&&o.apply(this,arguments);try{delete window[a]}catch(n){}};if(t["proxyURL"]){c+=t["proxyURL"]}else if(s.indexOf(".hk")>=0){c+=t["proxy"]["hk"]}else if(s.indexOf("95095.com")>=0){c+=t["proxy"]["yao"]}else if(s.indexOf("95095.daily.etao.net")>=0){c+=t["proxy"]["etao"]}else{c+=t["proxy"]["tmall"]}c+=(c.indexOf("?")>0?"&":"?")+"callback="+a;if(!d(c)&&document.domain!==i){document.domain=i}if(d(c)&&document.domain===location.hostname){c+="&nsdomain=true"}r+=encodeURIComponent(c)+"&full_redirect=false"}if(t.sub){r+="&sub=true"}if(window.g_config&&window.g_config.moduleTimeStamp&&window.g_config.moduleTimeStamp.minilogin){r+="&t="+window.g_config.moduleTimeStamp.minilogin}h='<iframe class="j_minilogin_iframe"'+'style="background: #FFF; '+(!!t.insert?'"':'margin:20px 0 0 40px;"')+' width="320" scrolling="no" height="304" frameborder="no" src="'+r+'"></iframe>';if(!!t.insert){e.all(t.insert).append(h);return}l=new n({width:400,height:360,bodyContent:h,mask:true,showCat:true,zIndex:999999,align:{points:["cc","cc"]}});l.render();l.show();var u=e.version.indexOf("1.3")>=0,g=e.all(u?l.__attrVals.el:l.$el),p=u?".mui-stdmod-body":".mui-dialog-body",y=u?".mui-ext-close":".mui-dialog-close",k=g.all(".j_minilogin_iframe");k.parent(p).style("background-color","#FAFAFA");w.Analytics.MLshowEnd=new Date*1;g.all(y).on("click",function(){t.closeCallback&&t.closeCallback();window.MLoginTimer=0;l.destroy()});k.on("load",function(){w.Analytics.MLloaded=new Date*1;w.sendTrack()})},Analytics:{},sendTrack:function(){if(!window.performance||window.performance&&!window.performance.getEntriesByType){return}var e;for(var n=0,i=window.performance.getEntriesByType("resource");n<i.length;n++){if(i[n]["initiatorType"]=="iframe"&&i[n]["name"].indexOf("https://login.taobao.com/member/login.jhtml")>=0){e=i[n];break}}if(!e){return}var o=[];for(var t in e){o.push(t+"="+(t=="name"?"http://login.taobao.com":e[t]))}for(var t in w.Analytics){o.push(t+"="+w.Analytics[t])}o.push("MLtype=minilogin");var a=["[uhttp://login.tmall.com/track/0.2.0/]","[r10]"].join(""),r=document.cookie.match(/_nk_\=([^\;]*); /),l=r&&r[1]||"",c="http://gm.mmstat.com/ued.1.1.2?type=9&id=jstracker&v=0.02&nick="+encodeURIComponent(l)+"&msg="+a+escape(o.join("&"));(new Image).src=c}};return w},{requires:["mui/overlay/dialog","ajax"]});KISSY.add("mui/overlay/dialog",function(i,n){function t(n){var e=this;e.config=i.merge(t.Config,n);e.config.elCls=e.config.elCls||"";e.config.elCls+=e.config.skin?" mui-dialog-"+e.config.skin:"";if(e.config.mask){e.config.elCls+=" mui-dialog-hasmask"}t.superclass.constructor.call(this,e.config);var s=true;function o(){var n=e.get("el"),t=i.UA.ie<8?"style='height:expression(this.parentNode.clientHeight);'":"";n.append("<div class='mui-dialog-skin' "+t+"></div>"+(e.config.showCat?"<i class='mui-dialog-cat'></i>":""));s=false}if(i.version==="1.1.6"){e.on("show",function(){if(s){o()}});return}e.on("afterRenderUI",function(){o()})}t.Config={prefixCls:"mui-",showCat:true,zIndex:99999};i.extend(t,n.Dialog);return t},{requires:["overlay","mui/overlay/overlay.css","mui/button/btn.css","mui/button/btn-tb.css","mui/msg/msg.css"]});KISSY.add("mui/mallbar/model",function(a,t,e,i,r,n){var l=window.location.href.indexOf("mbar-mock-20141111=1")>-1;var o=function(a){var t=this;a=a||{};o.superclass.constructor.call(t,a);t.init()};a.extend(o,a.Base,{init:function(){var a=this},isAccessed:function(){var a=e.get(i.CK_USED);r.log("used",a,e);return a==="1"},setAccessed:function(){e.set(i.CK_USED,"1",2147483647/86400,i.DOMAIN,"/")},getServerTime:function(){var a=this;var t=a.get(i.K.TIMESTAMP);return t?new Date(t):new Date},getUid:function(a){var t=this;a=a||t.get(i.K.USERINFO);var e="";try{if(a&&a.memberInfo){e=a.memberInfo.cookies.unb.value}}catch(n){r.log("getUid error",n)}return e},getBar:function(t){var e=this;var o=false;var s=0;var m=t.mallbar||null;var c={isLogin:true,nick:"",memberInfo:{isLogin:true,availablePoints:-99,activeStatus:-99,cookies:{unb:{value:""}}}};r.log("\u5f00\u59cb\u83b7\u53d6\u7528\u6237\u6570\u636e");function b(o){clearTimeout(s);r.log("\u5df2\u83b7\u53d6\u7528\u6237\u6570\u636e memberInfoReady",o);e.set(i.K.USERINFO,o);n.set({k:i.K.FRM_USERINFO,v:o});o.isLogin&&Math.random()<i.SAM_PV&&r.sendLog(i.ARR.LOGIN1);if(window.shop_config){t.sellerNickName=window.shop_config.user_nick||""}else{t.sellerNickName=t.gConfig.sellerNickName||""}r.log("\u5f00\u59cb\u83b7\u53d6\u6846\u67b6\u6570\u636e",t);r.ajax({url:r.fm(i.URL.GET_BAR,t.shopId,i.VER,t.gConfig.bizId||"",t.gConfig.sellerId||""),data:{sellerNickName:decodeURIComponent(t.sellerNickName)},jsonpCallback:"__mallbarGetMallBar",success:function(o){r.log("\u5df2\u83b7\u53d6\u6846\u67b6\u6570\u636e",o);if(!o){r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.model.mallbarGetMallBar.get.data.empty","\u83b7\u53d6\u6846\u67b6\u6570\u636e\u4e3a\u7a7a");return}if(o.t){e.set(i.K.TIMESTAMP,o.t)}var s=o.s;if(s===i.S.BAR_SUCCESS||s===i.S.BAR_NOT_LOGIN||s===i.S.BAR_NO_MSG){s===i.S.BAR_SUCCESS&&Math.random()<i.SAM_PV&&r.sendLog(i.ARR.LOGIN2);r.getStaticConf({url:i.U.ETC[o.l.toUpperCase()],cb:function(s){if(!s.l||!s.l.length){return}var m=[];a.each(s.l,function(a){var e=l&&a.specail;if(a.on&&(!a.since||r.compareVersion(i.VER,a.since)>=0)||e){if(t.gConfig.bizId==="chaoshi"&&a.id===i.P.CART){return}a.m=0;m.push(a)}});if(!m.length){return}o.l=m;a.each(o.q,function(t){a.each(o.l,function(a){if(a.id===t.id){a.m=t.m;return false}})});n.set({k:i.K.FRM_INIT,success:function(){r.log("\u5408\u5e76\u540e\u7684\u6846\u67b6\u6570\u636e",o);e.set(i.K.BAR,o)}})}})}},error:function(n){r.log("\u83b7\u53d6\u6846\u67b6\u6570\u636e\u5931\u8d25",n);r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.model.mallbarGetMallBar.get.failure","\u83b7\u53d6\u5de5\u5177\u680f\u6846\u67b6\u4fe1\u606f\u5931\u8d25");r.getStaticConf({url:i.U.ETC["ONLINE"],cb:function(l){n=n||{};if(!l.l||!l.l.length){return}var o=[];a.each(l.l,function(a){if(a.on&&(!a.since||r.compareVersion(i.VER,a.since)>=0)){if(t.gConfig.bizId==="chaoshi"&&a.id===i.P.CART){return}a.m=0;o.push(a)}});if(!o.length){return}e.set(i.K.BAR,{l:o})}})}})}function u(a){o=true;a=a||c;r.log("\u8d85\u65f6\u5f02\u5e38\u6216\u65e0\u540a\u9876",a);b(a)}var d=window.TB;if(d&&d.Global&&d.Global.loginStatusReady&&d.Global.memberInfoReady){var f={};s=setTimeout(function(){var t=r.deepMerge(a.clone(c),t);r.log("timeout enter",t);u(t)},i.TIMEOUT_TOP);d.Global.loginStatusReady(function(a){r.log("loginStatusReady",a);f=a;m.set("token",a["tbToken"]);if(!a.isLogin){b(a)}else{d.Global.memberInfoReady(function(a){if(o){r.log("timeout quit",a);return}b(a)})}})}else{u()}var p=m.get(i.K.SHOP_CONFIG)||m.get(i.K.G_CONFIG)||{};var g="",h="",_="",v="",T="",A="";if(window.g_config&&window.g_config.itemId){g=window.g_config.itemId}h=p.userId||p.sellerId||"";_=!!p.shopId?p.shopId:"";var E=a.one(".j_CollectBrand");if(E){T=E.attr("data-brandId")||""}var I=a.one("#J_CrumbSearchForm");var C=I&&I.one('input[name="cat"]');if(C){v=C.val()}if(window.g_config){A=!!window.g_config.bizId?window.g_config.bizId:""}m.set("itemId",g);m.set("sellerId",h);m.set("shopId",_);m.set("brandId",T);m.set("category",v);m.set("bizId",A);setTimeout(function(){var a=window.devicePixelRatio>1;a&&Math.random()<i.SAM_PV&&r.sendLog(i.ARR.RETINA)},3e3)}});return o},{requires:["base","cookie","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store"]});KISSY.add("mui/mallbar/store",function(a,e,i,t){if(window.__MUI_STORAGE){return window.__MUI_STORAGE}var r;if(window.TB&&TB.Global&&TB.Global.storage){r=TB.Global.storage;i.log("TB.Global.storage",r)}else{r=new t;i.log("mallbar storage",r)}window.__MUI_STORAGE=r;return r},{requires:["mui/mallbar/conf","mui/mallbar/util","mui/storage"]});KISSY.add("mui/mallbar/item",function(t,a,e,i,n,r,l,m,o,s){var c=['<div class="mui-mbar-bubble">','<div class="mui-mbar-arr mui-mbar-bubble-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbar-bubble-close-bg"></div>','<div class="mui-mbar-bubble-bd">{0}</div>',"</div>"].join("");var b=['<div class="mui-mbar-tab-sup-bg">','<div class="mui-mbar-tab-sup-bd">{0}</div>',"</div>"].join("");var d=new r(['<div class="mui-mbar-dialog">','<div class="mui-mbar-dialog-mask"></div>','<div class="mui-mbar-dialog-bd">','  <div class="mui-mbar-dialog-tip">{{{tip}}}</div>','  <div class="mui-mbar-dialog-btn"><div class="mui-mbar-dialog-btn-txt mui-mbar-dialog-yes">\u786e\u5b9a</div></div>','   {{#if dialogType===2}}<div class="mui-mbar-dialog-btn"><div class="mui-mbar-dialog-btn-txt mui-mbar-dialog-no">\u53d6\u6d88</div></div>{{/if}}',"</div>","</div>"].join(""));var _="mui-mbar-dialog";var g="mui-mbar-dialog-bd";var p="mui-mbar-dialog-yes";var T="mui-mbar-dialog-no";var E=function(t){var a=this;E.superclass.constructor.call(a,t);a.init()};E.ATTRS={showBubble:{value:false},expand:{value:false},pgFirstVisible:{value:true},suptipNum:{value:0}};t.extend(E,a,{init:function(){var a=this;var e=a.get(m.K.MALLBAR);var i=e.get(m.K.MODEL);var r=i.get(m.K.USERINFO);var l=e.get(m.K.ITEMS);var d=a.get(m.K.DATA);var _=a.get(m.K.PLUGIN);var g=_.one(".mui-mbar-plugin-bd");var p=_.one(".mui-mbar-plugin-cover");var T=a.get(m.K.TAB);var E=a.get(m.K.BUBBLE);var u=E.one(".mui-mbar-tab-bubble-bd");var h=T.one(".mui-mbar-tab-sup");var A=T.one(".mui-mbar-tab-tip");var I=T.one(o.fm(".mui-mbar-tab-logo-{0}",d.id));var f=o.fm(".mui-mbar-tab-hover");var C=o.fm(".mui-mbar-tab-sel");var B=o.fm(".mui-mbar-tab-logo-{0}-sel",d.id);var L=0;g.on("scroll",t.buffer(function(t){var a=g.scrollTop();a>0?p.css("visibility","visible"):p.css("visibility","hidden")},100));!d.scroll&&o.noScroll(g);t.use(d.p,function(t,e){var i=new e({mallbarItem:a,container:g,pluginHead:_.one(".mui-mbar-plugin-hd"),tipContainer:_.one(".mui-mbar-plugin-hd-tip")});a.set(m.K.POBJ,i)});_.one(".mui-mbar-plugin-hd-close").on("click",function(){e.fire(m.E.STATUS_CHANGE,{status:m.S.STANDARD})});var O=0;T.on("mouseenter",function(){if(t.one(".mui-mbar").one(".mui-mbar-tabs").hasClass("mui-mbar-tabs-wide")){if(T.hasClass("mui-mbar-tab-custom")){return}}T.addClass(f);if(d.noHover||a.get(m.K.SHOW_BUBBLE)){return true}if(O){O=0}O=setTimeout(function(){if(!O){return}A.css({right:"70px",opacity:0});A.show();var t=T.width();n(A,{right:t,opacity:1},.3,"easeOut",function(){}).run()},200)}).on("mouseleave",function(){T.removeClass(f);if(d.noHover||a.get(m.K.SHOW_BUBBLE)){return true}if(O){O=0}n(A,{right:"70px",opacity:0},.3,"easeIn",function(){A.hide()}).run()}).on("click",function(){var i=a.get(m.K.POBJ);if(i&&i.needLogin){i.needLogin(n)}else{n(false)}function n(n){if(!d.noLogin&&!r.isLogin||n){a.fire(m.E.LOGIN);return}if(d.noExpand){return}if(i&&i.disableExpand&&i.disableExpand()){if(m.S.MINI===e.get(m.K.STATUS)){e.fire(m.E.STATUS_CHANGE,{status:m.S.STANDARD})}return}T.fire("mouseout");e.get(m.K.ROOT).width(_.width()+35);o.log(a.get(m.K.EXPAND));var s="";if(t.UA.firefox&&t.UA.firefox>0){s=t.one("#J_MUIMallbar").one("#J_MBarMiniCart")}if(!a.get(m.K.EXPAND)){s&&s.show();t.each(l,function(t){t.fire(m.E.VISIBILITY_CHANGE,{visible:false})});a.fire(m.E.VISIBILITY_CHANGE,{visible:true});e.fire(m.E.STATUS_CHANGE,{status:m.S.EXPAND});a.fire(m.E.BUBBLE_CHANGE,{show:false});o.sendLog(d.arr)}else{s&&s.hide();e.fire(m.E.STATUS_CHANGE,{status:m.S.STANDARD})}}});a.on(m.E.VISIBILITY_CHANGE,function(i){var r=a.get(m.K.EXPAND);_.css("zIndex",m.ZINDEX-2);T.removeClass(f);var l=T.one(".mui-mbar-tab-logo-arr")||"";if(l&&l.hasClass("mui-mbar-tab-logo-arr-show")){l.hide()}if(i.visible){I.addClass(B);T.addClass(C);d.custom&&T.css("backgroundImage","none");var o=t.one("#J_MUIMallbar").one(".tm-mcHandler");!!o&&o.css("position","relative");var l=T.one(".mui-mbar-tab-logo-arr")||"";if(l&&l.hasClass("mui-mbar-tab-logo-arr-show")){l.show()}if(!r){var s=e.get(m.K.OLD_INDEX);_.removeClass(m.C.SCALE_DOWN);_.css("top",0);_.css("zIndex",m.ZINDEX);_.css("visibility","visible");var c=a.get(m.K.INDEX);if(m.S.EXPAND===e.get(m.K.STATUS)&&s!==-1&&c!==s){_.css("top",_.height()+"px");n(_,{top:"0"},.4,"easeOut").run()}else{t.each(e.get(m.K.ITEMS),function(t){var a=t.get(m.K.PLUGIN);if(a!==_){a.css("visibility","hidden")}})}}!!o&&o.css("position","fixed")}else{I.removeClass(B);T.removeClass(C);if(r){var s=a.get(m.K.INDEX);e.set(m.K.OLD_INDEX,s);_.css("zIndex",m.ZINDEX-1);if(m.S.EXPAND===e.get(m.K.STATUS)){_.addClass(m.C.SCALE_DOWN)}}}a.set(m.K.EXPAND,i.visible)});a.on(m.E.AFTER_EXPAND_CHANGE,function(t){var e=a.get(m.K.POBJ);var i=t.newVal;var n=a.get(m.K.PG_FISRT_VISIBLE);e&&e.fire(m.E.VISIBILITY_CHANGE,{visible:i,first:n});if(n&&i){a.set(m.K.PG_FISRT_VISIBLE,false)}});a.on(m.E.SUPTIP_CHANGE,function(i){a.set(m.K.SHOW_SUPTIP,i.show);if(i.show){var n=1;if(t.isNumber(i.num)){n=i.num}else{n=a.get(m.K.SUPTIP_NUM)+1}a.set(m.K.SUPTIP_NUM,n);if(n>99){n="99"}h.html(o.fm(b,n));h.show()}else{a.set(m.K.SUPTIP_NUM,0);h.hide()}var r=a.get(m.K.POBJ);if(r&&i.show){r.fire(m.E.DATA_CHANGE)}e.fire(m.E.SUPTIP_CHANGE)});a.on(m.E.BUBBLE_CHANGE,function(i){var r=!!i.show;var l=i.showDelay||1e3;var b=!!i.customContentType?i.customContentType:"";var d=!!i.isCustomContent;var _=!!i.isNotTabFire;var g="http://gm.mmstat.com/";if(r===a.set(m.K.SHOW_BUBBLE)){return}if(r&&m.S.EXPAND===e.get(m.K.STATUS)){return}function p(){var l=a.get(m.K.BUBBLE);var p=l.one(".mui-mbar-tab-bubble-bd");if(L){clearTimeout(L);L=0}a.set(m.K.SHOW_BUBBLE,r);i.bubbleType&&a.set(m.K.BUBBLE_TYPE,i.bubbleType);if(r){var E=e.get(m.K.ITEMS);if(E){t.each(E,function(t){var a=t.get(m.K.BUBBLE);!!a&&a.hide()})}var u=e.get(m.K.STATUS);if(m.S.MINI===u){e.fire(m.E.STATUS_CHANGE,{status:m.S.STANDARD,noToClose:true})}if(m.B.FOREVER===i.bubbleType){s.set({k:m.K.FRM_STATUS,v:m.S.STANDARD})}else{L=setTimeout(function(){o.log("tmBubbleHide timeout");a.fire(m.E.BUBBLE_CHANGE,{show:false,timeout:true,cb:function(){i.dismiss&&i.dismiss();s.get({k:m.K.FRM_STATUS,success:function(t){if(m.S.MINI===t){e.fire(m.E.STATUS_CHANGE,{status:m.S.MINI})}}})}})},i.hideDelay||m.BUBBLE_HIDE_DELAY)}var h=['<div class="mui-mbar-bubble mui-mbar-bubble-flexible">','<p class="mui-mbar-bubble-flexible-title">{0}</p>','<div class="mui-mbar-arr mui-mbar-bubble-flexible-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-prof-login-close"></div>','<div class="mui-mbar-bubble-flexible-bd">{1}</div>',"</div>"].join("");if(!d&&!b){b=1}else if(d&&!b){b=3}if(b==1){var A=o.fm(c,i.html)}else if(b==2){var A=o.fm(h,i.contentTitle||"",i.html);i.height=i.height+40||"200px"}else if(b==3){var A=i.html}p.html(A);var I=p.one(".mui-mbar-bubble-close");var f=p.one(".mui-mbar-bubble");if(I){I.on("click",function(t){i.colsedClicked&&i.colsedClicked();t.stopPropagation();a.fire(m.E.BUBBLE_CHANGE,{show:false})})}if(f&&i.height){f.css("height",i.height)}l.show();n(l,{opacity:1},.3,m.EASE,function(){i.cb&&i.cb()}).run();l.detach("click");var C;l.on("click",function(a){if(i.isToForever){if(L){clearTimeout(L);L=0}}i.arrClicked&&o.sendLog(g+i.arrClicked);i.clicked&&i.clicked();if(!_){var e=f.one("a");if(e){C=e.attr("href");if(t.isString(C)&&C.indexOf("http://")>=0){window.open(C,"newwin");a.halt()}else{T.fire("click")}}else{T.fire("click")}}});if(!!i.tabMouseleave){T.on("mouseleave",function(a){var e=t.one(a.toElement||a.relatedTarget);if(e){if(!t.DOM.hasClass(e,"mui-mbar-tabs-shadow")){if(!e.parent(".mui-mbar-tab-bubble")){l.detach("click");l.hide()}}}});l.on("mouseleave",function(t){n(l,{opacity:0},.1,m.EASE,function(){l.hide()}).run()})}a.resetBubble();i.arrShowed&&o.sendLog(g+i.arrShowed);i.showed&&i.showed(l)}else{n(l,{opacity:0},.1,m.EASE,function(){l.hide();i.cb&&i.cb()}).run()}}o.getStaticConf({cb:function(t){var a="";!!window.g_config&&(a=window.g_config.shopId||"");if(t.bubbleBlacklist&&t.bubbleBlacklist.length){var e=t.bubbleBlacklist.length;var i=t.bubbleBlacklist;for(var n=0;n<e;n++){if(a==i[n]){return}}}if(r){setTimeout(p,l)}else{p()}}})});a.on(m.E.MALLBAR_STATUS_CHANGE,function(t){var e=t.status;if(m.B.FOREVER!==a.get(m.K.BUBBLE_TYPE)&&a.get(m.K.SHOW_BUBBLE)&&m.S.STANDARD!==e){a.fire(m.E.BUBBLE_CHANGE,{show:false})}if((m.S.EXPAND===e||m.S.SCREEN===e)&&!a.get(m.K.EXPAND)){u.hide()}else{u.show()}});a.on(m.E.ERROR,function(t){var a="\u554a\u54e6\uff0c\u597d\u50cf\u6709\u70b9\u95ee\u9898";if(t&&t.tip){a=t.tip}g.html('<div class="mui-mbar-plugin-err">'+a+"</div>")});a.on(m.E.LOGIN,function(t){var a=e.get(m.K.ITEMS)[m.P.PROF];a.get(m.K.POBJ).fire(m.E.PROF_CHANGE,{toLogin:1,pid:d.id,success:t.success})});a.on(m.E.FLYIN_END,function(t){var e=a.get(m.K.POBJ);e&&e.fire(m.E.DATA_CHANGE)});a.on(m.E.PAGE_VISIBILITY_CHANGE,function(t){var e=a.get(m.K.POBJ);e&&e.fire(t.type,{pageVisible:t.pageVisible})});if(d.m>0){a.fire(m.E.SUPTIP_CHANGE,{show:true,num:d.m})}},getUserInfo:function(){var t=this;return t.get(m.K.MALLBAR).get(m.K.MODEL).get(m.K.USERINFO)},setUserInfo:function(t){var a=this;var e=a.get(m.K.MALLBAR).get(m.K.MODEL).get(m.K.USERINFO);e=o.deepMerge(e,t);s.set({k:m.K.FRM_USERINFO,v:e})},getUid:function(){var t=this;return t.get(m.K.MALLBAR).get(m.K.MODEL).getUid()},expand:function(){var t=this;var a=t.get(m.K.TAB);if(!t.get(m.K.EXPAND)){a.fire("click")}},getShopConfig:function(){var t=this;return t.get(m.K.MALLBAR).get(m.K.SHOP_CONFIG)},getGConfig:function(){var t=this;return t.get(m.K.MALLBAR).get(m.K.G_CONFIG)},resetBubble:function(){var t=this;var a=t.get(m.K.TAB);var e=t.get(m.K.BUBBLE);e.offset({top:a.offset().top})},getOrigin:function(){var a=this;var e=a.get(m.K.MALLBAR);var i=e.get(m.K.STATUS);var n=e.get(m.K.ROOT);var r=a.get(m.K.TAB);var l=r.offset();var o;if(i==m.S.EXPAND){o=t.DOM.viewportWidth()-n.width()}else{o=t.DOM.viewportWidth()-r.width()}var s={x:o,y:l.top-t.one(window).scrollTop()};return s},getPoint:function(){var t=this;var a=t.get(m.K.MALLBAR);var e=t.get(m.K.TAB);var i=t.getOrigin();var n={x:e.width()/2+i.x,y:e.width()/2+i.y};if(m.S.MINI===a.get(m.K.STATUS)){a.fire(m.E.STATUS_CHANGE,{status:m.S.STANDARD})}return n},getServerTime:function(){var t=this;return t.get(m.K.MALLBAR).get(m.K.MODEL).getServerTime()},dialog:function(a){var e=this;var i=e.get(m.K.PLUGIN);i.append(t.all(d.render(a)));var n=i.one("."+_);var r=n.one("."+g);var l=n.one("."+p);var s=n.one("."+T);n.show();n.width(i.width());n.height(i.height());r.css("top",(i.height()-r.height())/2+"px");o.log(i.width(),i.height(),n.width(),n.height());function c(t){n.remove();a.callback&&a.callback(t)}l.on("click",function(){c(true)});s&&s.on("click",function(){c(false)})},alert:function(t){var a=this;t.dialogType=1;a.dialog(t)},confirm:function(t){var a=this;t.dialogType=2;a.dialog(t)},getTabName:function(){var t=this;var a=t.get(m.K.MALLBAR);var e=a.get(m.K.MODEL);var i=t.get(m.K.INDEX);var n=e.get(m.K.BAR);var r="";!!n&&n.l&&(r=n.l[i].id);return r}});return E},{requires:["base","event","node","anim","xtemplate","mui/minilogin","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store"]});KISSY.add("mui/mallbar/guide",function(t,a,m,e){var n,l=false,i;var o=function(a){var m=this;m.config=t.merge(o.config,a);m._init()};o.config={picBox:[{src:"http://gtms01.alicdn.com/tps/i1/T11E.AFzxXXXa.AtHl-250-300.png"},{src:"http://gtms02.alicdn.com/tps/i2/T15b3zFuVaXXa.AtHl-250-300.png"},{src:"http://gtms03.alicdn.com/tps/i3/T1mZonFvVeXXa.AtHl-250-300.png"},{src:"http://gtms04.alicdn.com/tps/i4/T1zygsFp0dXXa.AtHl-250-300.png"},{src:"http://gtms01.alicdn.com/tps/i1/T1Hf3tFzpcXXa.AtHl-250-300.png"},{src:"http://gtms02.alicdn.com/tps/i2/T1zKAnFqJeXXa.AtHl-250-300.png"},{src:"http://gtms02.alicdn.com/tps/i2/T1AvIuFuhcXXa.AtHl-250-300.png"},{src:"http://gtms03.alicdn.com/tps/i3/T1pHUAFDFXXXa.AtHl-250-300.png"},{src:"http://gtms04.alicdn.com/tps/i4/T1tR3sFCNcXXa.AtHl-250-300.png"},{src:"http://gtms01.alicdn.com/tps/i1/T1sKsrFx4dXXa.AtHl-250-300.png"},{src:"http://gtms02.alicdn.com/tps/i2/T1z7crFw8dXXa.AtHl-250-300.png"},{src:"http://gtms03.alicdn.com/tps/i3/T1A0ZAFDBXXXa.AtHl-250-300.png"},{src:"http://gtms04.alicdn.com/tps/i4/T1SpMBFABXXXa.AtHl-250-300.png"},{src:"http://gtms01.alicdn.com/tps/i1/T1jrUAFEXXXXa.AtHl-250-300.png"},{src:"http://gtms02.alicdn.com/tps/i2/T1NEUrFqXdXXa.AtHl-250-300.png"},{src:"http://gtms03.alicdn.com/tps/i3/T1WvIAFC4XXXa.AtHl-250-300.png"},{src:"http://gtms04.alicdn.com/tps/i4/T1x5ZtFwRcXXa.AtHl-250-300.png"},{src:"http://gtms01.alicdn.com/tps/i1/T17tsAFEdXXXa.AtHl-250-300.png"},{src:"http://gtms03.alicdn.com/tps/i3/T15cBaFTRXXXbw.PjB-284-35.png"}],picBoxIE:[{src:"http://gtms01.alicdn.com/tps/i1/T11E.AFzxXXXa.AtHl-250-300.png"},{src:"http://gtms02.alicdn.com/tps/i2/T15b3zFuVaXXa.AtHl-250-300.png"},{src:"http://gtms03.alicdn.com/tps/i3/T1mZonFvVeXXa.AtHl-250-300.png"},{src:"http://gtms04.alicdn.com/tps/i4/T1zygsFp0dXXa.AtHl-250-300.png"},{src:"http://gtms01.alicdn.com/tps/i1/T1Hf3tFzpcXXa.AtHl-250-300.png"},{src:"http://gtms02.alicdn.com/tps/i2/T1zKAnFqJeXXa.AtHl-250-300.png"},{src:"http://gtms03.alicdn.com/tps/i3/T15cBaFTRXXXbw.PjB-284-35.png"},{src:"http://gtms02.alicdn.com/tps/i2/T1XTktFzlcXXa.AtHl-250-300.png"},{src:"http://gtms03.alicdn.com/tps/i3/T1hHwvFrVcXXa.AtHl-250-300.png"}],AnimateTimeLine:[{lineName:"line-bent",startLine:{X:"127",Y:"229",Cx1:"127",Cy1:"229",Cx2:"127",Cy2:"229",X2:"127",Y2:"229"},animateTime:"0.5"},{lineName:"line-stretch",startLine:{X:"83",Y:"593",Cx1:"265",Cy1:"584",Cx2:"104",Cy2:"274",X2:"127",Y2:"229",X3:"67",Y3:"251"},animateTime:"0.5"},{lineName:"shake",startLine:{X:"83",Y:"593",Cx1:"83",Cy1:"593",Cx2:"125",Cy2:"229",X2:"124",Y2:"232",X3:"251",Y3:"121"},animateTime:"0.03"},{lineName:"up-vertical",startLine:{X:"83",Y:"593",Cx1:"83",Cy1:"593",Cx2:"125",Cy2:"229",X2:"124",Y2:"232",X3:"100",Y3:"121",M:"1.5"},animateTime:"0.01"},{lineName:"throw-out",startLine:{X:"67",Y:"320",Cx1:"180",Cy1:"100",Cx2:"398",Cy2:"80",X2:"157",Y2:"113",M:"90",X5:"50"},endLine:{X:"432",Y:"69",Cx1:"300",Cy1:"100",Cx2:"500",Cy2:"180",X2:"324",Y2:"24",M:"120",X5:"110"},animateTime:"1"}],isMask:false,callback:false};o.prototype={_init:function(){var m=this,l=!!(t.UA.ie<=8);if(!l){m._imagesLoad(m.config.picBox,function(){var e;if(m.config.isMask){e='<div class="mui-mbar-animate-mask-bg"></div>'}else{e=""}var l=[e,'<canvas width="300" height="600" id="J_animate-canvas" class="mui-mbar-animate-canvas mui-mbar-guide"></canvas>'].join("");a(l).appendTo(t.one("body"));n=t.get(".mui-mbar-animate-canvas").getContext("2d");n.webkitImageSmoothingEnabled=true;t.getScript("http://g.tbcdn.cn/tm/act/1.10.36/??mazi/ShoppingCartAnimate/TweenLite.js",function(){m._catAnimate()})})}else{m._imagesLoad(m.config.picBoxIE,function(){var a;if(m.config.isMask){a='<div class="mui-mbar-animate-mask-bg"></div>'}else{a=""}var n=[a,'<div class="mui-mbar-animate-box mui-mbar-guide">','<img class="mui-mbar-animate-cat" src="http://img03.taobaocdn.com/tps/i3/T1ouJHXndmXXXXXXXX-1-1.gif" width="250" height="300" alt=""/>','<div class="mui-mbar-animate-buy"><img  src="http://gtms03.alicdn.com/tps/i3/T15cBaFTRXXXbw.PjB-284-35.png" width="284" height="35"/></div>',"<div>"].join("");t.one("body").append(n);var l=e.viewportWidth(),i=e.viewportHeight();t.one(".mui-mbar-animate-mask-bg")&&t.one(".mui-mbar-animate-mask-bg").css({width:l+"px",height:i+"px"});m._catAnimateIE()})}},_catAnimate:function(){var t=this;var a=0;var m=setInterval(function(){if(a<6){n.clearRect(0,0,300,600);n.beginPath();n.drawImage(t.config.picBox[18].Dom,15,566,284,35);n.drawImage(t.config.picBox[a].Dom,50,0,250,300)}else{setTimeout(function(){n.clearRect(0,0,300,600);n.beginPath();n.drawImage(t.config.picBox[18].Dom,15,566,284,35);setTimeout(function(){t._catPole(a)},0)},500);clearInterval(m)}a++},150)},_catPole:function(t){var a=this;var m=setInterval(function(){if(t<11){n.clearRect(0,0,300,600);n.beginPath();n.drawImage(a.config.picBox[18].Dom,15,566,284,35);n.drawImage(a.config.picBox[t].Dom,50,0,250,300)}else{clearInterval(m);a._pushLineAnimate()}t++},100)},_pushLineAnimate:function(){var a=this,m=0,e,l,i,o,r;n.lineWidth=1;e=a.config.AnimateTimeLine[m].startLine;l=a.config.AnimateTimeLine[m+1].startLine;o=a.config.AnimateTimeLine[m].animateTime;TweenLite.to(e,o,t.merge(l,{onUpdate:function(){n.clearRect(0,0,300,600);n.beginPath();n.moveTo(e.X,e.Y);n.bezierCurveTo(e.Cx1,e.Cy1,e.Cx2,e.Cy2,e.X2,e.Y2);n.stroke();n.drawImage(a.config.picBox[18].Dom,15,566,284,35);n.drawImage(a.config.picBox[11].Dom,50,0,250,300)},onComplete:function(){i=a.config.AnimateTimeLine[m+2].startLine;r=m+1;a._lineStraightenAnimate(l,i,r)}}))},_lineStraightenAnimate:function(a,m,e){var i=this,o=i.config.AnimateTimeLine[e].animateTime;TweenLite.to(a,o,t.merge(m,{onUpdate:function(){n.clearRect(0,0,300,600);n.beginPath();n.moveTo(a.X,a.Y);n.bezierCurveTo(a.Cx1,a.Cy1,a.Cx2,a.Cy2,a.X2,a.Y2);n.stroke();n.drawImage(i.config.picBox[18].Dom,15,566,284,35);n.drawImage(i.config.picBox[12].Dom,50,0,250,300)},onComplete:function(){var t=0;l=false;e+=1;var a=setInterval(function(){t++;if(t>5&&l==true){clearInterval(a);setTimeout(function(){i._upAnimate(e)},300)}else{var n=i.config.AnimateTimeLine[e+1].startLine;i._shakeAnimate(m,n,e)}},200)}}))},_shakeAnimate:function(a,m,e){var i=this,o=i.config.AnimateTimeLine[e].animateTime;TweenLite.to(a,o,t.merge(m,{onUpdate:function(){n.clearRect(0,0,300,600);n.beginPath();n.moveTo(a.X,a.Y);n.bezierCurveTo(a.X,a.Y,a.X2,a.Y2,a.X2,a.Y2);n.stroke();n.drawImage(i.config.picBox[14].Dom,50,0,250,300);n.save();n.rotate(1.5*Math.PI/180);n.drawImage(i.config.picBox[18].Dom,30,559,284,35);n.restore()},onComplete:function(){TweenLite.to(m,o,t.merge(a,{onUpdate:function(){n.clearRect(0,0,300,600);n.beginPath();n.moveTo(a.X,a.Y);n.bezierCurveTo(a.X,a.Y,a.X2,a.Y2,a.X2,a.Y2);n.stroke();n.drawImage(i.config.picBox[12].Dom,50,0,250,300);n.save();n.rotate(Math.PI/180);n.drawImage(i.config.picBox[18].Dom,24,562,284,35);n.restore()},onComplete:function(){l=true}}))}}))},_upAnimate:function(a){var m=this,e=m.config.AnimateTimeLine[a+1].startLine,l=m.config.AnimateTimeLine[a+2].startLine,i=m.config.AnimateTimeLine[a+1].animateTime;TweenLite.to(e,i,t.merge(l,{onUpdate:function(){n.clearRect(0,0,300,600);n.beginPath();n.moveTo(e.X,e.Y);n.bezierCurveTo(e.Cx1,e.Cy1,e.Cx2,e.Cy2,157,113);n.stroke();n.drawImage(m.config.picBox[15].Dom,50,0,250,300);n.save();n.translate(e.X,e.Y);n.rotate(e.M*Math.PI/180);n.drawImage(m.config.picBox[18].Dom,-81,0,284,35);n.restore()},onComplete:function(){a+=2;m._throwAnimate(a)}}))},_throwAnimate:function(a){var m=this,l=m.config.AnimateTimeLine[a].startLine,i=m.config.AnimateTimeLine[a].endLine,o=m.config.AnimateTimeLine[a].animateTime;TweenLite.to(l,o,t.merge(i,{onUpdate:function(){n.clearRect(0,0,300,600);n.beginPath();n.moveTo(l.X,l.Y);n.bezierCurveTo(l.Cx1,l.Cy1,l.Cx2,l.Cy2,324,24);n.stroke();if(l.X5>90){n.drawImage(m.config.picBox[16].Dom,l.X5,0,250,300)}else{n.drawImage(m.config.picBox[17].Dom,l.X5,0,250,300)}n.save();n.translate(l.X,l.Y);n.rotate(l.M*Math.PI/180);n.drawImage(m.config.picBox[18].Dom,-81,0,284,35);n.restore()},onComplete:function(){n.clearRect(0,0,300,600);e.remove(".mui-mbar-animate-mask-bg");e.remove(".mui-mbar-animate-canvas");if(t.isFunction(m.config.callback)){m.config.callback()}}}))},_catAnimateIE:function(){var a=this,m=0;i=t.one(".mui-mbar-animate-cat");var e=setInterval(function(){if(m<6){i.attr("src",a.config.picBox[m].src)}else{setTimeout(function(){a._buyAnimateIE()},500);clearInterval(e)}m++},150)},_buyAnimateIE:function(){var a=this,m=t.one(".mui-mbar-animate-buy");i.attr("src",a.config.picBoxIE[8].src);m.stop().animate({width:"34px",height:"34px",right:"100px"},.5,"elasticBoth",function(){i.attr("src",a.config.picBoxIE[7].src);m.stop().animate({bottom:"334px",right:"110px"},1,"elasticIn",function(){i.attr("src",a.config.picBoxIE[8].src);setTimeout(function(){var e=setInterval(function(){if(parseInt(m.css("right"))>-250){var n=10;m.css("right",parseInt(m.css("right"))-n);i.css("right",parseInt(i.css("right"))-n)}else{clearInterval(e);t.one(".mui-mbar-animate-mask-bg")&&t.one(".mui-mbar-animate-mask-bg").remove();t.one(".mui-mbar-animate-box")&&t.one(".mui-mbar-animate-box").remove();t.isFunction(a.config.callback)&&a.config.callback()}},10)},500)})})},_imagesLoad:function(t,a,m){var e=this;m=m||0;if(t[m]){e._imgLoad(t[m],function(){e._imagesLoad(t,a,m+1)})}else{a(m)}},_imgLoad:function(t,a){var m=new Image;m.src=t;if(m.complete){t.Dom=m;a();return}m.onload=function(){t.Dom=m;a()};m.src=t.src}};window.catAnimate=o;return o},{requires:["node","event","dom","mui/mallbar/mallbar-guide.css"]});KISSY.add("mui/mallbar/plugin/prof",function(a,e,i,t,r,s,n,o,l,m,u,c){var b=new u(['<div class="mui-mbarp-prof-tip mui-mbarp-prof-tip-login"></div>','<a class="mui-mbarp-prof-login-close"></a>','<div class="mui-mbar-arr mui-mbarp-prof-arr mui-mbarp-prof-arr-login">\u25c6</div>'].join(""));var d=['<div class="mui-mbarp-prof-tip">','<div class="mui-mbarp-prof-hd">',"</div>",'<div class="mui-mbarp-prof-bd">','  <div class="mui-mbarp-prof-icon-bd">','    {{#if iconUrl}}<img class="mui-mbarp-prof-icon" src="{{iconUrl}}" />{{else}}','    <div class="mui-mbarp-prof-icon-def"></div>{{/if}}','    <div class="mui-mbarp-prof-icon-edit-mask"></div>',"    <div class=\"mui-mbarp-prof-icon-edit\"><a target=\"_blank\" href=\"http://i.taobao.com/user/headset.htm?scm=1048.1.2.10\" onclick=\"_czc.push(['_trackEvent','\u6211','\u7f16\u8f91','\u5df2\u767b\u5f55','10481210'])\">\u7f16\u8f91</a></div>",'{{#if level>0}}<span class="mui-mbarp-prof-icon-level">T{{level}}</span>{{/if}}',"  </div>",'  <div class="mui-mbarp-prof-lv-bd">','    <div class="mui-mbarp-prof-lv-tl">Hi, <a target="_blank" href="{{vip}}">{{nick}}</a></div>','  {{#if level>0}} {{#if showT4>0}}<a target="_blank" href="{{vip}}">\u606d\u559c\uff0c\u60a8\u5347\u7ea7\u4e3a <span class="mui-mbarp-prof-lv-num">T{{level}}</span> \u4f1a\u5458</a>{{else}}<a target="_blank" href="{{vip}}">\u60a8\u662f <span class="mui-mbarp-prof-lv-num">T{{level}}</span> \u4f1a\u5458</a>{{/if}}','  {{else}}{{#if level>DEGRADE}}<a target="_blank" href="http://vip.tmall.com/vip/index.htm?layer=activation?scm=1048.1.2.22" class="mui-mbarp-prof-tovip">\u6fc0\u6d3b\u4e3a\u5929\u732b\u4f1a\u5458&gt;</a>{{/if}}',"  {{/if}}",'  {{#if showT4>0}}<p class="mui-mbarp-prof-t4-notice"><a class="mui-mbarp-prof-vip-4-to-right" target="_blank" href="http://vip.tmall.com/privilege/all?scm=1048.1.2.21">\u67e5\u770b\u6211\u7684\u6743\u76ca&gt;</a></p>{{/if}}',"  </div>","{0}",'  <div class="mui-mbarp-prof-sep"></div>','  <div class="mui-mbarp-prof-right-cont">','     <div class="mui-mbarp-prof-right-hd"></div>','     <div class="mui-mbarp-prof-right-bd"></div>',"  </div>","</div>","</div>",'<div class="mui-mbar-arr mui-mbarp-prof-arr">\u25c6</div>'].join("");var p="";var f=['<div class="mui-mbarp-prof-ci-bd">',' <div class="mui-mbarp-prof-ci-tl">\u7b7e\u5230\uff1a</div>'," <a class=\"mui-mbarp-prof-ci\" target=\"_blank\" href=\"http://vip.tmall.com?signIn=true&scm=1048.1.2.23\" onclick=\"_czc.push(['_trackEvent','\u6211','\u8d62\u79ef\u5206','\u5df2\u767b\u5f55','1048123'])\">\u8d62\u79ef\u5206</a>","<a class=\"mui-mbarp-prof-ci\" style=\"margin-left:4px;\" target=\"_blank\" href=\"http://ka.tmall.com?scm=1048.1.2.24\" onclick=\"_czc.push(['_trackEvent','\u6211','\u9886\u70b9\u5238','\u5df2\u767b\u5f55','1048124'])\">\u9886\u70b9\u5238</a>"," </div>"].join("");var v=['<div class="mui-mbarp-prof-ci-bd">','<a class="mui-mbarp-prof-user-get" target="_blank" href="http://vip.tmall.com/act/gift/newgift?scm=1048.1.2.12" >\u9886\u65b0\u4eba\u7ea2\u5305></a>',"  </div>"].join("");var h="mui-mbarp-prof-tip";var g=160;var _=0;var T=2;var A=false;var I=function(a){var e=this;I.superclass.constructor.call(e,a);e.init()};a.extend(I,i,{rightConfig:[{bizId:"vip",isDefault:true,name:"\u4f1a\u5458\u6743\u76ca"}],init:function(){var e=this;var i=e.mallbarItem=e.get(o.K.MALLBAR_ITEM);var r=i.get(o.K.MALLBAR);var s=r.get(o.K.ROOT);var c=i.get(o.K.TAB);var f=a.all('<div class="mui-mbarp-prof"></div>').appendTo(s);var v=i.getUserInfo();this.prof=f;var T=c.one(".mui-mbar-tab-tip");function A(){if(v.isLogin){var e=i.getUid();if(e){var t=l.fm(o.AVATAR,e,g);var r=new Image;r.onload=function(e){c.one(".mui-mbar-tab-logo-prof-def").hide();a.one(l.fm('<div class="mui-mbar-tab-logo-prof-nick-bd"><img class="mui-mbar-tab-logo-prof-nick" src="{0}" /></div>',t)).insertBefore(T)};a.one(l.fm('<div class="mui-mbar-tab-logo-prof-def"></div>')).insertBefore(T);r.src=t}}}if(v.isLogin){e._initT0User()}A();a.one(document).on("click",function(a){f.hide();if(_!=3&&v.isLogin){e._updateRedDot()}});var I=false;c.on("mouseenter",function(i){l.log("prof tab mouseenter");I=true;a.later(function(){if(I){e.fire(o.E.PROF_CHANGE,{pid:o.P.PROF});T.hide()}},400)});c.on("mouseleave",function(i){I=false;var r=a.one(i.toElement||i.relatedTarget);if(r){if(!t.hasClass(r,"mui-mbar-tabs-shadow")){if(!r.parent(".mui-mbarp-prof")){f.hide();if(_!=3&&v.isLogin){e._updateRedDot()}}}}});c.on("click",function(){if(v.isLogin){f.css("display")==="none"&&l.sendLog(o.ARR.PROF);f.show();if(_czc){_czc.push(["_trackEvent","\u6211","\u9f20\u6807\u70b9\u51fb","\u5df2\u767b\u5f55"])}}});var C=document.createElement("script");C.src="http://w.cnzz.com/c.php?id=1000279581&async=1";C.type="text/javascript";C.async=true;C.charset="utf-8";var E=document.getElementsByTagName("body")[0];E.appendChild(C);var L=document.createElement("script");L.text='var _czc=_czc || []; _czc.push(["_setAccount","1000279581"]);';document.body.appendChild(L);e.on(o.E.PROF_HIDE,function(){f.hide()});e.on(o.E.RIGHT_TAB_ITEM_CLICK,function(e){var i=a.one(".mui-mbarp-prof-right-hd-tab-item-"+e.bizId)||"";!!i&&i.fire("click")});var B=false;var w=v.memberInfo.activeStatus;if(w>o.DEGRADE&&w<1){var R=c.one(".mui-mbar-tab-sup");R.html('<div class="mui-mbar-iconfont mui-mbar-prof-reddot">&#xe603;</div>');R.show();S()}else if(w==4){m.get({k:"mui/mbar/prof/t4/show"+i.getUid(),success:function(a){if(a!=1){B=true;var e=c.one(".mui-mbar-tab-sup");e.html('<div class="mui-mbar-iconfont mui-mbar-prof-reddot">&#xe603;</div>');e.show();S()}else{S()}},error:function(){S()}})}else{S()}function S(){e._initMarketMods(function(){e._initRightData();var c=true;e.on(o.E.PROF_CHANGE,function(T){if(v.isLogin){if(c){c=false;var I=i.getUid();var C={DEGRADE:o.DEGRADE,nick:v.nick,loginUrl:o.DEBUG?"http://login.daily.taobao.net/member/logout.jhtml":"http://login.taobao.com/member/logout.jhtml",curl:encodeURIComponent(location.href),level:v.memberInfo.activeStatus,iconUrl:I?l.fm(o.AVATAR,I,g):"",vip:"http://vip.tmall.com?scm="+o.SCM.PROF,showT4:0};l.log("me.profDo",C);var E=function(r){p=l.fm(d,e.profDo);f.html(new u(p).render(r));if(r.showT4){a.one(".mui-mbarp-prof-ci-bd").hide();a.one(".mui-mbarp-prof-vip-4-to-right").on("click",function(){m.set({k:"mui/mbar/prof/t4/show"+i.getUid(),v:1})})}e._initRight();var s=f.one(".mui-mbarp-prof-icon-edit");var n=f.one(".mui-mbarp-prof-icon-edit-mask");f.one(".mui-mbarp-prof-icon-bd").on("mouseenter",function(){s.show();n.show()});f.on("mouseleave",function(){s.hide();n.hide()});f.one(".mui-mbarp-prof-tip").on("mouseleave",function(i){var r=a.one(i.toElement||i.relatedTarget);if(t.hasClass(r,"mui-mbar-tabs-shadow")||t.hasClass(r,"mui-mbarp-prof-arr")){f.show()}else{f.hide();if(_!=3&&v.isLogin){e._updateRedDot()}}})};if(v.memberInfo.activeStatus>3){if(B){C.showT4=1}}E(C)}}var L=s.one(".mui-mbar-tab-logo-"+T.pid);var w=a.DOM.height(L);var R=parseFloat(L.parent().offset().top-t.scrollTop())+w/3.8;var S=a.DOM.viewportHeight();if(S-R<272){R=R-272+w+1;f.addClass("mui-mbarp-prof-bottom-arrow")}else{f.removeClass("mui-mbarp-prof-bottom-arrow")}if(L){f.css({top:R});if(o.P.CART===T.pid&&o.S.MINI===r.get(o.K.STATUS)){f.css({left:-L.parent().width()+"px"})}else{f.css({left:0})}}if(T.toLogin||!v.isLogin){f.html(b.render());var O=f.one(".mui-mbarp-prof-login-close");f.one(".mui-mbarp-prof-tip").on("mouseleave",function(e){var i=a.one(e.toElement||e.relatedTarget);if(i){if(!t.hasClass(i,"mui-mbar-tabs-shadow")){if(!i.parent(".mui-mbarp-prof")){f.hide()}}}});O.on("click",function(a){f.hide()});n.show(function(){f.hide();TB.Global.loginStatusReady(function(a){TB.Global.memberInfoReady(function(a){l.log("minilogin memberInfoReady",a);v=l.deepMerge(v,a);v.isLogin=true;i.setUserInfo(v);e._initT0User();T.success&&T.success();r.broadcast(o.E.LOGIN_SUCCESS);A();if(o.P.PROF===T.pid){e.fire(o.E.PROF_CHANGE,{pid:o.P.PROF})}else{v.isLogin&&r.expand({type:T.pid})}})})},{insert:"."+h,needRedirect:false,check:false});l.sendLog(o.ARR.PROF_LOGIN);if(_czc){_czc.push(["_trackEvent","\u6211","\u9f20\u6807\u79fb\u8fc7","\u672a\u767b\u5f55"])}f.show()}else{f.css("display")==="none"&&l.sendLog(o.ARR.PROF);if(_czc){_czc.push(["_trackEvent","\u6211","\u9f20\u6807\u79fb\u8fc7","\u5df2\u767b\u5f55"])}f.show()}})})}},_initRight:function(){if(!this.rightConfig){return}this._initRightCont()},_initRightCont:function(){var e=this;var i=this.prof;var t=i.one(".mui-mbarp-prof-right-hd");var r=i.one(".mui-mbarp-prof-right-bd");var s='<li class="mui-mbarp-prof-right-hd-tab-item mui-mbarp-prof-right-hd-tab-item-{bizId}" data-type="{bizId}">{name}<b></b></li>';var n='<div class="mui-mbarp-prof-right-hd-tab-cont mui-mbarp-prof-right-hd-tab-cont-{bizId}" data-type="{bizId}">{content}</div>';var o='<ul class="mui-mbarp-prof-right-hd-tab">';var l="";a.each(this.rightConfig,function(e){o=o+a.substitute(s,e);l=l+a.substitute(n,e)});o=o+"</ul>";t.html(o);r.html(l);a.each(this.rightConfig,function(i){if(!i.isDefault){e[i.bizId].fire("bindRightDetail");e[i.bizId].on("rightChange",function(e){a.one(".mui-mbarp-prof-right-hd-tab-cont-"+i.bizId).html(e.rightDetail)})}});this._bindRightTab();this._initMemberRight();a.one(".mui-mbarp-prof-right-hd-tab-item-vip").fire("click");if(this.rightList){a.each(this.rightList,function(a){e[a.bizId].fire("rightTabClick")})}},_initMemberRight:function(){var e=["00000000","01110110","01111110","01111111","11111111"];var i=[{code:"&#xe616;",id:"wuyou",rightUrl:"http://vip.tmall.com/privilege/wuyou?scm=1048.1.2.13",rightName:"\u552e\u540e\u65e0\u5fe7"},{code:"&#xe610;",id:"birthday",rightUrl:"http://vip.tmall.com/privilege/birthday?scm=1048.1.2.14",rightName:"\u751f\u65e5\u7279\u6743"},{code:"&#xe60f;",id:"returned",rightUrl:"http://vip.tmall.com/privilege/returned?scm=1048.1.2.15",rightName:"\u9000\u8d27\u4fdd\u969c\u5361"},{code:"&#xe614;",id:"brand",rightUrl:"http://vip.tmall.com/privilege/brand?scm=1048.1.2.16",rightName:"\u54c1\u724c\u4e13\u4eab"},{code:"&#xe611;",id:"speedReturned",rightUrl:"http://vip.tmall.com/privilege/speedReturned?scm=1048.1.2.17",rightName:"\u6781\u901f\u9000\u6b3e"},{code:"&#xe615;",id:"fenqi",rightUrl:"http://vip.tmall.com/privilege/fenqi?scm=1048.1.2.18",rightName:"\u5929\u732b\u5206\u671f"},{code:"&#xe613;",id:"ftry",rightUrl:"http://vip.tmall.com/privilege/ftry?scm=1048.1.2.19",rightName:"\u5148\u8bd5\u540e\u4e70"},{code:"&#xe612;",id:"firstSerive",rightUrl:"http://vip.tmall.com/privilege/firstSerive?scm=1048.1.2.20",rightName:"\u5ba2\u670d\u4f18\u5148"}];var t=this.get(o.K.MALLBAR_ITEM);var r=t.getUserInfo();var s=r.memberInfo.activeStatus;if(s>=0){a.each(i,function(a,i){if(e[s].charAt(i)==1){a.rightOwn="mui-mbarp-prof-vip-right-own"}})}var n=a.one(".mui-mbarp-prof-right-hd-tab-cont-vip");var l='<div class="mui-mbarp-prof-vip-right-item mui-mbarp-prof-vip-right-item-{id} {rightOwn}">                    <a href="{rightUrl}" target="_blank">                        <p class="mui-mbar-iconfont mui-mbarp-prof-vip-right-icon">{code}</p>                        <p>{rightName}</p>                    </a>                </div>';var m='<div class="mui-mbarp-prof-vip-right-slide">                <div class="mui-mbarp-prof-vip-right-slide-cont">';a.each(i,function(e,i){m=m+a.substitute(l,e)});m=m+'</div><span class="mui-mbar-iconfont mui-mbarp-prof-vip-right-slide-prev">&#xe602;</span><span class="mui-mbar-iconfont mui-mbarp-prof-vip-right-slide-next">&#xe601;</span></div>';n.html(m);setTimeout(function(){var e=new c(a.one(".mui-mbarp-prof-vip-right-slide"),{effect:"hSlide",autoSlide:false,contentClass:"mui-mbarp-prof-vip-right-slide-cont",pannelClass:"mui-mbarp-prof-vip-right-item",carousel:true,colspan:3,speed:500});a.one(".mui-mbarp-prof-vip-right-slide-prev").on("click",function(){e.previous()});a.one(".mui-mbarp-prof-vip-right-slide-next").on("click",function(){e.next()})},0)},_bindRightTab:function(){var e=a.one(".mui-mbarp-prof-right-cont");e.delegate("click",".mui-mbarp-prof-right-hd-tab-item",function(i){var t=a.one(i.currentTarget);var r=t.attr("data-type");var s=e.one(".mui-mbarp-prof-right-hd-tab-cont-"+r);t.siblings().removeClass("sellected");t.addClass("sellected");s.siblings().hide();s.show()})},_initRightData:function(){var e=this;a.each(this.rightList,function(a){e.rightConfig.push(a)});a.each(this.rightConfig,function(a){if(!a.isDefault){var i=e[a.bizId].getRightDetail();a.content=i.html||"";a.isVisible=i.isVisible||""}})},_initMarketMods:function(e){var i=this;var t=this.get(o.K.MALLBAR_ITEM);var r=t.get(o.K.MALLBAR);l.getStaticConf({cb:function(t){var s=t.marketMods;if(s&&s.length>0){i.rightList=s;var n=s.length;var o=0;a.each(s,function(t){if(a.Env.mods[t.moduleName]){a.use(t.moduleName,function(a,s){i[t.bizId]=new s({mallbar:r,Util:l,Store:m,rightDetailContCls:"mui-mbarp-prof-right-hd-tab-cont-"+t.bizId});o=o+1;if(n==o){e&&e()}})}else{s=[];e&&e()}})}else{s=[];e&&e()}}})},_initT0User:function(){var a='<div class="mui-mbar-bubble mui-mbar-bubble-flexible">                    <p class="mui-mbar-bubble-flexible-title"></p>                    <div class="mui-mbar-arr mui-mbar-bubble-flexible-arr">\u25c6</div>                    <div class="mui-mbar-bubble-close mui-mbarp-prof-login-close"></div>                    <div class="mui-mbar-bubble-flexible-bd">                        <div class="mui-mbarp-prof-user-bubble-cont">                            <img class="mui-mbarp-prof-user-bubble-img" src="{2}" width="90" height="90"/>                            <div class="mui-mbarp-prof-user-bubble-notice">                                <p>Hi\uff0c{0}</p>                                <p>\u606d\u559c\u60a8\u6210\u4e3a                <span class="mui-mbarp-prof-user-bubble-red">T{1}</span>\u4f1a\u5458!</p>                                <p class="mui-mbarp-prof-user-bubble-p"><span class="mui-mbarp-prof-user-bubble-red-b">\u624b\u673a\u5929\u732b\u5ba2\u6237\u7aef</span>\u626b\u7801                                </p>                                <div class="mui-mbarp-prof-user-bubble-block">                                <span class="mui-mbar-prof-user-bubble-trangle"></span>                                    <p class="mui-mbarp-prof-user-bubble-get">\u62a2<span>188</span>\u5143\u65b0\u4eba\u7ea2\u5305</p>                                    </div>                            </div>                        </div>                    </div>              </div>';var e=this;e.profDo=f;var i=e.get(o.K.MALLBAR_ITEM);var t=i.get(o.K.MALLBAR);var r=this.prof;var s=i.getUserInfo();if(!s.isLogin){return}l.getStaticConf({cb:function(s){var n=t.get(o.K.MODEL).get(o.K.TIMESTAMP);var u=s.hideProfSign||"";if(u){var c=u.s?u.s:"";var b=u.e?u.e:"";if(n>c&&n<b){e.profDo="";f=""}}return;if(s.profT0QueryClose){A=true;return}!!s.profT0queryInterval&&(T=s.profT0queryInterval);if(_==3){e.profDo=f;return}m.get({k:"mui/mallbar/prof/isNotQueryT0/"+i.getUid(),success:function(s){var n=0;if(s){var m=(new Date).getTime();var u=s.time||"";n=!!(m-u<1e3*3600*T)}if(n){_=3;e.profDo=f}else{l.ajax({url:o.URL.GET_PLUGIN_PROF_QUERY_T0_USER,dataType:"jsonp",data:{_tb_token_:t.get("token")||""},timeout:4,success:function(s){if(!s){return}if(s.status!=200){l.codeTracker.sendTrack(o.T.NUMLEV,"mallbar.pro.queryT0User.get.failure-bad-status-"+s.status,"\u67e5\u8be2T0\u7528\u6237\u6fc0\u6d3b\u63a5\u53e3\u72b6\u6001\u5f02\u5e38");return}var n=s.data;if(n&&n.length){var m=n[0].step||3;_=m;if(m==1){if(r.one(".mui-mbarp-prof-ci-bd")){r.one(".mui-mbarp-prof-ci-bd").html('<a class="mui-mbarp-prof-user-get" target="_blank" href="http://vip.tmall.com/act/gift/newgift?scm=1048.1.2.12" >\u9886\u65b0\u4eba\u7ea2\u5305></a>')}else{e.profDo=v}var u=i.getUserInfo();l.log("userInfo",u);var c=u.nick,b=u.memberInfo.activeStatus;if(b<0){b=0}var d="http://gqrcode.alicdn.com/img?type=hv&w=100&h=100&el=h&text=http%3A%2F%2Fm.tmall.com%2Fqr%2F2014xrlb1";var p=l.fm(a,c,b,d);t.bubble({show:true,flag:.9,content:p,customContentType:3,bubbleType:1,height:130,tab:"PROF",showed:function(){l.sendLog(o.ARR.PROF_BUB_T0_SHOW);var a=e.mallbarItem.get(o.K.BUBBLE);var i=a.one(".mui-mbar-bubble-close");if(i){i.on("click",function(a){a.stopPropagation();l.sendLog(o.ARR.PROF_BUB_T0_CLICK);l.ajax({url:o.URL.GET_PLUGIN_PROF_SET_T0_USER,dataType:"jsonp",data:{_tb_token_:t.get("token")||"",bizType:1,bizStep:2},timeout:4,success:function(a){},error:function(){}});e.fire(o.E.BUBBLE_CHANGE,{show:false});e._updateRedDot()})}},clicked:function(){l.sendLog(o.ARR.PROF_BUB_T0_CLICK);l.ajax({url:o.URL.GET_PLUGIN_PROF_SET_T0_USER,dataType:"jsonp",data:{_tb_token_:t.get("token")||"",bizType:1,bizStep:2},timeout:4,success:function(a){},error:function(){}});e.mallbarItem.fire(o.E.BUBBLE_CHANGE,{show:false});e._updateRedDot();var a="http://vip.tmall.com/act/gift/newgift?scm=1048.1.2.11";window.open(a)}})}else if(m==2){if(r.one(".mui-mbarp-prof-ci-bd")){r.one(".mui-mbarp-prof-ci-bd").html('<a class="mui-mbarp-prof-user-get" target="_blank" href="http://vip.tmall.com/act/gift/newgift?scm=1048.1.2.12" >\u9886\u65b0\u4eba\u7ea2\u5305></a>')}else{e.profDo=v}var f=i.get(o.K.TAB);var h=f.one(".mui-mbar-tab-sup");h.html('<div class="mui-mbar-iconfont mui-mbar-prof-reddot">&#xe603;</div>');h.show()}else{e._setT0queryStorage()}}else{e._setT0queryStorage()}},error:function(){l.codeTracker.sendTrack(o.T.NUMLEV,"mallbar.pro.queryT0User.get.failure","\u67e5\u8be2T0\u7528\u6237\u6fc0\u6d3b\u63a5\u53e3\u5931\u8d25")}})}}})}})},_updateRedDot:function(){var a=['<div class="mui-mbarp-prof-ci-tl">\u7b7e\u5230\uff1a</div>',"    <a class=\"mui-mbarp-prof-ci\" target=\"_blank\" href=\"http://vip.tmall.com?signIn=true&scm=1048.1.2.23\" onclick=\"_czc.push(['_trackEvent','\u6211','\u8d62\u79ef\u5206','\u5df2\u767b\u5f55','1048123'])\">\u8d62\u79ef\u5206</a>","    <a class=\"mui-mbarp-prof-ci\" style=\"margin-left:4px;\" target=\"_blank\" href=\"http://ka.tmall.com?scm=1048.1.2.24\" onclick=\"_czc.push(['_trackEvent','\u6211','\u9886\u70b9','\u5df2\u767b\u5f55','1048124'])\">\u9886\u70b9\u5238</a>"].join("");var e=this;var i=e.get(o.K.MALLBAR_ITEM);var t=i.get(o.K.MALLBAR);var r=this.prof;return;if(A){return}var s=i.getUserInfo();if(!s.isLogin){return}l.ajax({url:o.URL.GET_PLUGIN_PROF_QUERY_T0_USER,dataType:"jsonp",data:{_tb_token_:t.get("token")||""},timeout:4,success:function(t){if(t.status!=200){l.codeTracker.sendTrack(o.T.NUMLEV,"mallbar.pro.queryT0User.get.failure-bad-status-"+t.status,"\u67e5\u8be2T0\u7528\u6237\u6fc0\u6d3b\u63a5\u53e3\u72b6\u6001\u5f02\u5e38");return}var s=t.data;if(s&&s.length){var n=s[0].step||3;var m=_;_=n;var u=i.get(o.K.TAB);var c=u.one(".mui-mbar-tab-sup");if(n==1||n==2){c.html('<div class="mui-mbar-iconfont mui-mbar-prof-reddot">&#xe603;</div>');c.show();if(m!=n){if(r.one(".mui-mbarp-prof-ci-bd")){r.one(".mui-mbarp-prof-ci-bd").html('<a class="mui-mbarp-prof-user-get" target="_blank" href="http://vip.tmall.com/act/gift/newgift?scm=1048.1.2.12" >\u9886\u65b0\u4eba\u7ea2\u5305></a>')}else{e.profDo=v}}}else if(n==3){c.hide();if(m!=n){if(r.one(".mui-mbarp-prof-ci-bd")){r.one(".mui-mbarp-prof-ci-bd").html(a)}else{e.profDo=f}}e._setT0queryStorage()}}else{e._setT0queryStorage()}},error:function(){}})},_setT0queryStorage:function(){var a=this;var e=a.mallbarItem;var i=(new Date).getTime();m.set({k:"mui/mallbar/prof/isNotQueryT0/"+e.getUid(),v:{s:1,time:i}});_=3;a.profDo=f}});return I},{requires:["cookie","base","dom","node","event","mui/minilogin","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","xtemplate","gallery/slide/1.3/","sizzle","mui/mallbar/plugin-prof.css"]});KISSY.add("mui/mallbar/plugin/asset",function(a,e,t,i,r,s,n,o,l){var m=window.location.href.indexOf("mock-tmallbao=1")>-1;var u=function(a){var e=this;u.superclass.constructor.call(e,a);e.init()};a.extend(u,e,{init:function(){var e=this;var t=e.mallbarItem=e.get(s.K.MALLBAR_ITEM);var i=e.userInfo=t.getUserInfo();e.token="";var r=n.getSysId();e.isList=r=="list";e.isDetail=r=="detail";e.isShop=r=="shop";e.bubbled=false;var o=t.get(s.K.MALLBAR);e.itemId=o.get("itemId")||"";e.sellerId=o.get("sellerId")||"";e.shopId=o.get("shopId")||"";if(i.isLogin){var u=a.unparam(window.location.search.substr(1));var c=u&&Number(u.gap)||36e5;p();f()}e.set("isDataChange",true);e.on(s.E.VISIBILITY_CHANGE,function(a){if(a.visible&&e.get("isDataChange")){e._getAssetData()}});t.on(s.E.LOGIN_SUCCESS,function(a){n.log(a.type);p();f()});e.on(s.E.DATA_CHANGE,function(a){e.set("isDataChange",true);if(t.get(s.K.EXPAND)){e._getAssetData()}});var b=e.get("mallbarItem").get("tab");var d=a.one(".mui-mbar");b.on("click",function(){if(d.hasClass("mui-mbar-status-expand")){n.sendLog(s.ARR.ASSETS_TAB_CLICK)}});function p(){if(!e.bubbled){e.bubbled=true;e.getPluginAssetTip()}}function f(){var a=e.get(s.K.MALLBAR_ITEM);var t=a.get(s.K.MALLBAR);var i=['<div class="mui-mbar-bubble mui-mbarp-bubble-asset-tmallbao" >','<div class="mui-mbar-arr mui-mbarp-bubble-asset-tmallbao-arr">\u25c6</div>','<a class="mui-mbarp-bubble-asset-tmallbao-bd" target="_blank" href="http://chong.alipay.com/i/chong.htm?scm=1048.1.3.31">',"</a>","</div>"].join("");n.getStaticConf({cb:function(e){var r=t.get(s.K.MODEL).get(s.K.TIMESTAMP);if(e.tmallBaoBubble){var o=e.tmallBaoBubble;var u=o.s?o.s:"";var c=o.e?o.e:"";if(r>u&&r<c||m){l.get({k:"mui/mbarp/tmallbao/bubble/"+a.getUid(),success:function(e){if(e&&!m){return}t.bubble({show:true,content:i,customContentType:3,flag:4.1,height:150,bubbleType:0,isNotTabFire:true,tab:"ASSET",showTwo:true,showed:function(){n.sendLog(s.ARR.TMALLBAO_BUBBLE_SHOW);l.set({k:"mui/mbarp/tmallbao/bubble/"+a.getUid(),v:true,expires:1})},clicked:function(){n.sendLog(s.ARR.TMALLBAO_BUBBLE_CLICK)},dismiss:function(){}})}})}}}})}},_getCouldCoupon:function(){var e=this;var t=e.mallbarItem;var l=a.one("#mbarCouponAnchorCouldCoupon");if(l){l.hide();n.ajax({url:s.URL.GET_PLUGIN_ASSET_OBTAIN_COUPON_LIST,dataType:"jsonp",data:{sellerId:e.sellerId,itemId:e.itemId},timeout:5,success:function(t){if(t.s!==200){n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.obtainCoupon.failure.bad-status-"+t.s,"\u83b7\u53d6\u53ef\u9886\u4f18\u60e0\u5238\u5f02\u5e38");return}if(!t.oci){return}e.token=t.t;var m=t.oci.c;if(m.length=="0"){return}l.html("\u5f53\u524d\u5e97\u94fa\u6709\u53ef\u9886\u4f18\u60e0\u5238\u54e6").show();var u=new o(['<div class="mui-mbarp-asset-coupon-title" style="height:0px" id="mbarCouponAnchorAbleCoupon">',"\u5f53\u524d\u5e97\u94fa\u53ef\u7528\u4f18\u60e0\u5238","</div>"].join(""));var c=['<a class="mui-mbarp-asset-coupon-item mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}} ','{{#if a>1}}mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}}-multi{{/if}}" href="javascript:;"',' data-s="{{s}}" data-l="{{l}}" data-activeId="{{sid}}" data-c="{{c}}" data-stretch="1" data-u="#" data-d="{{d}}" data-t="\u6709\u6548\u671f" data-n="{{n}}" data-nt="{{nts}}"  data-f="{{f}}"',">",'<div class="mui-mbarp-asset-coupon-border-top"></div>','<div class="mui-mbarp-asset-coupon-item-content">','<p class="mui-mbarp-asset-coupon-item-hd">','<span class="mui-mbarp-asset-coupon-item-name" title="{{n}}"> ',"{{#if f}}",'<span class="mui-mbarp-asset-tmgj-flag "> </span>',"{{/if}}","{{nt}}</span>","</p>",'<div class="mui-mbarp-asset-coupon-item-bd mui-mbarp-clearfix">','<div class="mui-mbarp-asset-coupon-item-bd-right mui-mbarp-asset-coupon-item-bd-right-could">',"<p>{{s}}</p>","<p>&nbsp;{{l}}</p>","</div>",'<div class="mui-mbarp-asset-bonus-item-left">','<p class="mui-mbarp-asset-coupon-item-rmb mui-mbarp-asset-coupon-item-rmb-could" {{#if i===1}}style="height:25px!important"{{/if}}>','\uffe5<span class="mui-mbarp-asset-coupon-item-rmb-rmb">',"{{d}}</span>","</p>",'<p class="mui-mbarp-asset-coupon-item-condition">\u6ee1{{c}}\u4f7f\u7528{{#if i===1}}</br>(\u90e8\u5206\u5546\u54c1){{/if}}</p>',"</div>","</div>","</div>",'<div class="mui-mbarp-asset-coupon-border-bottom"></div>','<div class="mui-mbarp-asset-coupon-could-act j_couldPull j_couldPullAct">','<div class="mui-mbarp-asset-coupon-could-act-icon j_couldActIcon mui-mbarp-asset-hide"></div>','<span class="mui-mbarp-asset-coupon-could-act-val j_couldActVal">\u7acb\u5373\u9886\u53d6</span>','<div class="mui-mbarp-asset-coupon-could-act-icon"><img src="http://gtms04.alicdn.com/tps/i4/T19yeaFDVfXXa94Hfd-32-32.png" width="16" height="16"/></div>',"</div>",'<div class="mui-mbarp-asset-coupon-could-act-fail j_couldCouponFail">','<div class="mui-mbarp-asset-could-act-fail-icon"><img src="http://gtms04.alicdn.com/tps/i4/T1UWUoFz4aXXXuPRLc-28-28.png" width="14"></div>','<div class="mui-mbarp-asset-could-act-fail-msg j_couldCouponFailMsg"></div>',"</div>",'<div class="mui-mbarp-asset-coupon-could-area j_couldPull j_couldPullBd">','<div class="mui-mbarp-asset-coupon-now-area-bg"></div>','<div class="mui-mbarp-asset-coupon-fail-area-bg"></div>',"</div>","</a>"];var b=new o(['<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-could-coupon">',"{{#each c}}",c.join(""),"{{/each}}","</div>"].join(""));n.log("::\u53ef\u9886\u53d6\u7684\u4f18\u60e0\u5238::",m);if(m&&m.length>0){if(!m[0].s){return}if(a.one(".mui-mbar-asset-no-coupon")){a.one(".mui-mbar-asset-no-coupon").css("visibility","hidden")}a.each(m,function(a){var e=/^\d{2}/;a.s=a.s.replace(e,"");a.l=a.l.replace(e,"");a.nt=a.n;a.nts=a.n;if(a.f){a.nts=n.sub(a.n,14);a.nt=n.sub(a.n,19)}});if(a.one("#mbarCouponAnchorCouldCoupon")){a.DOM.insertAfter(a.DOM.create(b.render(t.oci)),a.one("#mbarCouponAnchorCouldCoupon"));a.one("#mbarCouponAnchorCouldCoupon").show()}r.delegate(".j_mui-mbarp-asset-could-coupon","mouseenter",".mui-mbarp-asset-coupon-item",function(e){var t=a.one(e.currentTarget);if(t.attr("data-stretch")=="1"){i(t.one(".j_couldPullBd"),{right:"-183px"},.1,s.EASE).run();i(t.one(".mui-mbarp-asset-coupon-could-act"),{right:"8px"},.1,s.EASE).run()}});r.delegate(".j_mui-mbarp-asset-could-coupon","mouseleave",".mui-mbarp-asset-coupon-item",function(e){var t=a.one(e.currentTarget);if(t.attr("data-stretch")=="1"){i(t.one(".j_couldPullBd"),{right:"-198px"},.1,s.EASE).run();i(t.one(".mui-mbarp-asset-coupon-could-act"),{right:"0px"},.1,s.EASE).run()}});r.delegate(".j_mui-mbarp-asset-could-coupon","click",".mui-mbarp-asset-coupon-item",function(a){a.halt();d(a)});r.delegate(".mui-mbarp-asset-wrap","click",".j_couldPull",function(a){a.halt();d(a)});r.delegate(".j_mui-mbarp-asset-could-coupon","click",".j_couldCouponFail",function(e){var t=a.one(e.currentTarget).parent(".mui-mbarp-asset-coupon-item");t.slideUp(.5);e.halt()});function d(t){var r;if(a.one(t.currentTarget).hasClass(".mui-mbarp-asset-coupon-item")){r=a.one(t.currentTarget)}else{r=a.one(t.target).parent(".mui-mbarp-asset-coupon-item")}var o=.5,l=.5,m=s.EASE;n.ajax({url:s.URL.GET_PLUGIN_ASSET_OBTAIN_COUPON,data:{sellerId:e.sellerId,spreadId:r.attr("data-activeId"),_tb_token_:e.token},success:function(t){if(t.s=="-2"){n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.counpon.get.failure","\u7528\u6237\u4f18\u60e0\u5238\u9886\u53d6\u5931\u8d25");return}if(t.s=="-1"){r.attr("data-stretch","0");if(t.m.length<12){r.one(".j_couldCouponFailMsg").css("line-height","48px")}else{r.one(".j_couldCouponFailMsg").css("padding-top","9px")}r.one(".j_couldCouponFailMsg").html(t.m);i(r.one(".j_couldCouponFail"),{right:"0px"},l,m,function(){r.one(".j_couldPullBd").one(".mui-mbarp-asset-coupon-now-area-bg").hide();r.one(".j_couldPullBd").one(".mui-mbarp-asset-coupon-fail-area-bg").css("width","198px")}).run();i(r.one(".j_couldPullBd"),{right:"0px"},l,m).run();i(r.one(".j_couldPullAct"),{right:"187px"},l-6e-5,m).run()}else if(t.s=="1"){r.one(".mui-mbarp-asset-coupon-could-act").css("top","18px");r.one(".j_couldActIcon").html("&#xe605;").show();r.one(".j_couldActVal").next().hide();r.one(".j_couldActVal").html("\u5df2\u9886").css("margin-top","0px");i(r,{height:"0px"},o,m,function(){r.hide();b();var t={};t.d=r.attr("data-d");t.u=r.attr("data-u");t.s="20"+r.attr("data-s");t.l="20"+r.attr("data-l");t.t=r.attr("data-t");t.n=r.attr("data-n");t.c=r.attr("data-c");t.f=!(r.attr("data-f")=="false");t.nt=r.attr("data-nt");var s=e._couponTemp.render(t);a.one(s).prependTo(a.one(".j_mui-mbarp-asset-cur-coupon"));if(!a.one("#mbarCouponAnchorAbleCoupon")){a.all(u.render()).insertBefore(a.one(".j_mui-mbarp-asset-cur-coupon"));i(a.one("#mbarCouponAnchorAbleCoupon"),{height:"18px"},.1,m,function(){c()}).run()}else{c()}}).run()}}});function c(){a.one(".j_mui-mbarp-asset-cur-coupon").all(".mui-mbarp-asset-coupon-item").each(function(t,r){if(r==0){if(a.one(".j_pushShopItems")){if(!e.isDetail){i(a.one(".j_pushShopItems"),{height:"0px"},o,m,function(){a.one(".j_pushShopItems").css("overflow","hidden").insertAfter(a.one(t));i(a.one(t),{height:"90px"},o,m,function(){p();d()}).run()}).run()}else{i(a.one(t),{height:"90px"},o,m,function(){d()}).run()}}else{i(a.one(t),{height:"90px"},o,m,function(){if(!e.isDetail){a.one('<div class="mui-mbarp-asset-shop-push-items j_pushShopItems" style="height:0; overflow: hidden; zoom: 1px;"></div>').appendTo(a.one(".j_mui-mbarp-asset-cur-coupon"));e._getPullItems();p();b()}d()}).run()}return false}})}function b(){var t=a.one("#mbarCouponAnchorAbleCoupon");var r=e.get(s.K.CONTAINER);if(t){var n=a.all(t).getDOMNode().offsetTop;i(r,{scrollTop:n},.5).run();e.set(s.K.COUPON_ANCHOR,"")}}function d(){var e=false;a.one(".j_mui-mbarp-asset-could-coupon").all("a").each(function(t){if(parseInt(a.one(t).css("height"))!=0){e=true}});if(e){a.one("#mbarCouponAnchorCouldCoupon").show()}else{a.one("#mbarCouponAnchorCouldCoupon").hide()}}function p(){i(a.one(".j_pushShopItems"),{height:"265px"},2,m,function(){a.one(".j_pushShopItems").css("overflow","visible")}).run()}}}},error:function(){n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.obtainCoupon.get.failure","\u83b7\u53d6\u53ef\u9886\u4f18\u60e0\u5238\u5931\u8d25")}})}},_getPullItems:function(){var e=this;var t=e.mallbarItem;var l=a.one("#mbarCouponAnchorAbleCoupon");if(!e.isDetail){if(l){l.html("\u5f53\u524d\u5e97\u94fa\u53ef\u7528\u4f18\u60e0\u5238:");n.ajax({url:s.URL.GEI_PUSH_ITEMS,dataType:"jsonp",data:{appId:s.RECOMMEND_APPID,shopId:e.shopId},timeout:5,success:function(t){var l=new o(['<img src="{{acurl}}" class="mui-mbarp-asset-hide" /><div class="mui-mbarp-asset-shop-push-tip">\u63a8\u8350\u4ee5\u4e0b\u4eba\u6c14\u5b9d\u8d1d\u4eab\u7528\u4f18\u60e0\u5238\uff1a</div>',"<ul>","{{#each d}}",'<li class="mui-mbarp-asset-shop-push-item mui-mbarp-asset-shop-push-item{{xindex}}" data-url="{{linkUrl}}">','<a href="{{linkUrl}}" target="_blank">','   <div class="mui-mbarp-asset-shop-push-wrap">','       <span class="mui-mbarp-asset-shop-push-describe"><span class="mui-mbarp-asset-shop-push-a" title="{{title}}" target="_blank">{{title}}</span></span>','       <span class="mui-mbarp-asset-shop-push-price">\uffe5<b>{{price}}</b></span>','       <span class="mui-mbarp-asset-shop-push-sales">\u5df2\u552e\u51fa<b>{{sales}}</b>\u4ef6</span>',"   </div>",'   <div class="mui-mbarp-asset-hide mui-mbarp-asset-shop-push-166pic-arr"></div>','   <div class="mui-mbarp-asset-hide mui-mbarp-asset-shop-push-166pic"><img title="{{title}}" src="{{pic}}" width="198" height="198" style=""/></div>','   <img class="mui-mbarp-asset-shop-push-60pic" alt="{{title}}" src="{{pic}}" width="60" height="60"/>',"</a>","</li>","{{/each}}","</ul>",'<div class="mui-mbarp-clearfix mui-mbarp-asset-push-items-bg"></div>'].join(""));if(t.d&&t.d.length>0){if(a.one(".j_pushShopItems")){a.DOM.append(a.DOM.create(l.render(t)),a.one(".j_pushShopItems"))}a.all(".mui-mbarp-asset-shop-push-item").each(function(e){r.delegate(document,"mouseover",".mui-mbarp-asset-shop-push-60pic",function(e){var t=a.one(e.target).prev(),i=a.one(e.target).parent().one(".mui-mbarp-asset-shop-push-166pic-arr");t.css({display:"block"});i.css({display:"block"})});r.delegate(document,"mouseout",".mui-mbarp-asset-shop-push-60pic",function(e){var t=a.one(e.target).prev(),i=a.one(e.target).parent().one(".mui-mbarp-asset-shop-push-166pic-arr");t.css({display:"none"});i.css({display:"none"})});a.one(e).one("div.mui-mbarp-asset-hide").on("mouseout",function(e){var t=a.one(e.target).parent().one(".mui-mbarp-asset-shop-push-166pic-arr");a.one(e.target).css({display:"none"});t.css({display:"none"})})});r.delegate(".j_mui-mbarp-asset-cur-coupon","click",".mui-mbarp-asset-coupon-item",function(t){if(!e.isDetail){var r=a.one(".j_pushShopItems"),o=a.one(t.target).parent(".mui-mbarp-asset-coupon-item").next();if(o&&o.hasClass("j_pushShopItems")){return}i(r,{height:"0px"},.5,s.EASE,function(){n.log("i try clone");r.css("height","0px").insertAfter(a.one(t.target).parent(".mui-mbarp-asset-coupon-item"));i(r,{height:"265px"},2,s.EASE,function(){r.css("overflow","visible")}).run()}).run()}});a.one(".mui-mbarp-asset-shop-push-items").show()}else{a.one(".j_pushShopItems").hide()}},error:function(){a.one(".mui-mbarp-asset-shop-push-items").hide();n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.pushShopItems.get.failure","\u62c9\u53d6\u63a8\u8350\u5546\u54c1\u5931\u8d25")}})}}else{if(a.one(".j_pushShopItems")){a.one(".j_pushShopItems").css("height","0px")}}},_getAssetData:function(){var a=this;var e=a.mallbarItem;var t=e.get(s.K.MALLBAR);n.ajax({url:s.URL.GET_PLUGIN_ASSET,data:{sellerId:a.sellerId,itemId:a.itemId},timeout:4,jsonpCallback:"__mallbarGetMyAssets",success:function(i){n.log(i);if(i.s==401){e.fire(s.E.LOGIN,{success:function(){a.set("isDataChange",true);if(e.get(s.K.EXPAND)){a._getAssetData()}}});return}if(i.s!==200){e.fire(s.E.ERROR);n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.myAssets.failure.bad-status-"+i.s,"\u83b7\u53d6\u6211\u7684\u8d44\u4ea7\u5f02\u5e38");return}if(i){n.getStaticConf({cb:function(e){var r=t.get(s.K.MODEL).get(s.K.TIMESTAMP);i.inTmallbaoTime=false;if(e.tmallbaobannerTime){var o=e.tmallbaobannerTime;var l=o.s?o.s:"";var m=o.e?o.e:"";if(r>l&&(!m||r<m)){i.inTmallbaoTime=true}if(e.tmallBaoDaily){if(r>e.tmallBaoDaily){i.showTmallBaoDaily=true}}i.tmallBaoDailyBanner=e.tmallBaoDailyBanner||"";i.tmallBaoLink=e.tmallBaoLink||""}i.inShowTime=r>e.closedStartShow&&r<e.closedEndTime;i.inActiveTime=r>e.closedStartTime&&r<e.closedEndTime;n.log("::plugin asset::\u8d44\u4ea7\u4e2d\u5c55\u793a\u4f18\u5148\u8d2d\u4e70\u8d77\u59cb\u65f6\u95f4",e.closedStartShow,e.closedStartTime,e.closedEndTime,i.inShowTime,i.inActiveTime);var u=function(){a._render(i);a._getCouldCoupon();a._getPullItems();a.set("isDataChange",false)};i.notNeedShopCard=true;var c=function(){if(i.notNeedShopCard){u()}else{n.ajax({url:s.URL.GET_SHOP_CARD,data:{sellerId:a.sellerId,itemId:a.itemId},timeout:4,jsonpCallback:"__mallbarGetShopCard",success:function(a){n.log("\u5e97\u94fa\u5361\u5185\u5bb9",a);if(a.success){i.shopCard=a.model}u()},error:function(){u()}})}};if(i.inShowTime){if(t.get("closeSaleNum")){c()}else{n.ajax({url:s.URL.GET_CLOSE_SALE_NUM,timeout:4,data:{itemId:t.get("itemId")},jsonpCallback:"__mallbarGetCloseSaleNum",success:function(a){if(a.s==200&&a.pec&&a.pec>0){t.set("closeSaleNum",a.pec);c()}else{c()}}})}}else{c()}}})}},error:function(){e.fire(s.E.ERROR);n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.myAssets.get.failure","\u83b7\u53d6\u6211\u7684\u8d44\u4ea7\u5931\u8d25")}})},renderCouldCoupon:function(a){var e=this,t;var i=e.mallbarItem;var r=i.get(s.K.MALLBAR);t=e._assetCouponBubbleTPL('<div class="mui-mbar-assets-disable-bubble mui-mbarp-assets-disable-bubble-couldCoupon" >\u8be5\u5e97\u94fa\u53ef\u9886\u4f18\u60e0\u5238<p class="mui-mbarp-asset-couldCouponBubble-click"><a>\u7acb\u5373\u9886\u53d6</a></p></div>');e.token=a.t;r.bubble({show:true,content:new o(t).render(),customContentType:3,isNotTabFire:false,bubbleType:0,tab:"ASSET",dismiss:function(){e.handleAbleBonusBubble()},showed:function(){n.sendLog(s.ARR.COUPON_COULD_SHOW)},clicked:function(){e.set(s.K.COUPON_ANCHOR,"mbarCouponAnchorCouldCoupon");n.sendLog(s.ARR.COUPON_COULD_CLICK)}})},renderExpCoupon:function(e){var t=this,i="",r=t.handleExpCoupon(e),l=false,m={};if(r.n==1){var u=r.d[0];if(!u.isShow){l=true}else if(u.lastDay&&u.lastShow==false){l=true}var c=new Date(r.d[0].t);r.deadline=t.dateFormat(c,"yyyy-MM-dd");i='<div class="j_Asset_Bubble"><div class="mui-mbar-assets-disable-bubble">{{n}}\u5f20\u4f18\u60e0\u5238\u4e8e<br/>{{deadline}}\u8fc7\u671f</br>\u4ef7\u503c \uffe5{{t}}\u5143</div><p class="mui-mbar-bubble-href"><a>\u7acb\u5373\u67e5\u770b</a></p></div>';m.height="120px"}else{i='<div class="j_Asset_Bubble"><div class="mui-mbar-assets-disable-bubble">{{n}}\u5f20\u4f18\u60e0\u5238\u5373\u5c06\u8fc7\u671f</br>\u603b\u4ef7\u503c \uffe5{{t}}\u5143</div><p class="mui-mbar-bubble-href"><a>\u7acb\u5373\u67e5\u770b</a></p></div>';m.height="100px"}a.each(r.d,function(a){if(!a.isShow){l=true;return false}else if(a.lastDay&&a.lastShow==false){l=true;return false}});if(!l){t.getPluginAssetTip();return}t.mallbarItem.fire(s.E.BUBBLE_CHANGE,a.mix(m,{show:true,html:new o(i).render(r),dismiss:function(){t.getPluginAssetTip()},showed:function(){n.sendLog(s.ARR.COUPON_7_SHOW)},clicked:function(){t.set(s.K.COUPON_ANCHOR,"mbarCouponAnchorExpCoupon");n.sendLog(s.ARR.COUPON_7_CLICK)}}))},dateFormat:function(a,e){var t={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};if(/(y+)/.test(e)){e=e.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))}for(var i in t){if(new RegExp("("+i+")").test(e)){e=e.replace(RegExp.$1,RegExp.$1.length==1?t[i]:("00"+t[i]).substr((""+t[i]).length))}}return e},handleExpCoupon:function(a){var e=this,t={},i=e.mallbarItem;if(a.isServer)a["server"]["serverSince"]=new Date*1;e.handleExpServiceData(a,t);l.set({k:"mui/mallbar/asset/"+i.getUid(),v:a.isServer?a["server"]:a["local"],success:function(a){}});return t},handleExpServiceData:function(e,t){var i=this;var r=new Date*1,s=e["server"],n=e["local"];if(n&&n.d){n.d=a.filter(n.d,function(e){if(s&&s.d){var t=false;a.each(s.d,function(a){if(a.i==e.i){t=true;return false}});return t}return true})}if(s){a.each(s.d,function(e){if(n){a.each(n.d,function(t){if(t.i==e.i){a.mix(e,t)}})}});a.mix(t,a.clone(s))}else{if(n){a.mix(t,a.clone(n))}}var o=s?s:n;a.each(o.d,function(a,e){if(i.dateFormat(new Date(a.t),"yyyy-MM-dd")==i.dateFormat(new Date(r),"yyyy-MM-dd")){t.d[e].lastDay=true;a.isShow=true;a.lastShow=true}else{a.isShow=true}})},getPluginAssetTip:function(){var a=this;var e=a.mallbarItem;var t=e.get(s.K.MALLBAR);t.getCueMsgInfo(function(e){if(e.s!=200){n.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.asset.cueAssetMsg.failure.bad-status-"+e.s,"\u83b7\u53d6\u6211\u7684\u8d44\u4ea7\u6c14\u6ce1\u63d0\u9192\u5f02\u5e38");return false}a.token=e.t;if(e.b&&e.b.c>0&&e.b.a!=="0.0"){a.handleAbleBonusBubble(e);return}else if(e.m&&e.m.t){if(e.m.p&&e.m.p!=2){a.handleMemberCouponBubble(e)}return}else if(e.uci&&e.uci.d&&e.uci.d.length>0){a.handleAbleCouponBubble(e);return}else if(e.oci&&e.oci.c&&e.oci.c.length>0){a.renderCouldCoupon(e)}})},handleAbleBonusBubble:function(a){var e=this;var t=e.mallbarItem;var i=t.get(s.K.MALLBAR);if(!a){return}l.get({k:"mui/mallbar/asset/ableBonus/"+t.getUid(),success:function(r){if(r&&r.isShow){if(a.m&&a.m.t){if(a.m.p&&a.m.p!=2){e.handleMemberCouponBubble(a)}return}else if(a.uci&&a.uci.d&&a.uci.d.length>0){e.handleAbleCouponBubble(a);return}else if(a.oci&&a.oci.d&&a.oci.d.length>0){e.renderCouldCoupon(a)}}else{var m=["<div>","\u60a8\u5171\u6709{{c}}\u4e2a\u7ea2\u5305\u53ef\u7528","</div>","<div>","\u603b\u91d1\u989d{{a}}\u5143","</div>"].join("");var u=new o(m).render(a.b);i.bubble({show:true,content:u,customContentType:1,isNotTabFire:false,bubbleType:0,tab:"ASSET",showed:function(){n.sendLog(s.ARR.BONUS_AVAILABLE_BUB_SHOW)},dismiss:function(){e.handleAbleCouponBubble(a)},clicked:function(){n.sendLog(s.ARR.BONUS_AVAILABLE_BUB_CLICK)}});l.set({k:"mui/mallbar/asset/ableBonus/"+t.getUid(),v:{isShow:true}})}}})},handleAbleCouponBubble:function(e){var t=this;var i=t.mallbarItem;var r=i.get(s.K.MALLBAR);var l=["red","yellow","blue"];var m=["mui-mbarp-asset-ableCouponBubble-title-red","mui-mbarp-asset-ableCouponBubble-title-yellow","mui-mbarp-asset-ableCouponBubble-title-blue"];if(a.isUndefined(e.uci)){return}if(e.uci.d&&e.uci.d.length==0){return}var u=function(e){var t=e[0]?e[0]:e.data;var i=t.d;if(i.length==0){return}var r="";var s='<div class="mui-mbarp-asset-ableCouponBubble-content mui-mbar-bubble">';s+='<div class="mui-mbar-arr mui-mbar-bubble-arr">\u25c6</div>';s+='<div class="mui-mbarp-asset-bubble-top"></div>';a.each(i,function(a,e){var t=a.d;var n="mui-mbarp-asset-ableCouponBubble-title-denomination";if(e===0){s+='<div class="mui-mbarp-asset-ableCouponBubble-'+r+"_small mui-mbarp-asset-ableCouponBubble-"+r+"_big mui-mbarp-asset-ableCouponBubble-zindex-"+e+' mui-mbarp-asset-ableCouponBubble">';s+='<p class="mui-mbarp-asset-ableCouponBubble-title '+n+'">\u60a8\u6709'+i.length+"\u5f20\u4f18\u60e0\u5238</p>"+'<p class="mui-mbarp-asset-ableCouponBubble-trmb">';s+='<span class="mui-mbarp-asset-memberCouponBubble-rmb_icon">\uffe5</span>'+'<span class="mui-mbarp-asset-ableCouponBubble-rmb">'+t+"</span>"+"</p>"+'<p class="mui-mbarp-asset-ableCouponBubble-now_use"><a>\u7acb\u5373\u4f7f\u7528</a></p>'+"</div>";return}});s+='<div class="mui-mbarp-asset-bubble-bottom"></div>';s+="</div>";return s};var c=new o(u).render(e.uci);r.bubble({show:true,content:c,customContentType:3,bubbleType:s.B.FOREVER,isNotTabFire:false,tab:"ASSET",showed:function(){n.sendLog(s.ARR.COUPON_AVAILABLE_SHOW)},clicked:function(){t.set(s.K.COUPON_ANCHOR,"mbarCouponAnchorAbleCoupon");n.sendLog(s.ARR.COUPON_AVAILABLE_CLICK)}})},handleMemberCouponBubble:function(e){var t=this;var i=t.mallbarItem;var r=i.get(s.K.MALLBAR);if(a.isUndefined(e.m)){return}var l="";var m='<div class="mui-mbarp-asset-memberCouponBubble-content mui-mbar-bubble">'+'<div class="mui-mbar-arr mui-mbar-bubble-arr mui-mbar-asset-member-bubble-arr">\u25c6</div>'+'<div class="mui-mbarp-asset-member-bubble-top"></div>'+'<div class="mui-mbarp-asset-memberCouponBubble-zindex-0 mui-mbarp-asset-memberCouponBubble">'+' <p class="mui-mbarp-asset-memberCouponBubble-title mui-mbarp-asset-memberCouponBubble-title-denomination">'+"{{#if v}}"+'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>'+"{{/if}}"+"{{t}}</p>"+'<p class="mui-mbarp-asset-memberCouponBubble-trmb">'+"{{#if rt===2}}"+'<span class="mui-mbarp-asset-memberCouponBubble-rmb_icon">\uffe5</span>'+'<span class="mui-mbarp-asset-memberCouponBubble-rmb">{{m}}</span><span>\u73b0\u91d1\u5238</span></p>'+"{{/if}}"+"{{#if rt===1}}"+"{{b}}\u6298\u6263</p>"+"{{/if}}"+"{{#if rt===3}}"+"{{b}}\u8bd5\u7528</p>"+"{{/if}}";m+='<p class="mui-mbarp-asset-memberCouponBubble-now_use"><a>{{a}}</a></p>'+'<div class="mui-mbarp-asset-member-bubble-bottom"></div>'+"</div>";l=m;var u=new o(l).render(e.m);r.bubble({show:true,content:u,customContentType:3,bubbleType:s.B.FOREVER,isNotTabFire:false,tab:"ASSET",showed:function(){n.sendLog(s.ARR.COUPON_MEMBER_BUBBLE_A_SHOW)},clicked:function(){t.set(s.K.COUPON_ANCHOR,"mbarCouponAnchorAbleCoupon");n.sendLog(s.ARR.COUPON_MEMBER_BUBBLE_A_CLICK)}})},_renderShopCard:function(e){var t="";var i='<li class="mui-mbarp-asset-shop-card-item mui-mbarp-asset-shop-card-item-{categoryTag}">                        <a class="mui-mbarp-asset-shop-card-link" href="http://{shopUrl}" target="_blank">                            <h4>{shopTitle}</h4>                            <p><em>\u4f59\u989d\uff1a<span class="mui-price-font">&yen;</span><span class="mui-mbarp-asset-shop-cart-balance">{balance}</span></em></p>                            <p>\u8fdb\u5e97\u901b\u901b&gt;</p>                        </a>                        <a class="mui-mbarp-asset-shop-card-link-charge {hidden}" href="http://shopcard.tmall.com/?sellerId={sellerId}&campaignId={campaignId}">\u5145{moneyBase}\u9001{moneyExtra}&gt;</a>                    </li>';a.each(e,function(e,r){if(r>2){return}if(e.moneyBase){e.moneyBase=parseInt(e.moneyBase,10)/100;e.moneyExtra=parseInt(e.moneyExtra,10)/100;e.hidden=""}else{e.hidden="hidden"}e.balance=(parseInt(e.balance,10)/100).toFixed(2);t=t+a.substitute(i,e)});t='<div class="mui-mbarp-asset-shop-cart-cont">                        <div class="mui-mbarp-asset-shop-cart-title">\u6211\u7684\u5e97\u94fa\u5361\uff1a</div>                    <ul class="mui-mbarp-asset-shop-cart-list">'+t+'</ul><a class="mui-mbar-more mui-mbar-asset-more" href="https://hongbao.alipay.com/coupon/index.htm?scm=1048.1.3.4&sign_from=3000&sign_account_no={{alipayId}}" target="_blank">\u67e5\u770b\u66f4\u591a<b></b></a></div>';return t},_render:function(e){var t=this;var i=t.mallbarItem=t.get(s.K.MALLBAR_ITEM);var r=i.get(s.K.MALLBAR);var l=t.get(s.K.CONTAINER);var m=e.d;m.alipayId=e.alipayId?e.alipayId:"";o.addCommand("formatInteral",function(a,e){return t._formatInteral(e.fn(a))});var u;if(e.shopCard){u=e.shopCard.count||"-"}else{u="-"}var c=['<div class="mui-mbarp-asset-overview mui-mbarp-clearfix">','<a href="http://vip.tmall.com/point/all?scm=1048.1.3.19" target="_blank">','<div class="mui-mbarp-asset-integral-wrap">','<div class="mui-mbarp-asset-coupon-value">',t.getIntegral(),"</div>",'<div class="mui-mbarp-asset-coupon-text">\u5929\u732b\u79ef\u5206</div>',"</div>","</a>",'<a href="http://mybrand.tmall.com/myCoupon.html?scm=1048.1.3.18" target="_blank">','<div class="mui-mbarp-asset-coupon-wrap">','<div class="mui-mbarp-asset-coupon-value">',"{{#with c}}{{a}}{{/with}}","</div>",'<div class="mui-mbarp-asset-coupon-text">\u4f18\u60e0\u5238</div>',"</div>","</a>",'<a href="https://hongbao.alipay.com/coupon/index.htm?scm=1048.1.3.20&sign_from=3000&sign_account_no={{alipayId}}" target="_blank">','<div class="mui-mbarp-asset-bonus-wrap">','<div class="mui-mbarp-asset-bonus-value">',"{{#with b}}",'<span class="mui-mbarp-asset-bonus-yen">&yen;</span>',"{{#if d}}{{d}}{{/if}}","{{^if d}}0{{/if}}","{{/with}}","</div>",'<div class="mui-mbarp-asset-bonus-text">\u7ea2\u5305({{#with b}}{{a}}{{/with}})</div>',"</div>","</a>","</div>","{{#with p}}{{#if e}}",'<div class="mui-mbarp-asset-tips">',"{{#formatInteral}}{{e}}{{/formatInteral}}\u5929\u732b\u79ef\u5206\u4e8e{{d}}\u8fc7\u671f",'<span class="mui-mbarp-assets-tips-arrow">\u25c6</span>',"</div>","{{/if}}{{/with}}"];var b=['<div class="mui-mbarp-asset-bonus">',"{{#with b}}","{{#if b_l_len}}",'<div class="mui-mbarp-asset-line-h"></div>','<div class="mui-mbarp-asset-bonus-title">',"\u6211\u7684\u7ea2\u5305","</div>","{{/if}}","{{#each l}}","{{#if xindex<3}}",'<a href="https://hongbao.alipay.com/coupon/index.htm?scm=1048.1.3.4&sign_from=3000&sign_account_no={{alipayId}}" target="_blank">','<div class="mui-mbarp-asset-bonus-item mui-mbarp-clearfix">','<div class="mui-mbarp-asset-bonus-item-left">','<p class="mui-mbarp-asset-bonus-item-rmb">&yen;<span class="rmb">{{d}}</span></p>','<p class="mui-mbarp-asset-coupon-item-surplus">\u5269\u4f59\uff1a<span class="yen">&yen;</span>{{sp}}</p>',"</div>",'<div class="mui-mbarp-asset-bonus-item-right">',"<p>\u6709\u6548\u671f</p>","<p>{{s}}</p>","<p>-&nbsp;{{l}}</p>","</div>","</div>","</a>","{{/if}}","{{/each}}","{{/with}}","{{#with b}}","{{#if a>0}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="https://hongbao.alipay.com/coupon/index.htm?scm=1048.1.3.4&sign_from=3000&sign_account_no={{alipayId}}" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}","{{/with}}","</div>"];var d=['<a class="mui-mbarp-asset-coupon-item mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}} ','{{#if a>1}}mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}}-multi{{/if}}" href="{{^if curCoupon}}{{u}}" target="_blank"{{else}}javascript:;"{{/if}}>','<div class="mui-mbarp-asset-coupon-border-top"></div>','<div class="mui-mbarp-asset-coupon-item-content">','<p class="mui-mbarp-asset-coupon-item-hd">','<span class="mui-mbarp-asset-coupon-item-tips ','{{#if t==="\u5373\u5c06\u8fc7\u671f"}}mui-mbarp-asset-coupon-item-tips-will_expire{{/if}}" >','{{#if t==="\u5373\u5c06\u8fc7\u671f"}}',"<span >","<b>{{diffDay}}</b>\u540e\u8fc7\u671f</span>","{{else}}","{{t}}{{/if}}","</span>",'<span class="mui-mbarp-asset-coupon-item-name" title="{{n}}"> ',"{{#if f}}",'<span class="mui-mbarp-asset-tmgj-flag "> </span>',"{{/if}}","{{nt}}</span>","</p>",'<div class="mui-mbarp-asset-coupon-item-bd mui-mbarp-clearfix">','<div class="mui-mbarp-asset-coupon-item-bd-right">','{{#if t==="\u5373\u5c06\u8fc7\u671f"}}'," ","{{else}}","<p>{{s}}</p>","<p>-&nbsp;{{l}}</p>","{{/if}}","</div>",'<div class="mui-mbarp-asset-bonus-item-left">','<p class="mui-mbarp-asset-coupon-item-rmb">','\uffe5<span class="mui-mbarp-asset-coupon-item-rmb-rmb ','{{#if d>999}}mui-mbarp-asset-coupon-item-rmb-demotion{{/if}}">{{d}}</span>','{{#if a>1}} <span class="mui-mbarp-asset-coupon-x">x</span> <span class="mui-mbarp-asset-coupon-item-rmb-multi">{{a}}\u5f20</span>{{/if}}',"</p>",'<p class="mui-mbarp-asset-coupon-item-condition">\u6ee1{{c}}\u4f7f\u7528{{#if i===1}}</br>(\u90e8\u5206\u5546\u54c1\u53ef\u7528){{/if}}</p>',"</div>","</div>","</div>",'<div class="mui-mbarp-asset-coupon-border-bottom"></div>',"</a>"];var p=['<a class="mui-mbarp-asset-coupon-item mui-mbarp-asset-member-coupon-item " href="javascript:;">','<p class="mui-mbarp-asset-member-coupon-item-title">{{n}}</p>','<p class="mui-mbarp-asset-member-coupon-item-iconp" ><span class="mui-mbarp-asset-member-coupon-item-icon">',"{{#if v}}",'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>',"{{/if}}","{{r}}</span></p>",'<p class="mui-mbarp-asset-member-coupon-item-trmb" title="\uffe5{{cm}}\u73b0\u91d1\u5238"><span class="mui-mbarp-asset-member-coupon-item-rmb">\uffe5</span> <span class="mui-mbarp-asset-member-coupon-item-rmbn">{{cm}}</span><span>\u73b0\u91d1\u5238</span></p>','<p class="mui-mbarp-asset-member-coupon-item-time">\u6d3b\u52a8\u65f6\u95f4:{{t}}</p>',"</a>",'<div class="mui-mbarp-asset-coupon-border-bottom mui-mbarp-asset-member-coupon-item-border">',"</div>"].join("");var f=[];if(e.inTmallbaoTime){var h="http://gtms03.alicdn.com/tps/i3/TB19WTGGpXXXXXsXVXXSXBkHXXX-200-70.jpg";if(e.showTmallBaoDaily){h=e.tmallBaoDailyBanner}if(h){var g=e.tmallBaoLink||"http://chong.alipay.com/i/chong.htm?scm=1048.1.3.29";f=['<div class="mui-mbarp-asset-tmall-bao"><a class="mui-mbarp-asset-tmall-bao-link" href="'+g+'" target="_blank">','<img src="'+h+'" width="200" height="70"/>',"</a></div>"]}}var v=r.get("closeSaleNum")||0;if(!e.inShowTime){v=0}var _=['<div class="mui-mbarp-asset-first-buy">','<a href="http://vip.tmall.com/privilege/vipfirst?scm=1048.1.3.30">\u4f1a\u5458\u4f18\u5148\u8d2d\u4e70\u5238<span class="mui-mbarp-asset-card-num">'+v+"</span>",'<div class="mui-mbarp-asset-card-time" >11\u670809\u65e510\u70b9\u81f310\u65e520\u70b9\u6709\u6548</div>',e.inActiveTime?'<div class="mui-mbarp-asset-first-buy-notice">\u5929\u732b\u4f1a\u5458\u5728\u6d3b\u52a8\u671f\u95f4\uff0811\u67089\u65e510:00 -11\u670810\u65e520:00\uff09\u53ef\u4ee5\u5728\u624b\u673a\u5929\u732b\u4f18\u5148\u62a2\u8d2d11.11\u72c2\u6b22\u8282\u5546\u54c1\u3002</div>':"","</a>","</div>"];var T="";if(!e.notNeedShopCard&&e.shopCard&&e.shopCard.list){T=t._renderShopCard(e.shopCard.list)}var A="";if(m.c.l.length==0&&m.c.j.length==0&&m.c.o.length==0&&m.c.m==0){A=['<div class="mui-mbarp-asset-wrap">',c.join(""),f.join(""),v?_.join(""):"",b.join(""),T,'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-cur-coupon">',"</div>",'<div class="mui-mbarp-asset-coupon-title" id="mbarCouponAnchorCouldCoupon">&nbsp;',"</div>",'<h2 class="mui-mbar-asset-no-coupon">\u55b5\uff01\u4f60\u8fd8\u6ca1\u9886\u53d6\u8fc7\u5929\u732b\u4f18\u60e0\u5238\uff01<br />\u5feb\u53bb\u9886\u53d6\u5427\uff01</h2>',"</div>"]
}else{function C(a,e){if(!a){return}if(a.indexOf("?")==-1){a+="?scm="+e}else{a+="&scm="+e}return a}a.each(m.c.l,function(a){a.u=C(a.u,"1048.1.3.2");a.curCoupon=true;a.diffDay=t._getDiffDay(a.l);a.nt=a.n;if(a.f){a.nt=n.sub(a.n,14)}});a.each(m.c.j,function(a){a.u=C(a.u,"1048.1.3.5");a.diffDay=t._getDiffDay(a.l);a.nt=a.n;if(a.f){a.nt=n.sub(a.n,19)}});a.each(m.c.o,function(a){a.u=C(a.u,"1048.1.3.3");a.diffDay=t._getDiffDay(a.l);a.nt=a.n;if(a.f){a.nt=n.sub(a.n,14)}});a.each(m.c.g,function(a){a.u=C(a.u,"1048.1.3.6");a.diffDay=t._getDiffDay(a.l);a.nt=a.n;if(a.f){a.nt=n.sub(a.n,14)}});a.each(m.c.m,function(a){a.u=C(a.u,"1048.1.3.6");a.diffDay=t._getDiffDay(a.l)});function I(a,e){var t="";t+=['<div class="mui-mbarp-asset-wrap">',c.join(""),f.join(""),v?_.join(""):"",b.join(""),'<div class="mui-mbarp-asset-coupon">',"{{#with c}}"].join("");if(e||a){t+=['<div class="mui-mbarp-asset-line-h"></div>','<div class="mui-mbarp-asset-coupon-title" id="mbarCouponAnchorAbleCoupon">',"\u53ef\u7528\u4f18\u60e0\u5238","</div>",'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-cur-coupon">'].join("");if(a){t+=["{{#each m}}",p,"{{/each}}"].join("")}if(e){t+=["{{#each l}}",d.join(""),"{{/each}}"].join("")}t+='<div class="mui-mbarp-asset-shop-push-items j_pushShopItems"></div>'}else{t+='<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-cur-coupon">'}t+=["</div>",'<div class="mui-mbarp-asset-coupon-title" id="mbarCouponAnchorCouldCoupon">&nbsp;',"</div>","{{#if j_len}}",'<div class="mui-mbarp-asset-coupon-title" id="mbarCouponAnchorExpCoupon">',"\u5373\u5c06\u8fc7\u671f","</div>","{{/if}}",'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-exp-coupon">',"{{#each j}}",d.join(""),"{{/each}}","{{#if j_len}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="http://mybrand.tmall.com/myCoupon.html?scm=1048.1.3.16#failcoupon" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}","</div>","{{#if o_len}}",'<div class="mui-mbarp-asset-coupon-title">',"\u6211\u9886\u53d6\u7684\u4f18\u60e0\u5238","</div>","{{/if}}",'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-oth-coupon">',"{{#each o}}","{{#if xindex<10}}",d.join(""),"{{/if}}","{{/each}}","{{#if o_len}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="http://mybrand.tmall.com/myCoupon.html?scm=1048.1.3.17" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}","</div>","{{#if g_len}}",'<div class="mui-mbarp-asset-coupon-title">',"\u5546\u5bb6\u8d60\u9001\u7684\u4f18\u60e0\u5238","</div>","{{/if}}",'<div class="mui-mbarp-asset-coupon-bd j_mui-mbarp-asset-oth-coupon">',"{{#each g}}","{{#if xindex<3}}",d.join(""),"{{/if}}","{{/each}}","{{#if g_len}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="http://mybrand.tmall.com/myCoupon.html?scm=1048.1.3.6" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}","</div>","{{/with}}","</div>","</div>"].join("");return t}var E=!!m.c.m?m.c.m.length:0;var B=!!m.c.l?m.c.l.length:0;A=I(E,B)}if(m.b){m.b_l_len=0;a.each(m.b,function(a,e){if(typeof a!=="number"){if(e=="l"){m.b_l_len=a.length}}})}if(m.c){m.j_len=0;m.o_len=0;m.l_len=0;m.g_len=0;m.m_len=0;m.ableShow=0;a.each(m.c,function(a,e){if(typeof a!=="number"){switch(e){case"j":m.j_len=a.length;break;case"l":m.l_len=a.length;break;case"o":m.o_len=a.length;break;case"g":m.g_len=a.length;break;case"m":m.m_len=a.length;break}}})}if(a.isArray(A)){A=A.join("")}var S=new o(A).render(m);l.html(S);var O=a.one("#"+t.get(s.K.COUPON_ANCHOR));if(O){var L=O.offset().top-O.height()-10-a.one(window).scrollTop();l.scrollTop(L);t.set(s.K.COUPON_ANCHOR,"")}var R=l.one(".mui-mbar-asset-no-coupon");if(R){n.getStaticConf({cb:function(a){if(a.showZeroCoupon){R.html(n.fm('{0} <a class="mui-mbarp-asset-getCoupon" href="{1}" target="_blank">\u7acb\u5373\u9886\u53d6</a>',a.zeroCouponTxt,a.zeroCouponUrl))}}})}},cutStr:function(a,e){if(!a){return""}a=a.replace(/<a[^>]*?>([\w\W]+)<\/a>/gi,"$1");if(a.length<=e){return a}return a.substr(0,e)+"..."},getIntegral:function(){var e=this;var t=e.get(s.K.MALLBAR_ITEM);var i=t.getUserInfo();var r=i.memberInfo.availablePoints;r=a.isNumber(r)?r:s.DEGRADE;if(r==s.DEGRADE){return"-"}return e._formatInteral(r)},now:function(){var a=this;return a.get(s.K.MALLBAR_ITEM).getServerTime()},_getDiffDay:function(a){if(!a){return}var e,t,i,r,s=this;e=a.replace(/\./g,"/");t=new Date(e);i=new Date(s.dateFormat(s.now(),"yyyy/MM/dd"));r=parseInt(Math.abs(t-i)/1e3/60/60/24,10);if(r>0){return r+1+"\u5929"}else{var n=parseInt(Math.abs(t-s.now())/1e3/60/60)+1;var o="\u7a0d";if(n>0){o=n+"\u5c0f\u65f6"}return o}},_formatInteral:function(a){a=Number(a);if("NaN"==typeof a){throw Error("\u53c2\u6570\u7c7b\u578b\u9519\u8bef\uff0c\u8bf7\u4f20\u5165\u6570\u503c\u7c7b\u578b\u7684\u53c2\u6570")}if(a>=1e6){return parseInt(a/1e6,10)+"00\u4e07+"}else if(a>=1e7){return parseInt(a/1e7,10)+"000\u4e07+"}return a},_couponTemp:new o(['<a style="height:0; overflow: hidden;" class="mui-mbarp-asset-coupon-item mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}} ','{{#if a>1}}mui-mbarp-asset-coupon-{{#if d>=0&&d<=20}}blue{{/if}}{{#if d>20&&d<=50}}red{{/if}}{{#if d>50}}yellow{{/if}}-multi{{/if}}" href="javascript:;" target="_blank">','<div class="mui-mbarp-asset-coupon-border-top"></div>','<div class="mui-mbarp-asset-coupon-item-content">','<p class="mui-mbarp-asset-coupon-item-hd">','<span class="mui-mbarp-asset-coupon-item-tips ">',"{{t}}</span>",'<span class="mui-mbarp-asset-coupon-item-name" title="{{n}}">',"{{#if f}}",'<span class="mui-mbarp-asset-tmgj-flag "> </span>',"{{/if}}","{{nt}}</span>","</p>",'<div class="mui-mbarp-asset-coupon-item-bd mui-mbarp-clearfix">','<div class="mui-mbarp-asset-coupon-item-bd-right">',"<p>{{s}}</p>","<p>-&nbsp;{{l}}</p>","</div>",'<div class="mui-mbarp-asset-bonus-item-left">','<p class="mui-mbarp-asset-coupon-item-rmb">','\uffe5<span class="mui-mbarp-asset-coupon-item-rmb-rmb ','{{#if d>999}}mui-mbarp-asset-coupon-item-rmb-demotion{{/if}}">{{d}}</span>','{{#if a>1}} <span class="mui-mbarp-asset-coupon-x">x</span> <span class="mui-mbarp-asset-coupon-item-rmb-multi">{{a}}\u5f20</span>{{/if}}',"</p>",'<p class="mui-mbarp-asset-coupon-item-condition">\u6ee1{{c}}\u4f7f\u7528{{#if i===1}}</br>(\u90e8\u5206\u5546\u54c1\u53ef\u7528){{/if}}</p>',"</div>","</div>","</div>",'<div class="mui-mbarp-asset-coupon-border-bottom"></div>',"</a>"].join("")),_assetCouponBubbleTPL:function(a){var e;e='<div class="j_Asset_Bubble mui-mbarp-asset-coludCouponBubble-content mui-mbar-bubble">';e+='<div class="mui-mbar-arr mui-mbar-bubble-arr">\u25c6</div>';e+='<div class="mui-mbar-bubble-close"></div>';e+='<div class="mui-mbarp-asset-bubble-top"></div>';e+=a;e+='<div class="mui-mbarp-asset-bubble-bottom"></div>';e+="</div>";return e}});return u},{requires:["base","node","anim","event","mui/mallbar/conf","mui/mallbar/util","xtemplate","mui/mallbar/store","mui/mallbar/plugin-asset.css"]});KISSY.add("mui/mallbar/plugin/brand",function(a,e,t,i,r,s){var n=function(a){var e=this;e.showCoupon=false;n.superclass.constructor.call(e,a);e.init()};a.extend(n,e,{init:function(){var e=this;e.isAjaxMemberRight=false;var s=e.get(i.K.CONTAINER);var n=e.mallbarItem=e.get(i.K.MALLBAR_ITEM);var o=r.getSysId();e.isList=o=="list";e.isDetail=o=="detail";e.isShop=o=="shop";e.isAjaxMemberRight=e.isList;var m=n.get(i.K.MALLBAR);e.brandId=m.get("brandId")||"";var l={noBrands:'<h2 class="mui-mbar-brand-no">\u55b5\uff01\u4f60\u8fd8\u6ca1\u6709\u5173\u6ce8\u8fc7\u54c1\u724c\uff01<br />\u770b\u770b\u4e0b\u9762\u7684\u63a8\u8350\u54c1\u724c\u5427\uff01</h2>',myBrands:'<div class="mui-mbar-brand-list">{{#each m}}<div class="{{#if pic}}mui-mbar-brand-pic{{else}}mui-mbar-brand-box{{/if}}{{#if xindex<1}} mui-mbar-brand-first{{/if}}">                                {{#if pic}}                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-logo">{{#if logo}}<img alt="{{name}}" width="70" height="35" src="{{logo}}">{{else}}<b>{{name}}</b>{{/if}}</a>                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-i">{{#if tag}}<b class="mui-mbar-brand-tag-{{tag}}"></b>{{/if}}<img width="200" height="200" src="{{pic}}_250x250.jpg" alt="" /><b class="{{#if news}}mui-mbar-brand-desc{{else}}mui-mbar-brand-desc mui-mbar-brand-newsNo{{/if}}"><b class="mui-mbar-brand-news">{{news}}</b>\u4e2a\u54c1\u724c\u52a8\u6001</b></a>                                {{else}}                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-logo">{{#if logo}}<img alt="{{name}}" width="70" height="35" src="{{logo}}">{{else}}{{name}}{{/if}}</a>                                {{/if}}                                </div>                            {{/each}}</div>',aldBrands:'<h2 class="mui-mbar-brand-title mui-mbar-brand-ald">\u63a8\u8350\u54c1\u724c</h2>                            <div class="mui-mbar-brand-list">{{#each a}}<div class="{{#if pic}}mui-mbar-brand-pic{{else}}mui-mbar-brand-box{{/if}}{{#if xindex<1}} mui-mbar-brand-first{{/if}}">                                {{#if pic}}                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-logo">{{#if logo}}<img alt="{{name}}" width="70" height="35" src="{{logo}}">{{else}}<b>{{name}}</b>{{/if}}</a>                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-i">{{#if tag}}<b class="mui-mbar-brand-tag-{{tag}}"></b>{{/if}}<img width="200" height="200" src="{{pic}}_250x250.jpg" alt="" /><b class="{{#if news}}mui-mbar-brand-desc{{else}}mui-mbar-brand-desc mui-mbar-brand-newsNo{{/if}}"><b class="mui-mbar-brand-news">{{news}}</b>\u4e2a\u54c1\u724c\u52a8\u6001</b></a>                                {{else}}                                    <a href="{{url}}" target="_blank" class="mui-mbar-brand-logo">{{#if logo}}<img alt="{{name}}" width="70" height="35" src="{{logo}}">{{else}}{{name}}{{/if}}</a>                                {{/if}}                                </div>                            {{/each}}</div>',moreURL:'<a class="mui-mbar-brand-more" href="{{u}}" target="_blank">\u67e5\u770b\u66f4\u591a<b></b></a>'};function b(){var a=n.get(i.K.DATA);if(a.i1){r.ajax({url:i.URL.GET_PLUGIN_GET_BRAND,data:{},timeout:4,success:function(a){if(a.s!==200){r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.brand.brandContent.failure.bad-status-"+a.s,"\u83b7\u53d6\u6211\u5173\u6ce8\u7684\u54c1\u724c\u5185\u5bb9\u5f02\u5e38");return n.fire(i.E.ERROR)}var e='<div id="J_MuiMbarBrandBd" class="mui-mbar-brand-bd">                                 {{#if m&&m.length}} '+l.myBrands+"{{else}} "+l.noBrands+" {{/if}}                                 {{#if a&&a.length}} "+l.aldBrands+"{{/if}}                                 {{#if u}} "+l.moreURL+"{{/if}}                                 </div>";s.html(new t(e).render(a.m));if(a.mai){r.sendLog(a.mai)}c=false},jsonpCallback:"__mallbarBrand",error:function(){n.fire(i.E.ERROR);r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.brand.brandContent.get.failure","\u83b7\u53d6\u6211\u5173\u6ce8\u7684\u54c1\u724c\u5185\u5bb9\u5931\u8d25")}})}}var u=e.userInfo=n.getUserInfo();e.token="";e.bubbled=false;if((e.isList||e.isShop)&&e.brandId){if(u.isLogin){d()}else{n.on(i.E.LOGIN_SUCCESS,function(a){r.log(a.type);d()})}}var c=true;e.on(i.E.VISIBILITY_CHANGE,function(a){if(e.showCoupon){e.showMemberCoupon();e.showCoupon=false}else{if(a.visible&&c){n.fire(i.E.SUPTIP_CHANGE,{show:false});b()}}});e.on(i.E.DATA_CHANGE,function(a){c=true;if(n.get(i.K.EXPAND)){b()}});function d(){var t=n.get(i.K.MALLBAR);t.getCueMsgInfo(function(t){a.log(t);if(t.s!=200){r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.brand.cueAssetMsg.failure.bad-status-"+t.s,"\u83b7\u53d6\u6211\u5173\u6ce8\u7684\u54c1\u724c\u7684\u4f18\u60e0\u5238\u6c14\u6ce1\u63d0\u9192\u5f02\u5e38");return false}e.token=t.t;if(t.m&&t.m.p==2){e.memberRightType=!!t.m.rt?t.m.rt:0;e.handBrandBubble(t)}})}},handBrandBubble:function(e){var s=this;var n=s.mallbarItem;var o=n.get(i.K.MALLBAR);var m=e.m;if(a.isUndefined(m)){return}var l="";var b='<div class="mui-mbarp-asset-memberCouponBubble-content mui-mbar-bubble {{#if rt!==2}} mui-mbarp-asset-memberCouponBubble-content-brand{{/if}}">'+'<div class="mui-mbar-arr mui-mbar-bubble-arr mui-mbar-asset-member-bubble-arr">\u25c6</div>'+'<div class="mui-mbarp-asset-member-bubble-top"></div>'+'<div class="mui-mbarp-asset-memberCouponBubble-zindex-0 mui-mbarp-asset-memberCouponBubble {{#if rt!==2}}mui-mbarp-asset-memberCouponBubble-zindex-0-brand{{/if}}">'+' <p class="mui-mbarp-asset-memberCouponBubble-title mui-mbarp-asset-memberCouponBubble-title-denomination">'+"{{#if v}}"+'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>'+"{{/if}}"+"{{t}}</p>"+'<p class="mui-mbarp-asset-memberCouponBubble-trmb"{{#if rt!==2}} title="{{b}}" {{/if}} >'+"{{#if rt===2}}"+'<span class="mui-mbarp-asset-memberCouponBubble-rmb_icon">\uffe5</span>'+'<span class="mui-mbarp-asset-memberCouponBubble-rmb">{{m}}</span><span>\u73b0\u91d1\u5238</span></p>'+"{{/if}}"+"{{#if rt===1}}"+'{{bt}}</p><p class="mui-mbarp-asset-memberCouponBubble-brand">\u6298\u6263</p>'+"{{/if}}"+"{{#if rt===3}}"+'{{bt}}</p><p class="mui-mbarp-asset-memberCouponBubble-brand">\u8bd5\u7528</p>'+"{{/if}}";b+='<p class="mui-mbarp-asset-memberCouponBubble-now_use"><a>{{a}}</a></p>'+'<div class="mui-mbarp-asset-member-bubble-bottom"></div>'+"</div>";l=b;if(m.rt!=2){if(m.b){m.bt=r.sub(m.b,15)}}var u=new t(l).render(m);o.bubble({show:true,content:u,customContentType:3,bubbleType:i.B.FOREVER,isNotTabFire:false,tab:"BRAND",showed:function(){r.sendLog(i.ARR.COUPON_MEMBER_BUBBLE_B_SHOW)},clicked:function(){s.showCoupon=true;r.sendLog(i.ARR.COUPON_MEMBER_BUBBLE_B_CLICK)}})},showMemberCoupon:function(){var e=this;var s=['<div class="mui-mbarp-brand-member-coupon-div mui-mbarp-brand-member-coupon-div-margin">','<a class="mui-mbarp-brand-member-coupon-item" href="{{u}}" target="_blank">','<p class="mui-mbarp-brand-member-coupon-item-title">{{n}}</p>','<p class="mui-mbarp-brand-member-coupon-item-iconp" ><span class="mui-mbarp-brand-member-coupon-item-icon">',"{{#if v}}"+'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>',"{{/if}}","{{r}}</span></p>",'<p class="mui-mbarp-brand-member-coupon-item-trmb" title="\uffe5{{cm}}\u73b0\u91d1\u5238"><span class="mui-mbarp-brand-member-coupon-item-rmb">\uffe5</span> <span class="mui-mbarp-brand-member-coupon-item-rmbn">{{cm}}</span>\u73b0\u91d1\u5238</p>','<p class="mui-mbarp-brand-member-coupon-item-now_use"><span>{{a}}</span></p>','<p class="mui-mbarp-brand-member-coupon-item-time">\u6d3b\u52a8\u65f6\u95f4:{{t}}</p>',"</a>","</div>"].join("");var n=['<div class="mui-mbarp-brand-member-coupon-recom">','<a class="mui-mbarp-brand-member-coupon-item" href="{{u}}" target="_blank">','<img  class="mui-mbarp-brand-member-coupon-recom-img" src="{{tps}}" alt="{{n}}">','<p class="mui-mbarp-brand-member-coupon-recom-title" title="{{n}}">{{n}}</p>','<p class="mui-mbarp-brand-member-coupon-recom-rmb"><span class="mui-mbarp-brand-member-coupon-recom-rmb_1">\uffe5{{tp}}</span>','<p class="mui-mbarp-brand-member-coupon-recom-condition">\u9650\u91cf<span>{{tt}}</span>\u4efd</p>','<p class="mui-mbarp-brand-member-coupon-recom-apply">{{a}}</p>',"</a>","</div>"].join("");var o=['<div class="mui-mbarp-brand-member-coupon-div">','<a class="mui-mbarp-brand-member-coupon-item" href="{{u}}" target="_blank">','<p class="mui-mbarp-brand-member-coupon-item-title">{{n}}</p>','<p class="mui-mbarp-brand-member-coupon-item-iconp" ><span class="mui-mbarp-brand-member-coupon-item-icon">'+"{{#if v}}"+'<i class="mui-mbar-iconfont mui-mbarp-asset-memberCouponBubble-heart">&#xe600;</i>'+"{{/if}}"+"{{r}}</span></p>",'<p class="mui-mbarp-brand-member-coupon-item-trmb"><span class="mui-mbarp-brand-member-coupon-item-discout">{{dr}}</span></p>','<p class="mui-mbarp-brand-member-coupon-item-now_use"><span >{{a}}</span></p>','<p class="mui-mbarp-brand-member-coupon-item-time">\u6d3b\u52a8\u65f6\u95f4:{{t}}</p>',"</a>","</div>","{{#if dit}}",'<div class="mui-mbarp-brand-member-coupon-vip-dis">','<div class="mui-mbar-arr mui-mbarp-brand-member-coupon-vip-dis-arr">\u25c6</div>','<p class="mui-mbarp-brand-member-coupon-vip-dis-p">\u4ee5\u4e0b\u5546\u54c1\u4e13\u4eab\u6298\u6263\u4ef7:</p>',"{{/if}}","<ul>","{{#each dit}}","<li>",'<a class="mui-mbarp-brand-member-coupon-item"href="{{diu}}" target="_blank">','<img src="{{dpu}}" class="mui-mbarp-brand-member-coupon-vip-dis-img60">','<div class="mui-mbarp-brand-member-coupon-vip-dis-div">','<p class="mui-mbarp-brand-member-coupon-vip-dis-title" title="{{din}}">{{din}}</p>','<p class="mui-mbarp-brand-member-coupon-vip-dis-icon"><span>T{{dil}}</span>\u4e13\u4eab{{did}}\u6298</p>',"</div>","</a>","</li>","{{/each}}","</ul>","</div>","{{#if dit}}",'<a class="mui-mbar-more mui-mbar-asset-more" href="http://brand.tmall.com/brandInfo.htm?brandId='+(!!e.brandId?e.brandId:"")+'&scm=1048.1.4.19" target="_blank">',"\u67e5\u770b\u66f4\u591a<b></b>","</a>","{{/if}}"].join("");var m=!!e.brandId?e.brandId:"";var l=!!e.memberRightType?e.memberRightType:0;if(e.isAjaxMemberRight){r.ajax({url:i.URL.GET_PLUGIN_MEMBER_RIGHT,data:{brandId:m,type:l},timeout:4,jsonpCallback:"__mallbarMemberRight",success:function(m){if(m.s!=200){e.mallbarItem.fire(i.E.ERROR);r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.brand.memberRight.failure.bad-status-"+m.s,"\u6211\u5173\u6ce8\u7684\u54c1\u724c\u83b7\u53d6\u4f1a\u5458\u6743\u76ca\u5238\u5f02\u5e38")}e.token=m.t;if(m.c&&m.c.length){var l=m.c,b=m.c.length,u="";for(var c=0;c<b;c++){var d="";var p=l[c];if(p[0].ty==2){u+='<p class="mui-mbarp-brand-member-coupon-recom-p">\u5f53\u524d\u54c1\u724c\u53ef\u7528\u4f18\u60e0\u5238</p>';a.each(p,function(a){!!a&&(a.u="http://brand.tmall.com/brandInfo.htm?&brandId="+e.brandId);!!a.u&&(a.u=r.addSCM(a.u,"1048.1.99.1"))});for(var f=0;f<p.length;f++){u+=new t(s).render(p[f])}}else if(p[0].ty==1){u+='<p class="mui-mbarp-brand-member-coupon-recom-p">\u5f53\u524d\u54c1\u724c\u4e13\u4eab\u54c1\u724cVIP\u6298\u6263\u4ef7</p>';a.each(p,function(t){!!t&&(t.u="http://brand.tmall.com/brandInfo.htm?&brandId="+e.brandId);!!t.u&&(t.u=r.addSCM(t.u,"1048.1.4.18"));if(!!t.dit){a.each(t.dit,function(a){!!a.diu&&(a.diu=r.addSCM("http://detail.tmall.com/item.htm?id="+a.diu,"1048.1.99.2"));!!a.did&&(a.did=a.did/100)})}});for(var f=0;f<p.length;f++){u+=new t(o).render(p[f])}}else if(p[0].ty==3){u+='<p class="mui-mbarp-brand-member-coupon-recom-p">\u5f53\u524d\u54c1\u724c\u53ef\u7528\u8bd5\u7528\u4ea7\u54c1</p>';a.each(p,function(a){!!a.u&&(a.u=r.addSCM("http://shiyong.tmall.com/try/payTryItem.htm?id="+a.u,"1048.1.99.3"))});for(var f=0;f<p.length;f++){u+=new t(n).render(p[f])}}}u+='<div class="mui-mbarp-brand-member-coupon-div-bottom"></div>';var h=e.get(i.K.CONTAINER);h.html(u)}},error:function(){e.mallbarItem.fire(i.E.ERROR);r.codeTracker.sendTrack(i.T.NUMLEV,"mallbar.brand.memberRight.get.failure","\u6211\u5173\u6ce8\u7684\u54c1\u724c\u83b7\u53d6\u4f1a\u5458\u6743\u76ca\u5238\u5931\u8d25")}})}}});return n},{requires:["base","xtemplate","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-brand.css"]});KISSY.add("mui/mallbar/plugin/live",function(a,e,t,i,r,n,s,o,m){var l=window.location.href.indexOf("mbar-debug=1")>-1;var u=function(a){var e=this;u.superclass.constructor.call(e,a);e.init()};var c='<div class="mui-mbarp-live-wrap"><p class="mui-mbarp-live-tab-p">'+'<span class="mui-mbarp-live-tab-title" id="mui-mbarp-live-tab-live-id">\u76f4\u64ad\u9891\u9053</span>'+'<span class="mui-mbarp-live-tab-title" id="mui-mbarp-live-tab-shop-id">\u5e97\u94fa\u9891\u9053</span>'+"</p>"+'<div class="mui-mbarp-live-tab-content-live"></div>'+'<div class="mui-mbarp-live-tab-content-shop"></div>'+"</div>";var b='<div class="mui-mbarp-live-wrap">'+'<div class="mui-mbarp-live-tab-content-live"></div>'+"</div>";var d=['<div class="mui-mbarp-live-msgs"></div>','<div class="mui-mbarp-live-load"></div>','<div class="mui-mbarp-live-more">\u67e5\u770b\u66f4\u591a<span class="mui-mbar-iconfont">&#xe601;</span></div>','<div class="mui-mbarp-live-more-nomsg">\u55b5\uff0c\u5df2\u7ecf\u662f\u6700\u540e\u7684\u6d88\u606f\u54af\uff01\uff01</div>'].join("");var p="mui/mallbar/live/show";var f="";var v=new r(["{{#each msgs}}",'<div class="mui-mbarp-live-msg {{#if d11}}mui-mbarp-live-msg-d11{{/if}}">',"  {{#if src}}",'  {{#if link}}<a target="_blank" href="{{link}}">{{/if}}','  <img class="mui-mbarp-live-img" src="{{src}}" title="{{desc}}"/>',"  {{#if link}}</a>{{/if}}","  {{/if}}",'  <div class="mui-mbarp-live-title {{#if src===""&&d11}}mui-mbarp-live-title-noimg{{/if}}">','    <a class="mui-mbarp-live-title-h" target="{{#if link}}_blank{{else}}_self{{/if}}" href="{{#if link}}{{link}}{{else}}javascript:;{{/if}}" title="{{t}}"> {{title}} </a>','    {{#if content}}<div class="mui-mbarp-live-content">{{{content}}}</div>{{/if}}',"  </div>",'  <div class="mui-mbarp-live-date"> <p>{{date}}</p> </div>',"</div>","{{/each}}"].join(""));var h="\u53cc11";var g=new r(['<div class="mui-mbarp-live-bub">','  <div class="mui-mbarp-live-msg {{#if d11}}mui-mbarp-live-msg-d11{{/if}}">','  <div class="mui-mbarp-live-msg-bub">',"  {{#if i}}",'  {{#if u}}<a target="_blank" href="{{u}}">{{/if}}','  <img class="mui-mbarp-live-img" src="{{i}}" title="{{t}}"/>',"  {{#if u}}</a>{{/if}}","  {{/if}}",'  <div class="mui-mbarp-live-close"></div>','  <div class="mui-mbarp-live-msg-bub-title {{#if i===""&&d11}}mui-mbarp-live-msg-bub-title-noimg{{/if}}">','    {{#if u}}<a target="_blank" href="{{u}}" title="{{t}}">{{/if}}',"    {{title}} ","    {{#if u}}</a>{{/if}}","  </div>","  </div>","  </div>","</div>"].join(""));var _=new r(['<div class="mui-mbar-bubble mui-mbarp-bubble-live-act">','<div class="mui-mbar-arr mui-mbarp-bubble-live-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-live-bubble-act-close"></div>','<div class="mui-mbarp-bubble-live-act-bd">',"  {{#if i}}",'  {{#if u}}<a target="_blank" href="{{u}}">{{/if}}','  <img class="mui-mbarp-live-bubble-img" src="{{i}}" title="{{t}}"/>',"  {{#if u}}</a>{{/if}}","  {{/if}}",'  <div class="mui-mbarp-live-msg-bubble-act-title  {{#if i===""&&d11}}mui-mbarp-live-msg-bub-title-noimg{{/if}}">','    {{#if u}}<a target="_blank" href="{{u}}" title="{{t}}">{{/if}}',"    {{title}} ","    {{#if u}}</a>{{/if}}","  </div>","</div>","</div>","</div>"].join(""));var T=new r(['<div class="mui-mbar-bubble mui-mbarp-bubble-live-shop" >','<div class="mui-mbar-arr mui-mbarp-bubble-shop-arr">\u25c6</div>','<div class="mui-mbarp-bubble-live-shop-bd">',"{danmuHtml}",'<div class="mui-mbarp-bubble-live-shop-chat"><div class="mui-mbarp-bubble-live-shop-logo"><span></span><span></span><span class="mui-mbarp-bubble-live-shop-logo-s"></span><span></span><span></span><span></span><span></span><span class="mui-mbarp-bubble-live-shop-logo-s"></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><p class="mui-mbarp-bubble-live-shop-chat-tips">{{#if n}}{{n}}\u4eba\u70ed\u804a\u4e2d{{/if}}</p><p class="mui-mbarp-bubble-live-shop-chat-p" title="{{a}}">{{a}}</p></div>','<p class="mui-mbarp-bubble-live-shop-act-more">{{t}}<span class="mui-mbarp-bubble-live-shop-left mui-mbar-iconfont">&#xe60b;&#xe60b;</span></p>','<div class="mui-mbarp-bubble-live-shop-ww" data-tribeid="{{groupId}}"></div>',"</div>","</div>"].join(""));var A=true;var I;a.extend(u,e,{init:function(){var e=this;o.getStaticConf({cb:function(t){var i=e.get(s.K.CONTAINER);var r=e.get(s.K.MALLBAR_ITEM);var n=r.get(s.K.MALLBAR);var u=r.get(s.K.TAB);var d=u.one(".mui-mbar-tab-sup");e.tip=d;var p=r.getUserInfo();var f=r.get(s.K.DATA);var v=n.get(s.K.MODEL);var h=v.get(s.K.BAR);function g(a){m.get({k:h.w.storeKey,success:function(t){if(!t){!!a&&(h.w.bubNum=a);e._showWWBubble(h.w)}else{e.tip.html('<div class="mui-mbar-iconfont mui-mbarp-live-reddot">&#xe603;</div>');e.tip.show()}},error:function(){!!a&&(allbarData.w.bubNum=a);e._showWWBubble(h.w)}})}if(h&&h.w&&h.w.id&&h.w.a){o.log("::plugin live::wwData",h.w);a.getScript(s.U.WW_MODULE,function(){if(window.TribeLight){TribeLight.openTribeWindow=function(a){window.location.href="aliim:tribevisit?tribeid="+a};TribeLight.unInstall=function(){a.use("mui/overlay/alert",function(a,e){var t=function(a){var t=new e({tip:'\u60a8\u8fd8\u672a\u5b89\u88c5\u65fa\u65fa\uff0c\u8bf7\u5148\u5b89\u88c5\u65fa\u65fa\u518d\u8fdb\u5165\u804a\u5929\u5ba4\uff01<a href="http://wangwang.taobao.com/" target="_blank">\u70b9\u51fb\u4e0b\u8f7d\u65fa\u65fa</a>',skin:a,showCat:true});t.render();t.show()};t("red")})}}i.html(c);var t=true;e.isFirstShop=true;e.set("isHasChat",true);e.set("isShopLive",true);e.chatId=h.w.id||"";i.one("#mui-mbarp-live-tab-live-id").on("click",function(r){var n=a.one(r.target);i.all(".mui-mbarp-live-tab-title").removeClass("mui-mbarp-live-tab-title-clicked");n.addClass("mui-mbarp-live-tab-title-clicked");i.one(".mui-mbarp-live-tab-content-shop").hide();i.one(".mui-mbarp-live-tab-content-live").show();if(t){t=false;e._showTabLive()}});i.one("#mui-mbarp-live-tab-shop-id").on("click",function(t){var r=a.one(t.target);i.all(".mui-mbarp-live-tab-title").removeClass("mui-mbarp-live-tab-title-clicked");r.addClass("mui-mbarp-live-tab-title-clicked");i.one(".mui-mbarp-live-tab-content-live").hide();i.one(".mui-mbarp-live-tab-content-shop").show();if(e.isFirstShop){e.isFirstShop=false;e._showTabShop()}});if(h.w.a){var u=o.getSysId();e.isShop=u=="shop";r.fire(s.E.SUPTIP_CHANGE,{show:false});o.getStaticConf({cb:function(a){var t=h.w.groupInfo||"";var i=!a.groupNumLimit||a.groupNumLimit>t;e.set("groupNumOk",i);if(!a.notLiveChatBubble&&i){if(a.notDanmuMsg){!!h.w.wl&&(h.w.wl="")}h.w.storeKey="mui/mbarp/live/bubble/"+n.get("sellerId");if(l){e._showWWBubble(h.w)}else{if(a.danmuBubMax&&a.danmuBubExpire){var r=a.danmuBubMax;e.danmuBubExpire=a.danmuBubExpire;var s="mui/mbarp/live/danmu/all/num";e.danmuAllKey=s;m.get({k:s,success:function(a){if(!a){a=1;g(a)}else{a=a||0;if(a<r){a=a+1;g(a)}}},error:function(){g()}})}else{g()}}}}})}})}else{i.html(b);if(!p.isLogin||p.isLogin&&f.m>0){e._showActbubble(t)}}e.on(s.E.VISIBILITY_CHANGE,function(a){if(a.visible&&A){r.fire(s.E.SUPTIP_CHANGE,{show:false});if(e.get("isHasChat")){if(e.get("isShopLive")){i.one("#mui-mbarp-live-tab-shop-id").fire("click")}else{i.one("#mui-mbarp-live-tab-live-id").fire("click")}}else{e._showTabLive()}A=false}});e.on(s.E.DATA_CHANGE,function(a){A=true;if(r.get(s.K.EXPAND)){if(e.get("isHasChat")){if(e.get("isShopLive")){i.one("#mui-mbarp-live-tab-shop-id").fire("click")}else{i.one("#mui-mbarp-live-tab-live-id").fire("click")}}else{e._showTabLive()}}})}})},initDanmu:function(e){if(e&&e.length>0){var t=this;var i=t.get(s.K.MALLBAR_ITEM);var r='<p><img src="http://a.tbcdn.cn/apps/mytaobao/3.0/profile/defaultAvatar/ww-avatar-30.jpg" width="30" height="30"/><span style="margin-left: {1}px">\u201c'+"{0}"+"\u201d</span></p>";var n=['<div class="mui-mbarp-live-danmu-cont"><div class="mui-mbarp-live-danmu-box">'];a.each(e,function(a,e){n.push(o.fm(r,a))});n.push("</div></div>");return n.join("")}},_showWWBubble:function(e){var t=this;var i=t.get(s.K.MALLBAR_ITEM);var r=i.get(s.K.MALLBAR);var n=i.get(s.K.TAB);var l=i.get(s.K.BUBBLE);var u=e.bubNum||"";var c=e.a||"";!!c&&(c=c.split("|"));!!c.length&&(c=c[0].split(","));e.a=c[0];e.n=e.groupInfo||"";var b="";!!e.wl&&(e.wl=JSON.parse(e.wl));if(a.isArray(e.wl)&&e.wl.length){b=t.initDanmu(e.wl)||""}else{b=""}e.groupId=t.chatId;o.log("\u64cd\u4f5c\u7cfb\u7edf",a.UA.os);var d=a.UA.os;var p="";var f="";var v;if(b){v=160}if(d=="windows"){e.t="\u53bb\u804a\u5929\u5ba4\u770b\u66f4\u591a\u6d3b\u52a8";p=function(){o.sendLog(s.ARR.LIVE_CHAT_BUBBLE_CLICK_TO_WW);r.bubble({show:false,tab:"LIVE"});var e=a.one(".mui-mbarp-bubble-live-shop-ww").attr("data-tribeid");t._openww(e)}}else{e.t="\u67e5\u770b\u66f4\u591a\u5e97\u94fa\u6d3b\u52a8";p=function(){t.set("isShopLive",true);n.fire("click");o.sendLog(s.ARR.LIVE_CHAT_BUBBLE_CLICK_TO_LIVE)}}f=function(){if(b){t._initDanmuAnim()}};o.log("::plugin-live::\u5f39\u51fa\u5e97\u94fa\u5f39\u5e55\u6c14\u6ce1");var h=4.2;var g=o.getSysId();if(g=="detail"){h=4.2}else{h=.7}r.bubble({show:true,content:T.render(e).replace("{danmuHtml}",b),customContentType:3,flag:h,height:v,bubbleType:0,isNotTabFire:true,tab:"LIVE",showTwo:true,showed:function(){o.sendLog(s.ARR.LIVE_SHOP_CHAT_BUBBLE_SHOW);m.set({k:e.storeKey,v:1,expires:1/48});if(u&&u==1){m.set({k:t.danmuAllKey,v:1,expires:t.danmuBubExpire})}else if(u&&u>1){m.set({k:t.danmuAllKey,v:u})}!!f&&f()},clicked:function(){!!p&&p();l.html("")},dismiss:function(){l.html("")}})},_openww:function(a){if(window.TribeLight&&a){if(TribeLight.isInstalledWW()){a&&TribeLight.openTribeWindow(a)}else{TribeLight.unInstall()}}},_initDanmuAnim:function(){var e=a.one(".mui-mbarp-live-danmu-box");var t=e.one("span");var i=e.one("p");var r=e.all("p");function n(a){a.animate({"margin-left":-a.outerWidth()-15},{duration:4,complete:function(){a.hide();a.css("margin-left",0);e.append(a);a.show();n(e.one("span"))}})}function s(a){var t=a.one("span");var i=0;!!t&&(i=t.outerWidth()||"");function n(a){setTimeout(function(){a.animate({"margin-top":-a.outerHeight()},{duration:.5,complete:function(){a.hide();a.css("margin-top",0);t.css("margin-left",0);e.append(a);a.show();s(e.one("p"))}})},2e3)}if(i>140){var o=3*((i-140)/140);t.animate({"margin-left":-t.outerWidth()+140},{duration:o,complete:function(){if(r.length>1){n(a)}}})}else{if(r.length>1){n(a)}}}s(i)},_showActbubble:function(e){var t=this;var i=t.get(s.K.MALLBAR_ITEM);var r=i.get(s.K.MALLBAR);o.ajax({url:s.URL.GET_PLUGIN_LIVE_TIP,timeout:4,jsonpCallback:"__mallbarGetActiveMessage",success:function(i){if(i.s!==1||!i.t||!i.id){o.log("\u8bf7\u6c42\u6c14\u6ce1\u65f6\u670d\u52a1\u5668\u8fd4\u56de\u6709\u95ee\u9898");o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.live.activeMessage.failure.bad-status-"+i.s,"\u83b7\u53d6\u76f4\u64ad\u95f4\u6d3b\u52a8\u4fe1\u606f\u72b6\u6001\u5f02\u5e38");return}var n=i.id+"";m.get({k:p,success:function(l){var u=false;var c=e.liveBubMax;if(typeof l!="object"){l={};m.set({k:p,v:l})}a.each(l,function(a,e){if(e===n&&a>=c){u=true;return false}});if(u){return}i.d11=e.isLiveD11;i.title=t.toStr(i.t,10);i.u=i.u?o.addSCM(i.u,s.SCM.LIVE_BUB_LINK):"";r.bubble({show:true,content:_.render(i),customContentType:3,bubbleType:0,flag:4.3,isNotTabFire:false,tab:"LIVE",hideDelay:e.liveBubDur?e.liveBubDur*1e3:s.BUBBLE_HIDE_DELAY,showed:function(e){l=l||{};l[n]=l[n]||0;l[n]+=1;m.set({k:p,v:l});a.each(e.all("a"),function(e){a.one(e).on("click",function(a){o.sendLog(s.ARR.LIVE_BUB_LINK_CLICK);l=l||{};l[n]=c||0;m.set({k:p,v:l});a.stopPropagation()})});o.sendLog(s.ARR.LIVE_SHOW)},clicked:function(){l=l||{};l[n]=c||0;m.set({k:p,v:l});o.sendLog(s.ARR.LIVE_CLICK)},dismiss:function(){},colsedClicked:function(){l=l||{};l[n]=c||0;m.set({k:p,v:l})}})}})},error:function(){o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.live.activeMessage.get.failure","\u83b7\u53d6\u76f4\u64ad\u95f4\u6d3b\u52a8\u4fe1\u606f\u5931\u8d25");o.log("\u8bf7\u6c42\u6c14\u6ce1\u65f6\u670d\u52a1\u5668\u8d85\u65f6\u6216\u9519\u8bef")}})},_showTabLive:function(){var a=this;var e=a.get(s.K.CONTAINER);e.one(".mui-mbarp-live-tab-content-live").html(d);a._getLiveData();e.one(".mui-mbarp-live-more").on("click",function(){a._getLiveData();o.sendLog(s.ARR.FOOT_MORE_CLICK)})},_showTabShop:function(){var e='<ul class="mui-mbarp-live-shop-items">'+"{{#each itemList}}"+'<li ><a href="{{itemUrl}}" target="_blank" class="mui-mbarp-live-shop-item"><img src="{{itemPic}}_100x100" alt="{{itemTitle}}" title="{{itemTitle}}">'+"</a></li>"+"{{/each}}"+"</ul>";var t=this;var i=t.get(s.K.CONTAINER);var n=t.get(s.K.MALLBAR_ITEM);var m=n.get(s.K.MALLBAR);var l=i.one(".mui-mbarp-live-tab-content-shop");var u=n.get(s.K.BUBBLE);o.ajax({url:s.URL.GET_PLUGIN_LIVE_SHOP_INFO,jsonpCallback:"_mallbarLiveShopInfo",dataType:"jsonp",data:{groupNum:t.chatId,act:0},timeout:5,success:function(n){if(n.s!=200){l.html('<div class="mui-mbar-plugin-err">\u554a\u54e6\uff0c\u597d\u50cf\u6709\u70b9\u95ee\u9898</div>');o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.live.shop.information.bad-status-"+n.s,"\u83b7\u53d6\u76f4\u64ad\u5e97\u94fa\u9891\u9053\u72b6\u6001\u5f02\u5e38");return}if(!n.d){l.html('<div class="mui-mbar-plugin-err">\u554a\u54e6\uff0c\u6728\u6709\u83b7\u53d6\u5230</div>');return}if(!n.d.isEdited){l.html('<div class="mui-mbar-plugin-err">\u554a\u54e6\uff0c\u5e97\u5bb6\u6728\u6709\u6d3b\u52a8\u54e6</div>');return}var m="";var u=t.get("groupNumOk");if(a.UA.os=="windows"&&u){m+='<div class="mui-mbarp-live-shop-tip"><a href="javascript:void(0);" data-tribeid="'+t.chatId+'">\u52a0\u5165\u5e97\u94fa\u804a\u5929\u5ba4\u5427<span class="mui-mbar-iconfont">&#xe601;</span></a></div>'}var c=n.d.adWords||"";var b="";if(c){c=c.split("|");a.each(c,function(a){var e=a.split(",");var t=e[0],i=e[1];if(t){if(i){i=o.addSCM(i,"1048.1.5.4");b+='<a class="mui-mbarp-live-shop-act-words   mui-mbarp-live-shop-act-words-underline" href="'+i+'" target="_blank">'+t+"</a>"}else{b+='<p class="mui-mbarp-live-shop-act-words " >'+t+"</p>"}}})}var d=n.d.banner||"";var p="";if(d){d=d.split("|");!!d&&d[0]&&(p+='<a class="mui-mbarp-live-shop-act-img" target="_blank" href="'+o.addSCM(d[1],"1048.1.5.5")+'"><img src="'+d[0]+'"></a>')}if(n.d.itemList){a.each(n.d.itemList,function(a){!!a&&(a.itemUrl=o.addSCM(a.itemUrl,"1048.1.5.6"))})}var f=new r(e).render(n.d);m+=b+p+f;l.html(m);if(i.one(".mui-mbarp-live-shop-tip")){i.one(".mui-mbarp-live-shop-tip").on("click",function(){o.sendLog(s.ARR.LIVE_EXPEND_TO_WW);var a=i.one(".mui-mbarp-live-shop-tip").one("a").attr("data-tribeid");t._openww(a)})}},error:function(){l.html('<div class="mui-mbar-plugin-err">\u554a\u54e6\uff0c\u597d\u50cf\u6709\u70b9\u95ee\u9898</div>');o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.live.shop.information.get.failure","\u83b7\u53d6\u76f4\u64ad\u5e97\u94fa\u9891\u9053\u5931\u8d25")}})},_getLiveData:function(){var e=this;var t=e.get(s.K.CONTAINER);var i=t.one(".mui-mbarp-live-msgs");var r=t.one(".mui-mbarp-live-more");var n=t.one(".mui-mbarp-live-more-nomsg");var m=t.one(".mui-mbarp-live-load");var l=e.get(s.K.MALLBAR_ITEM);r.hide();m.show();o.ajax({url:s.URL.GET_PLUGIN_LIVE,data:{pageSize:10,lastId:f},timeout:4,jsonpCallback:"__mallbarReadRadiateMsg",success:function(t){m.hide();r.show();o.log("lastId",f);if(t.errorCode=="E01"){e.noMsg();return}if(t.errorCode!="E00"&&!f){e.noMsg();return}if(!t.msgs||!t.msgs.length){!f&&e.noMsg();if(f){r.hide();n.show()}return}o.getStaticConf({cb:function(r){f=t.msgs[t.msgs.length-1].id;a.each(t.msgs,function(a,t){a.d11=r.isLiveD11;var i=o.parseDate(a.date);a.date=o.fm("{0}\u6708{1}\u65e5\u7ed3\u675f",i.getMonth()+1,i.getDate());a.t=a.title;a.title=e.toStr(a.t,10);a.link="";a.src="";a.desc="";if(a.extras.pics.length>0){var n=a.extras.pics[0];a.link=n.link?o.addSCM(n.link,s.SCM.LIVE):"";a.src=n.src;a.desc=n.desc||n.t}});i.append(v.render(t));e.fixArrow(i)}})},error:function(){o.log("\u76f4\u64ad\u95f4\u6570\u636e\u8bf7\u6c42\u8d85\u65f6\u6216\u9519\u8bef");m.hide();r.show();if(!f){e.noMsg()}}})},noMsg:function(){var e=a.one(".mui-mbarp-live-tab-content-live");e.html('<h2 class="mui-mbarp-live-nomsg">\u55b5\uff01\u60a8\u6ca1\u6709\u65b0\u6d88\u606f\u54e6\uff01</h2>')},fixArrow:function(a){if(!a){return}},toStr:function(a,e){e=e||Number.MAX_VALUE;if(!a){return""}a=a.replace(/<a[^>]*?>([\w\W]+)<\/a>/gi,"");if(a.length<=e){return a}return a.substr(0,e)},dateToTips:function(a){if(!a){return"\u5df2\u7ed3\u675f"}var e=this;var t=e.get(s.K.MALLBAR_ITEM);var i=t.getServerTime();!!i&&(i=new Date(i)*1);var r=new Date(a)*1;var n="";if(i>r){return"\u5df2\u7ed3\u675f"}n=parseInt((r-i)/1e3/60/60/24)+1;return n+"\u5929\u540e\u7ed3\u675f"}});return u},{requires:["base","node","event","xtemplate","ua","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","cookie","json","mui/mallbar/plugin-live.css"]});KISSY.add("mui/mallbar/plugin/foot",function(a,e,t,i,r,n,o,s,m,l){var u=function(a){var e=this;u.superclass.constructor.call(e,a);e.init()};var c="\u55b5\uff01\u770b\u8fc7\u7684\u60a8\u53ef\u80fd\u9519\u8fc7\u4e86\uff01\u8fd9\u91cc\u5e2e\u60a8\u8bb0\u5f55\u60a8\u67e5\u770b\u8fc7\u7684\u5b9d\u8d1d\u3002\u8fd9\u6b21\u522b\u518d\u9519\u8fc7\u4e86\u54e6\uff01";a.extend(u,e,{init:function(){var e=this;var t=o.ie==6||o.ie==7;var n=e.get(s.K.CONTAINER);var u=e.get(s.K.MALLBAR_ITEM);var b=u.getUserInfo();var d=s.IS_DAILY?/http:\/\/.*\.daily\.tmall\.net.*itemId=.*/:/http:\/\/detail\.tmall\.com.*(\?|\&)id=.*/;var p=10;var f=30;var v=0;var h=false;var g;var _=[];var T=false;var A=false;var C=false;var I=false;var E=7;var B=7;var L=20;var R=18;var S=96;var O=120;var N=105;var w=120;var M=["\u4eca\u5929","1\u5929\u524d","2\u5929\u524d","1\u5468\u524d"];var b=u.getUserInfo();var y=b.isLogin;var U=false;var k;var D=a.one(' <div id="J_mui-mbar-foot-dclear" class="mui-mbar-foot-dialog"> <p class="mui-mbar-foot-dtitle">\u55b5~\u786e\u5b9a\u8981\u6e05\u7a7a\u6211\u770b\u8fc7\u7684\uff1f</p> <p class="mui-mbar-foot-dhint">\u6ce8\uff1a\u60a8\u9489\u4f4f\u7684\u5546\u54c1\u4e0d\u4f1a\u88ab\u6e05\u7a7a</p> <div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-dco" href="#">\u786e\u5b9a</a> <a class="mui-mbar-foot-dcc" href="#">\u53d6\u6d88</a> </div> </div> ');var P=a.one(' <div id="J_mui-mbar-foot-dos" class="mui-mbar-foot-dialog"> <p class="mui-mbar-foot-dtitle">\u55b5\uff0c\u60a8\u5df2\u7ecf\u9489\u6ee1\u4e86~~</p> <p class="mui-mbar-foot-dhint">\u6ce8\uff1a\u60a8\u6700\u591a\u53ef\u4ee5\u9489100\u4ef6\u5546\u54c1</p> <div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-doc" href="#">\u6211\u77e5\u9053\u4e86</a> </div> </div> ');var x=a.one(' <div id="J_mui-mbar-foot-dpf" class="mui-mbar-foot-dialog"> <p class="mui-mbar-foot-dtitle">\u55b5\uff0c\u6ca1\u9489\u4e0a~~</p> <p class="mui-mbar-foot-dhint">\u6ce8\uff1a\u8bf7\u7a0d\u540e\u518d\u8bd5\u54e6\uff1a\uff09</p> <div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-dpc" href="#">\u6211\u77e5\u9053\u4e86</a> </div> </div> ');var K=a.one(' <div id="J_mui-mbar-foot-dupf" class="mui-mbar-foot-dialog"> <p class="mui-mbar-foot-dtitle">\u55b5\uff0c\u5220\u9664\u5931\u8d25\u4e86~~</p> <p class="mui-mbar-foot-dhint">\u6ce8\uff1a\u8bf7\u7a0d\u540e\u518d\u8bd5\u54e6\uff1a\uff09</p> <div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-dupc" href="#">\u6211\u77e5\u9053\u4e86</a> </div> </div> ');var G=a.one(' <div id="J_mui-mbar-foot-dpt" class="mui-mbar-foot-dialog mui-mbar-foot-dptd"> <s class="outer-tri"></s>  <s class="shinning-pin"></s> <p class="mui-mbar-foot-dpthint">\u55b5~~\u60a8\u53ef\u4ee5\u5bf9\u91cd\u70b9\u5173\u6ce8\u7684\u5546\u54c1\u4f7f\u7528\u9489\u4f4f\uff0c\u7cfb\u7edf\u4f1a\u4e00\u76f4\u4fdd\u7559\u4f4f\u8be5\u5546\u54c1\u7684\u770b\u8fc7\u8bb0\u5f55\uff01\u9489\u4f4f\u7684\u5546\u54c1\u4e5f\u4f1a\u540c\u65f6\u52a0\u5165\u60a8\u7684\u6536\u85cf\u5939\u54e6\uff1a\uff09</p><div class="mui-mbar-foot-dbtns"> <a class="mui-mbar-foot-dptc" href="#">\u6211\u77e5\u9053\u4e86</a> </div> </div> ');F();H();e.on(s.E.VISIBILITY_CHANGE,function(e){if(e.visible){A=true;setTimeout(function(){A=false},100);j()}if(e.first){var t=u.get(s.K.MALLBAR);n.delegate("click",".mui-mbarp-foot-favor-cancel",function(e){var i=a.one(e.currentTarget).parent(".mui-mbar-foot-hsitem");var r=i.attr("data-itemId");t._addFavor(r,e);m.sendLog(s.ARR.FOOT_ADD_FAVOR);e.halt()})}});e.on(s.E.DATA_CHANGE,function(a){m.log("Plugin",a.type);var e=u.get(s.K.EXPAND);if(e){j()}});e.on(s.E.PAGE_VISIBILITY_CHANGE,function(a){if(I){return}var e=u.get(s.K.EXPAND);if(e&&a.pageVisible&&!A){j()}});u.on(s.E.LOGIN_SUCCESS,function(){C=true});function F(){r.delegate(n,"click",".j_mui-mbar-foot-pfbtn",J)}function H(){l.get({k:"mui/mallbar/foot/historynum",success:function(a){var e;var t=window.location.href;e=a?a:[];var i=e.length;if(i>=f){return}var r;if(window.g_config&&window.g_config.itemId){r=window.g_config.itemId}if(r){var n=false;for(var o=0;o<e.length;o++){if(r==e[o]){n=true;break}}if(n){return}e.push(r);i++;if(i==p||i==f){m.log("GTE firstBubbleTipCount and Bubble it");u.fire(s.E.BUBBLE_CHANGE,{show:true,customContentType:1,bubbleType:0,isNotTabFire:false,html:"\u55b5\uff0c\u60a8\u770b\u8fc7\u7684\u5546\u54c1\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u54e6\uff1a\uff09",showed:function(){m.sendLog(s.ARR.FOOT_BUBBLE)},clicked:function(){m.sendLog(s.ARR.FOOT_BUBBLE_CLICK)}})}l.set({k:"mui/mallbar/foot/historynum",v:e,success:function(){}})}}})}function j(){n.html('<div id="J_MuiMbarHistoryBd" class="mui-mbar-foot-hisbd"><div class="mui-mbar-foot-hmask"></div></div><div id="J_MuiMbarPinBd" class="mui-mbar-foot-pinbd j_mui-mbar-foot-pinbd"></div>');a.one("#J_MuiMbarHistoryBd").parent(".mui-mbar-plugin-bd").css({overflow:"hidden",width:"235px"});m.noScroll(a.one("#J_MuiMbarHistoryBd"));m.log("Foot Visible");l.get({k:"mui/mallbar/foot/blacklist",success:function(a){if(a){_=a}V()}})}function X(){var e=a.one("#J_MuiMbarHistoryBd");var t=e.parent(".mui-mbar-plugin-bd").height();var i=a.one("#J_MuiMbarPinBd").height();e.height(t-i)}function V(){v=0;b=u.getUserInfo();m.log("updateContent",+new Date);new i({url:s.URL.GET_PLUGIN_FOOT_ITEMS,dataType:"jsonp",scriptCharset:"gbk",jsonpCallback:"__mallbarFootGetHistory",data:{type:1,t:+new Date},timeout:5,success:Q,error:function(){m.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.foot.footGetHistory.get.failure","\u83b7\u53d6\u6211\u7684\u8db3\u8ff9\u5386\u53f2\u5931\u8d25");u.fire(s.E.ERROR)}});new i({dataType:"jsonp",scriptCharset:"gbk",url:s.URL.GET_PLUGIN_FOOT_ITEMS2,jsonpCallback:"__mallbarFootGetPins",data:{type:2,t:+new Date},timeout:5,success:z,error:function(){m.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.foot.footGetPins.get.failure","\u83b7\u53d6\u6211\u7684\u8db3\u8ff9Pins\u5931\u8d25");u.fire(s.E.ERROR)}})}function Y(){var e='<a class="mui-mbar-foot-punfold j_mui-mbar-foot-pfbtn" href="#"></a>'+'<div class="mui-mbar-foot-pins j_mui-mbar-foot-pins">'+'<div class="mui-mbar-foot-plogin">'+'  <div class="mui-mbar-foot-phead" style="display:none">'+'    <div class="mui-mbar-foot-pstat">'+'      <p>\u6211\u9489\u4f4f\u7684 <span class="mui-mbar-foot-pstatn">0</span> \u4ef6</p>'+"      <s></s>"+"    </div>"+'    <div class="mui-mbar-foot-phint">'+'      <s class="outer-tri"></s>'+'      <a class="hint-close"  href="#"></a>'+"      <p>\u5feb\u6ee1\u4e86\uff0c\u60a8\u6700\u591a\u53ef\u4ee5\u9489100\u4ef6\u5546\u54c1\uff01</p>"+"    </div>"+"  </div>"+'  <div class="mui-mbar-foot-plhint">'+"  </div>"+'  <a href="#" class="mui-mbar-foot-plbtn">\u70b9\u51fb\u767b\u5f55</a>'+"</div>"+"</div>";a.one("#J_MuiMbarPinBd").html(e);var i=a.one(".mui-mbar-foot-hsitem");if(!(i&&i.length>0)){if(!t){a.one("#J_MuiMbarPinBd").css({height:0});T=true}}a.one(".mui-mbar-foot-plbtn").on("click",function(a){a.preventDefault();return u.fire(s.E.LOGIN,{success:function(){j()}})})}function W(){l.get({k:"mui/mallbar/foot/first",success:function(a){if(a){return}else{$(4)}}})}function z(e){m.log("::foot refreshPins::",e,+new Date);if(e.s&&e.s==-2){y=false;Y();X();return}y=true;var i=e["l"];var r=e["c"]?e["c"]:0;var n='<a class="mui-mbar-foot-punfold j_mui-mbar-foot-pfbtn" href="#"></a>'+'<div class="mui-mbar-foot-pins j_mui-mbar-foot-pins">'+'  <div class="mui-mbar-foot-phead">'+'    <div class="mui-mbar-foot-pstat">'+'      <p>\u6211\u9489\u4f4f\u7684 <span class="mui-mbar-foot-pstatn">'+r+"</span> \u4ef6</p>"+"      <s></s>"+"    </div>"+'    <div class="mui-mbar-foot-phint">'+'      <s class="outer-tri"></s>'+'      <a class="hint-close"  href="#"></a>'+"      <p>\u5feb\u6ee1\u4e86\uff0c\u60a8\u6700\u591a\u53ef\u4ee5\u9489100\u4ef6\u5546\u54c1\uff01</p>"+"    </div>"+"  </div>";if(i&&i.length>0){T=false;var o=i.length;var s=Math.ceil(o/2)*w;s=t?116:s;var l='<div class="mui-mbar-foot-pslist j_mui-mbar-foot-pslist" style="height:'+s+'px;">';for(var u=0;u<i.length;u++){var c=i[u];var b=Math.floor(u/2);var d=u%2;var p=d==0?100:99;var f=R+b*w;var v=L+d*N;var h=c.url.split("?");var g=h[0];var _=h[1];var A="";if(!_){A=g+"?acm=03200.1003.1.1&scm=1048.1.6.3"}else{var C=a.unparam(_);C.acm="03200.1003.1.1";C.scm="1048.1.6.3";var I=a.param(C);A=g+"?"+I}l+='<div class="mui-mbar-foot-psitem j_mui-mbar-foot-psitem" style="top:'+f+"px;left:"+v+"px;z-index:"+p+';" data-itemid="'+c.itemId+'">'+'  <a class="mui-mbar-foot-psilink" target="_blank" href="'+A+'"><img src="'+c.img+'_90x90.jpg" alt="'+c.desc+'" width="90" height="90" /></a>'+'  <a target="_blank" href="'+A+'" class="mui-mbar-foot-pprice">\uffe5'+c.price+"</a>"+'  <s class="mui-mbar-foot-ppin j_mui-mbar-foot-ppin" title="\u5220\u9664"></s>'+'  <div class="mui-mbar-foot-pdesc">'+'    <a href="'+A+'" target="_blank">'+c.desc+"</a>"+"  </div>"+"</div>"}l+="</div>";pinHintHtml='<div class="mui-mbar-foot-pinhint"></div>';n+=l+pinHintHtml+"</div>";a.one("#J_MuiMbarPinBd").append(n);a.all(".j_mui-mbar-foot-ppin").on("click",q)}else{W();var l='<div class="mui-mbar-foot-pslist j_mui-mbar-foot-pslist"></div>';pinHintHtml='<div class="mui-mbar-foot-pinohint"></div>';n+=l+pinHintHtml+"</div>";a.one("#J_MuiMbarPinBd").append(n);if(!t){a.one("#J_MuiMbarPinBd").css({height:0});T=true}a.one(".mui-mbar-foot-pstatn").html("0");a.one(".mui-mbar-foot-pslist").css({height:0})}X();m.noScroll(a.one(".mui-mbar-foot-pins"))}function J(e){e.preventDefault();if(C){I=true;C=false}else{I=false}m.log("Unfold Pins");m.log(e);var i=a.one(e.target);var r=a.one(e.target).parent(".mui-mbar-plugin-bd").height();var n=a.one(".mui-mbar-foot-pins").height();var o=a.one(".mui-mbar-foot-phead").height();var s=a.one("#J_MuiMbarHistoryBd");if(i.hasClass("mui-mbar-foot-pfold")){var l=n>156?156:n;var u=T?r:r-o-19-l;s.height(u);i.removeClass("mui-mbar-foot-pfold");i.addClass("mui-mbar-foot-punfold");if(T){a.one("#J_MuiMbarPinBd").animate({height:0},.3,"easeOut",function(){X()})}else{a.one("#J_MuiMbarPinBd").removeAttr("style");a.one(".mui-mbar-foot-pins").animate({height:l},.3,"easeOut",function(){X()});s.one(".mui-mbar-foot-hmask").css({height:0,display:"none"});a.one(".mui-mbar-foot-hisbd").css({overflow:"auto"})}if(t){var c=a.one(".mui-mbar-foot-pslist");c.css({height:116})}}else{i.removeClass("mui-mbar-foot-punfold");i.addClass("mui-mbar-foot-pfold");var b=r-134;if(T){a.one("#J_MuiMbarPinBd").animate({height:156},.3,"easeOut",function(){X()})}else{a.one("#J_MuiMbarPinBd").removeAttr("style");a.one(".mui-mbar-foot-pins").animate({height:b},.3,"easeOut",function(){X()});if(t){var c=a.one(".mui-mbar-foot-pslist");var d=c.all(".mui-mbar-foot-psitem").length;var p=Math.ceil(d/2);var f=p*w;var v=b-94;f=f<v?f:v;c.css({height:f})}s.one(".mui-mbar-foot-hmask").css({height:2e4,display:"block"});a.one(".mui-mbar-foot-hisbd").css({overflow:"hidden"})}}}function q(e){m.sendLog(s.ARR.FOOT_UNPIN_ITEM);e.preventDefault();var n=e.target;r.detach(e.target,"click");var o=a.one(e.target).parent(".j_mui-mbar-foot-psitem");var l=o.attr("data-itemid");new i({dataType:"jsonp",scriptCharset:"gbk",jsonpCallback:"__mallbarFootUnpinItem",url:s.URL.GET_PLUGIN_FOOT_PINITEM,data:{_tb_token_:g,pin:0,itemId:l,t:+new Date},timeout:5,success:function(e){g=e.t;if(e.s==-2){return u.fire(s.E.LOGIN)}if(e.s==-1){a.one(n).on("click",q);$(3);return}m.log("Unpin Successful");var i=a.one(o.parent(".mui-mbar-foot-pslist"));var r=o.parent(".mui-mbar-foot-pslist").all(".mui-mbar-foot-psitem");var l=r.length;var c=0;while(c<r.length){if(o[0]==r[c])break;c++}var b=parseInt(o.css("left"));var d=parseInt(o.css("top"));for(var p=c+1;p<r.length;p++){var f=a.one(r[p]);var v=parseInt(f.css("left"));var h=parseInt(f.css("top"));if(t){f.css({left:b,top:d})}else{f.animate({left:b,top:d},.5,"easeOut",function(){var a=f;var e=a.css("z-index");e=e==100?99:100;a.css({"z-index":e})})}b=v;d=h}var _=l-1;var T=Math.ceil(_/2);var A=T*w;if(!t){i.animate({height:A},.5,"easeOut")}var C=a.one(".mui-mbar-foot-pstatn");if(C&&C.length>0){var I=parseInt(C.html());var E=I-1;C.html(E)}if(t){o.remove()}else{o.fadeOut(.3,function(){o.remove()})}},error:function(){a.one(n).on("click",q);$(3)}})}function Q(e){m.log("::foot refreshHistory::",+new Date);g=e.t;m.log(e);if(e.s==-2){return u.fire(s.E.LOGIN)}var i=e["c"];var n=e["l"];if(n&&n.length>0){var o='  <div class="mui-mbar-foot-hhead">'+'    <p class="mui-mbar-foot-hstat j_mui-mbar-foot-hstat" href="#"><span class="mui-mbar-foot-hstatn">{{HITEMCOUNT}}</span>\u4ef6\u5546\u54c1</p>'+'    <a class="j_mui-mbar-foot-hclear mui-mbar-foot-hclear" href="#">\u6e05\u7a7a</a>'+"  </div>"+'<div class="mui-mbar-foot-history j_mui-mbar-foot-history">';for(var l=0;l<n.length;l++){category=n[l];o+=re(category)}o+="</div>";o=o.replace("{{HITEMCOUNT}}",v);if(v==0){a.one("#J_MuiMbarHistoryBd").prepend(m.fm('<div class="mui-mbar-foot-nohis"></div><p class="mui-mbar-foot-nohhint">{0}</p><div class="mui-mbar-foot-hmask"></div>',c));return}else{a.one("#J_MuiMbarHistoryBd").prepend(o)}a.all(".j_mui-mbar-foot-hpin").on("click",ae);a.all(".j_mui-mbar-foot-hclose").on("click",function(e){m.sendLog(s.ARR.FOOT_DELETE_ITEM);e.preventDefault();r.detach(e.target,"click");var t=a.one(e.target).parent(".j_mui-mbar-foot-hsitem");var i=t.attr("data-itemid");te(i);ie(e)});a.one(".j_mui-mbar-foot-hclear").on("click",function(a){a.preventDefault();$(0)});if(t){a.all(".mui-mbar-foot-hsitem").on("mouseover",function(e){var t=a.one(this);t.one(".mui-mbar-foot-hsibg").show();t.one(".mui-mbar-foot-hpin").show();t.one(".mui-mbar-foot-hclose").show()});a.all(".mui-mbar-foot-hsitem").on("mouseout",function(e){var t=a.one(this);t.one(".mui-mbar-foot-hsibg").hide();t.one(".mui-mbar-foot-hpin").hide();t.one(".mui-mbar-foot-hclose").hide()})}m.noScroll(a.one(".mui-mbar-foot-hisbd"))}else{a.one("#J_MuiMbarHistoryBd").prepend(m.fm('<div class="mui-mbar-foot-nohis"></div><p class="mui-mbar-foot-nohhint">{0}</p><div class="mui-mbar-foot-hmask"></div>',c))}}function Z(){m.sendLog(s.ARR.FOOT_CLEAR_HISTORY);m.log("Clear All Items");var e=[];var t=a.all(".mui-mbar-foot-hsitem");for(var i=0;i<t.length;i++){e.push(a.one(t[i]).attr("data-itemid"))}te(e);var r=a.one("#J_MuiMbarHistoryBd").children();r.fadeOut(1,function(){r.remove();a.one("#J_MuiMbarHistoryBd").prepend(m.fm('<div class="mui-mbar-foot-nohis" style="display:none;"> </div><p class="mui-mbar-foot-nohhint" style="display:none">{0}</p><div class="mui-mbar-foot-hmask"></div>',c));a.one(".mui-mbar-foot-nohis").fadeIn(.5);a.one(".mui-mbar-foot-nohhint").fadeIn(.5)})}function $(e){if(e===undefined)return;if(e==0){var t=a.one(".mui-mbar-plugin-foot");var i=t.one("#J_mui-mbar-foot-dclear");if(i&&i.length>0){i.show();return}t.append(D);var i=t.one("#J_mui-mbar-foot-dclear");i.show();i.one(".mui-mbar-foot-dco").on("click",function(e){e.preventDefault();Z();u=a.one(".mui-mbar-foot-mask");u&&u.hide();i.hide()});i.one(".mui-mbar-foot-dcc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();i.hide()})}else if(e==1){var t=a.one(".mui-mbar-plugin-foot");var r=t.one("#J_mui-mbar-foot-dos");if(r&&r.length>0){r.show();return}t.append(P);var r=t.one("#J_mui-mbar-foot-dos");r.show();r.one(".mui-mbar-foot-doc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();r.hide()})}else if(e==2){var t=a.one(".mui-mbar-plugin-foot");var n=t.one("#J_mui-mbar-foot-dpf");if(n&&n.length>0){n.show();return}t.append(x);var n=t.one("#J_mui-mbar-foot-dpf");n.show();n.one(".mui-mbar-foot-dpc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();n.hide()})}else if(e==3){var t=a.one(".mui-mbar-plugin-foot");var o=t.one("#J_mui-mbar-foot-dupf");if(o&&o.length>0){o.show();return}t.append(K);var o=t.one("#J_mui-mbar-foot-dupf");o.show();o.one(".mui-mbar-foot-dupc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();o.hide()})}else if(e==4){var s=a.one(".mui-mbar-foot-hsitem");if(s&&s.length>0){var t=a.one(".mui-mbar-plugin-foot");var m=t.one("#J_mui-mbar-foot-dpt");if(m&&m.length>0){m.show();return}t.append(G);var m=t.one("#J_mui-mbar-foot-dpt");m.show();s.one(".mui-mbar-foot-hsibg").show();s.one(".mui-mbar-foot-hpin").show();s.one(".mui-mbar-foot-hclose").show();m.one(".mui-mbar-foot-dptc").on("click",function(e){e.preventDefault();u=a.one(".mui-mbar-foot-mask");u&&u.hide();m.hide();s.one(".mui-mbar-foot-hsibg").attr("style","");s.one(".mui-mbar-foot-hpin").attr("style","");s.one(".mui-mbar-foot-hclose").attr("style","");l.set({k:"mui/mallbar/foot/first",v:1,success:function(){}})})}else{return}}var t=a.one(".mui-mbar-plugin-foot");var u=t.one(".mui-mbar-foot-mask");if(!u||u.length<=0){t.append('<div class="mui-mbar-foot-mask"></div>');var u=t.one(".mui-mbar-foot-mask")}u.css({height:t.height()});u.show()}function ae(e){m.sendLog(s.ARR.FOOT_PIN_ITEM);e.preventDefault();if(h)return;var t=e.target;r.detach(e.target,"click");m.log("Pin Item");m.log(e.target);var n=a.one(e.target).parent(".mui-mbar-foot-hsitem");var o=n.attr("data-itemid");new i({url:s.URL.GET_PLUGIN_FOOT_PINITEM,scriptCharset:"gbk",jsonpCallback:"__mallbarFootPinItem",data:{_tb_token_:g,pin:1,itemId:o,t:+new Date},dataType:"jsonp",timeout:5,success:function(i){g=i.t;if(i.s==-2){return u.fire(s.E.LOGIN)}if(i.s==-1){a.one(t).on("click",ae);m.log("Pin Fail");$(2);return}if(!y){j();return}h=true;var r=a.one("#J_MuiMbarPinBd");r.show();m.log("Pin Successful");var l=n.offset();var c=a.one(".mui-mbar-foot-pslist");var b=c.offset();var d=l.top-a.one(window).scrollTop();var p=l.left-a.one(".mui-mbar").offset().left-a.one(window).scrollLeft()-35;var f=99999999999999;var v=n.one("img").attr("src");var _=n.one(".mui-mbar-foot-hdtxt").html();var A=n.children(".mui-mbar-foot-hprice").html();var C=n.one(".mui-mbar-foot-hprice").attr("href");var I=C.split("?");var E=I[0];var B=I[1];var S="";if(!B){S=E+"?acm=03200.1003.1.1&scm=1048.1.6.3"}else{var O=a.unparam(B);O.acm="03200.1003.1.1";O.scm="1048.1.6.3";var N=a.param(O);S=E+"?"+N}var w='<div class="mui-mbar-foot-psia mui-mbar-foot-psitem j_mui-mbar-foot-psitem" style="top:'+d+"px;left:"+p+"px;z-index:"+f+';" data-itemid="'+o+'">'+'  <a class="mui-mbar-foot-psilink" target="_blank" href="'+S+'"><img src="'+v+'" alt="'+_+'" width="90" height="90" /></a>'+'  <a target="_blank" href="'+S+'" class="mui-mbar-foot-pprice" style="display:none;">'+A+"</a>"+'  <s class="mui-mbar-foot-ppin j_mui-mbar-foot-ppin" title="\u5220\u9664" style="display:none;"></s>'+'  <div class="mui-mbar-foot-pdesc">'+'    <a target="_blank" href="'+S+'">'+_+"</a>"+"  </div>"+"</div>";if(T){if(a.one("#J_MuiMbarPinBd").height()==0){a.one("#J_MuiMbarPinBd").animate({height:156},.3,"easeOut",function(){X()});b.top-=156}else{var M=a.one(".j_mui-mbar-foot-pfbtn");M.removeClass("mui-mbar-foot-pfold");M.addClass("mui-mbar-foot-punfold")}}T=false;a.one(".mui-mbar-plugin-foot").prepend(w);var U=a.one(".mui-mbar-foot-psia");U.one(".j_mui-mbar-foot-ppin").on("click",q);m.log("aniItem width:"+U.width()+" height: "+U.height());U.animate({left:p+20,top:d-20},.5,"easeIn",function(){U.animate({left:b.left-a.one(".mui-mbar").offset().left+L-a.one(window).scrollLeft()-35,top:b.top+R-a.one(window).scrollTop()},1,"easeIn",function(){c.prepend(U);U.one(".mui-mbar-foot-ppin").fadeIn(.5);U.one(".mui-mbar-foot-pprice").fadeIn(.5);h=false;U.removeClass("mui-mbar-foot-psia");U.css({left:L,top:R,"z-index":100})})});ee();n.fadeOut(1.5);setTimeout(function(){ie(e)},1500);var k=a.one(".mui-mbar-foot-pstatn");if(k&&k.length>0){var D=parseInt(k.html());var P=D+1;k.html(P)}var x=a.one(".mui-mbar-foot-pinhint");if(x){x.removeClass(".mui-mbar-foot-pinhint");x.addClass(".mui-mbar-foot-pinohint")}},error:function(){a.one(t).on("click",ae);m.log("Pin Fail");$(2)}})}function ee(){var e=a.one(".mui-mbar-foot-pslist");var i=e.all(".mui-mbar-foot-psitem");var r=i.length;var n=Math.floor(r/2);var o=r%2;var s=w*(n+1);if(!t){e.height(s)}if(i&&i.length>0){var m=L+o*N;var l=R+n*w;for(var u=r-1;u>=0;u--){var c=a.one(i[u]);c.animate({left:m,top:l},.5,"easeOut",function(){var a=c;var e=a.css("z-index");e=e==100?99:100;a.css({"z-index":e})});m=parseInt(c.css("left"));l=parseInt(c.css("top"))}}else{var s=w*(n+1)}}function te(a){l.get({k:"mui/mallbar/foot/blacklist",success:function(e){if(!e){var t;if(typeof a=="object"&&a instanceof Array){t=a}else{t=[a]}l.set({k:"mui/mallbar/foot/blacklist",v:t,success:function(a){m.log("New mbar_plugin_foot_storage")}})}else{var t;if(typeof a=="object"&&a instanceof Array){t=e.concat(a)}else{e.push(a);t=e}l.set({k:"mui/mallbar/foot/blacklist",v:t,success:function(a){m.log("Update foot/blacklist")}})}}})}function ie(e){m.log("Delete Item");m.log(e.target);var i=a.one(e.target).parent(".mui-mbar-foot-hsitem");var r=i.attr("data-itemid");var n=a.one(i.parent(".mui-mbar-foot-hslist"));var o=i.parent(".mui-mbar-foot-hslist").children(".mui-mbar-foot-hsitem");var s=o.length;var l=0;while(l<s){if(i[0]==o[l])break;l++}var u=parseInt(i.css("left"));var c=parseInt(i.css("top"));for(var b=l+1;b<o.length;b++){var d=a.one(o[b]);var p=parseInt(d.css("left"));var f=parseInt(d.css("top"));if(t){d.css({left:u,top:c})}else{d.animate({left:u,top:c},.5,"easeOut",function(){var a=d;var e=a.css("z-index");e=e==100?99:100;a.css({"z-index":e})})}u=p;c=f}var v=a.one(".mui-mbar-foot-hstatn");if(v&&v.length>0){var h=parseInt(v.html());var g=h-1;v.html(g)}if(s==1){var _=i.parent(".mui-mbar-foot-hsection");var T=_;var A=a.all(".mui-mbar-foot-hsection");if(A&&A.length==1){var C=a.one("#J_MuiMbarHistoryBd").children();T=C}T&&T.fadeOut(1,function(){T.remove();var e=a.all(".mui-mbar-foot-hsection");if(e&&e.length>0)return;var t=a.one("#J_MuiMbarHistoryBd").prepend('<div class="mui-mbar-foot-nohis" style="display:none;"></div><p class="mui-mbar-foot-nohhint" style="display:none">\u55b5\uff01\u770b\u8fc7\u7684\u60a8\u53ef\u80fd\u9519\u8fc7\u4e86\uff01\u8fd9\u91cc\u5e2e\u60a8\u8bb0\u5f55\u60a8\u67e5\u770b\u8fc7\u7684\u5b9d\u8d1d\u3002\u8fd9\u6b21\u522b\u518d\u9519\u8fc7\u4e86\u54e6\uff01</p><div class="mui-mbar-foot-hmask"></div>');a.one(".mui-mbar-foot-nohis").fadeIn(.5);a.one(".mui-mbar-foot-nohhint").fadeIn(.5)});return}var I=s-1;var E=Math.ceil(I/2);var B=E*O;if(t){n.height(B)}else{n.animate({height:B},.5,"easeOut")}if(t){i.remove()}else{i.fadeOut(.3,function(){i.remove()})}}function re(e){var t=M[e.n];var i=e.d;var r=i.length;var n='<div class="mui-mbar-foot-hsection">'+'  <div class="mui-mbar-foot-hstitle">'+"    <p>"+t+"</p>"+"    <s></s>"+"  </div>"+'<div class="mui-mbar-foot-hslist j_mui-mbar-foot-hslist" style="height:{{LISTHEIGHT}}px;">';var o=0;for(var s=0;s<r;s++){var m=i[s];var l=false;for(var u=0;u<_.length;u++){if(""+m.itemId==_[u]){l=true;break}}if(l){continue}var c=Math.floor(o/2);var b=o%2;var d=b==0?100:99;var p=B+c*O;var f=E+b*S;var h=m.url.split("?");var g=h[0];var T=h[1];var A="";if(!T){A=g+"?acm=03200.1003.1.1&scm=1003.3.03200.0"}else{var C=a.unparam(T);C.acm="03200.1003.1.1";C.scm="1003.3.03200.0";var I=a.param(C);A=g+"?"+I}n+='<div class="mui-mbar-foot-hsitem j_mui-mbar-foot-hsitem" style="top:'+p+"px;left:"+f+"px;z-index:"+d+';" data-itemid="'+m.itemId+'">'+'<div class="mui-mbar-foot-hsibg"></div>'+'  <a class="mui-mbar-foot-hsilink" href="'+A+'" target="_blank"><img src="'+m.img+'_90x90.jpg" alt="'+m.desc+'" width="90" height="90"/></a>'+'  <a href="'+A+'" target="_blank" class="mui-mbar-foot-hprice">\uffe5'+m.price+"</a>"+'  <s class="mui-mbar-foot-hpin mui-mbarp-foot-favor-cancel" title="\u52a0\u5165\u6536\u85cf"></s>'+'  <s class="mui-mbar-foot-hclose j_mui-mbar-foot-hclose" title="\u5220\u9664\u8bb0\u5f55"></s>'+'  <div class="mui-mbar-foot-hdesc">'+'    <a href="'+A+'" target="_blank" class="mui-mbar-foot-hdtxt">'+m.desc+"</a>"+"  </div>"+"</div>";v++;o++}if(o==0){return""}n+="</div></div>";var L=Math.ceil(o/2)*O;n=n.replace("{{LISTHEIGHT}}",+L);return n}}});return u},{requires:["base","node","ajax","event","anim","ua","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-foot.css"]});KISSY.add("mui/mallbar/plugin/trip",function(a,e,i,t,r,s,o,n){var l=['<div class="mui-mbarp-trip-disk"></div>','<img class="mui-mbarp-trip-logo mui-mbarp-trip-logo-anim" src="{0}" />'].join("");var m="http://gtms01.alicdn.com/tps/i1/T10aT_Fl0XXXXJwqvl-64-98.png";var c="http://gtms01.alicdn.com/tps/i1/T1W_j2FbtcXXXJwqvl-64-98.png";var u='<img class="mui-mbarp-trip-logo-img" width="35" heigth="30" src="{0}" />';var b=function(a){var e=this;b.superclass.constructor.call(e,a);e.init()};a.extend(b,e,{init:function(){var a=this;var e=a.get(s.K.CONTAINER);var i=a.get(s.K.MALLBAR_ITEM);var t=i.get(s.K.MALLBAR);var r=i.get(s.K.TAB);var n=r.one(".mui-mbar-tab-txt");var l=r.one(".mui-mbar-tab-logo-trip");o.getStaticConf({cb:function(a){a.tripTxt&&n.html(a.tripTxt);if(a.tripLogo){l.append(o.fm(u,a.tripLogo))}a.tripBgColor&&r.css("background-color",a.tripBgColor)}});a.on(s.E.VISIBILITY_CHANGE,function(a){if(a.visible&&a.first){o.getStaticConf({cb:function(a){if(a.tripUrlTime&&a.tripUrl){var i=t.get(s.K.MODEL).get(s.K.TIMESTAMP);var r=a.tripUrlTime;var n=r.s?r.s:"";var l=r.e?r.e:"";if(i>n&&i<l){s.U.TRIP_TMS=a.tripUrl}}e.html(o.fm('<iframe src="{0}" class="mui-mbarp-trip-bd" frameborder="0"></iframe>',s.U.TRIP_TMS));var m=e.one(".mui-mbarp-trip-bd");m.height(e.height())}})}})}});return b},{requires:["base","node","event","ua","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-trip.css"]});KISSY.add("mui/mallbar/plugin/top",function(a,e,i,t,r,s,o){var n=function(a){var e=this;n.superclass.constructor.call(e,a);e.init()};a.extend(n,e,{init:function(){var e=this;var i=e.get(r.K.MALLBAR_ITEM);var t=i.get(r.K.TAB);var o=a.one(window);o.on("scroll",a.buffer(function(a){var e=o.scrollTop();e>0?t.fadeIn(.2):t.fadeOut(.1)},100));o.fire("scroll");t.on("click",function(){s.log("top click");s.sendLog(r.ARR.BACKTOP_CLICK);n(0,0,300,"ease")});function n(e,i,t,r){if(!t){window.scrollTo(e,i)}else{a.one(window).animate({scrollLeft:e,scrollTop:i},t/1e3,r)}}}});return n},{requires:["base","node","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-top.css"]});KISSY.add("mui/mallbar/plugin/ue",function(a,e,i,t,r,s,o){var n=function(a){var e=this;n.superclass.constructor.call(e,a);e.init()};a.extend(n,e,{init:function(){var e=this;var i=e.get(r.K.MALLBAR_ITEM);var t=i.get(r.K.TAB);var s="http://ur.taobao.com/survey/view.htm?id=";var o=i.getGConfig();if(o.ueId){s=s+o.ueId;a.one(".mui-mbar-tab-ue").show();a.all("<style>.mui-mbar .mui-mbar-tab-ue {display:block}</style>").appendTo("head");var n=t.one(".mui-mbar-tab-logo-ue");n.append('<a style="display:block;width: 35px;height: 35px;overflow: hidden;text-indent: -40px" href="'+s+'">UE</a>')}}});return n},{requires:["base","node","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-ue.css"]});KISSY.add("mui/mallbar/plugin/qrcode",function(a,e,i,t,r,s,o,n,l,m){var c=new m(['<div class="mui-mbarp-qrcode-tip">','   <div class="mui-mbarp-qrcode-hd">','       <img src="'+o.U.QR+'" width="140" height="140"/>',"   </div>",'   <div class="mui-mbarp-qrcode-bd">','       <img src="http://gtms03.alicdn.com/tps/i3/T1OLK7FpdXXXbb5hfb-145-14.png"/>',"   </div>","</div>",'<div class="mui-mbar-arr mui-mbarp-qrcode-arr">\u25c6</div>'].join(""));var u=function(a){var e=this;u.superclass.constructor.call(e,a);e.init()};a.extend(u,e,{init:function(){var e=this;var t=e.mallbarItem=e.get(o.K.MALLBAR_ITEM);var r=t.get(o.K.MALLBAR);var s=r.get(o.K.ROOT);var l=t.getUserInfo();var m=t.get(o.K.TAB);var u=a.all('<div class="mui-mbarp-qrcode"></div>').appendTo(s);e.renderTpl=false;e.qrcodeSrc="";var b=n.getSysId();e.isDetail=b=="detail";e.isList=b=="list";e.isShop=b=="shop";e.isHalfSale=window.g_config.is1111HalfPriceItem;if(e.isDetail||e.isList||e.isShop){e.renderTpl=true}var d=l.memberInfo.activeStatus||"";var p=!l.isLogin||l.isLogin&&d>0;var f=false;if(e.isDetail){var v="";if(window.g_config&&window.g_config.isClosedSales){v=window.g_config.isClosedSales}if(v&&p){n.getStaticConf({cb:function(a){var i=a.closedStartTime||"";var t=a.closedEndTime||"";var s=r.get(o.K.MODEL).get(o.K.TIMESTAMP);if(a.mobilecrossVersion){e.set("mobilecrossVersion",a.mobilecrossVersion)}if(s>=i&&s<=t||f){n.ajax({url:o.URL.GET_CLOSE_SALE_NUM,timeout:4,data:{itemId:r.get("itemId")},jsonpCallback:"__mallbarGetCloseSaleNum",success:function(a){if(a.s==200&&a.pec&&a.pec>0){r.set("closeSaleNum",a.pec)}h()}})}else{g()}}})}else{g()}}else{g()}function h(){var i="";if(window.g_config&&window.g_config.itemId){i=window.g_config.itemId}var s="http://gqrcode.alicdn.com/img?w=125&h=125&type=hv&logo=TB1cM36FVXXXXXiXpXXIqztGVXX-45-45.png&el=h&text=http://www.tmall.com/go/act/tmall-fp/m/download.php";if(i){s="http://gqrcode.alicdn.com/img?v=1&w=125&h=125&type=bi&item_id="+i}var c="\u53cc11\u5c16\u8d27\u63d0\u524d\u5f00\u62a2";var u="\u53cc11\u5c16\u8d27\u63d0\u524d\u5f00\u62a2";if(e.isHalfSale){c="\u63d0\u524d\u4eab\u53cc11\u7279\u60e0";u="\u63d0\u524d\u4eab\u53cc11\u7279\u60e0"}var b=['<div class=" mui-mbar-bubble  mui-mbarp-qrcode-bubble">','<div class="mui-mbar-arr mui-mbarp-qrcode-bubble-arr">\u25c6</div>','<div class="mui-mbar-bubble-close mui-mbarp-qrcode-bubble-close"></div>','   <div class="mui-mbarp-qrcode-title">',"   <p>\u7528\u624b\u673a\u5929\u732b\u626b\u7801</p>    ",'   <p class="mui-mbarp-qrcode-t-l">'+c+"</p>","   </div>",'   <div class="mui-mbarp-qrcode-bubble-hd">','       <img src="'+s+'" />',"   </div>",'<p class="mui-mbarp-qrcode-lowlight">\u5929\u732b\u4f1a\u5458\u4e13\u4eab\u7279\u6743</p>',"</div>"].join("");var p=['<div class="mui-mbar-bubble mui-mbarp-qrcode-bubble mui-mbarp-qrcode-bubble-2">','<div class="mui-mbar-arr mui-mbarp-qrcode-bubble-arr">\u25c6</div>','<div class="mui-mbar-bubble-close  mui-mbarp-qrcode-bubble-close"></div>','   <div class="mui-mbarp-qrcode-title-2">',"   <p >\u7a7f\u8d8a\u5230\u624b\u673a\u5929\u732b</p><p>"+u+"</p>","</div>",'<div class="mui-mbarp-qrcode-cross-cont">','<p class="mui-mbarp-qrcode-content-button">\u7a7f\u8d8a\u5230\u624b\u673a</p>','<p class="mui-mbarp-qrcode-lowlight">\u5929\u732b\u4f1a\u5458\u4e13\u4eab\u7279\u6743</p>',"</div>","</div>"].join("");var f={};f.html=b;f.height=220;f.clicked="";f.showed="";f.dismiss="";if(l.isLogin&&d>0){f.html=p;f.height=190;var v=e.get("mobilecrossVersion")||"0.9.7";a.config({modules:{"mui/mobilecross":{path:"http://g.tbcdn.cn/mui/mobilecross/"+v+"/mobilecross.js"},"mui/mobilecross/mobilecross.css":{path:"http://g.tbcdn.cn/mui/mobilecross/"+v+"/mobilecross.css"}}});f.clicked=function(){n.sendLog(o.ARR.QRCODE_BUBBLE_TUSER_QRCODE_CLICK);a.use("mui/mobilecross",function(a,e){var i=t.get("bubble");var s=a.DOM.attr(a.one("#J_ImgBooth"),"src");!!e&&e.cross({itemId:r.get("itemId"),itemImg:s,relEl:i,callback:function(){}})})};f.showed=function(){n.sendLog(o.ARR.QRCODE_BUBBLE_TUSER_QRCODE_SHOW)};h(f)}else{f.html=b;f.height=240;f.showed=function(){n.sendLog(o.ARR.QRCODE_BUBBLE_NO_LOGIN_QRCODE_SHOW)};h(f)}function h(a){r.bubble({show:true,flag:.6,content:a.html,customContentType:3,bubbleType:1,height:a.height,tab:"QRCODE",isNotTabFire:true,showed:a.showed||"",clicked:a.clicked||"",dismiss:a.dismiss});m.on("mouseenter",function(){e.mallbarItem.fire(o.E.BUBBLE_CHANGE,{show:true,html:a.html,showDelay:500,customContentType:3,bubbleType:1,height:a.height,tab:"QRCODE",isNotTabFire:true,tabMouseleave:true,showed:function(){},clicked:a.clicked||""})})}}function g(){if(e.isShop){var l=e.shopConfig=t.getShopConfig()||t.getGConfig()||{};e.sellerId=l.userId||l.sellerId;!!l.shopId&&(e.shopId=l.shopId);if(e.shopId||e.sellerId){e.qrcodeSrc="http://gqrcode.alicdn.com/img?type=bs&shop_id="+(!!e.shopId?e.shopId:0)+"&seller_id="+(!!e.sellerId?e.sellerId:0)}}if(e.isList){var b=window.encodeURIComponent(location.href);e.qrcodeSrc="http://gqrcode.alicdn.com/img?type=hv&logo=TB1cM36FVXXXXXiXpXXIqztGVXX-45-45.png&el=h&text="+b}if(e.isDetail){var d="";if(window.g_config&&window.g_config.itemId){d=window.g_config.itemId}if(d){e.qrcodeSrc="http://gqrcode.alicdn.com/img?v=1&type=bi&item_id="+d}}u.html(c.render());u.hide();a.one(document).on("click",function(a){u.hide()});r.on(o.E.MALLBAR_STATUS_CHANGE,function(a){u.hide()});e.on(o.E.QRCODE_CHANGE,function(a){if(a.pid){var i=s.one(".mui-mbar-tab-logo-"+a.pid);if(i){u.css({top:i.parent().css("top")})}}else{u.css({top:m.css("top")})}if(o.S.STANDARD===r.get(o.K.STATUS)){u.css("display")==="none"&&n.sendLog(o.ARR.QRCODE);if(e.renderTpl){var t='<img src="'+e.qrcodeSrc+'" width="140" height="140"/>';u.one(".mui-mbarp-qrcode-hd").html(t);e.renderTpl=false}u.show()}});u.one(".mui-mbarp-qrcode-tip").on("mouseleave",function(t){var r=a.one(t.toElement||t.relatedTarget);if(i.hasClass(r,"mui-mbar-tabs-shadow")||i.hasClass(r,"mui-mbarp-qrcode-arr")){if(e.renderTpl){var s='<img src="'+e.qrcodeSrc+'" width="140" height="140"/>';u.one(".mui-mbarp-qrcode-hd").html(s);e.renderTpl=false}u.show()}else{u.hide()}});var p=false;m.on("mouseenter",function(i){p=true;a.later(function(){if(p){e.fire(o.E.QRCODE_CHANGE)}},400)}).on("mouseleave",function(e){p=false;var t=a.one(e.toElement||e.relatedTarget);if(t){if(!i.hasClass(t,"mui-mbar-tabs-shadow")){if(!t.parent(".mui-mbarp-qrcode")){u.hide()}}}}).on("click",function(){u.css("display")==="none"&&n.sendLog(o.ARR.QRCODE);if(e.renderTpl){var a='<img src="'+e.qrcodeSrc+'" width="140" height="140"/>';u.one(".mui-mbarp-qrcode-hd").html(a);e.renderTpl=false}u.show()})}}});return u},{requires:["base","dom","node","event","mui/minilogin","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","xtemplate","mui/mallbar/plugin-qrcode.css"]});KISSY.add("mui/mallbar/plugin/favor",function(a,e,t,i,r,n,s,o){var m="401";var l=function(a){return a.replace(/\.jpg_.+\.jpg/,".jpg")};var u=function(a){var e=this;u.superclass.constructor.call(e,a);e.init()};var c='<div class="mui-mbarp-favor-list"><i></i>{{content}}'+'<p class="mui-mbarp-favor-see-more"><a target="_blank" href="http://shoucang.taobao.com/item_collect.htm">\u67e5\u770b\u5168\u90e8</a></p>'+"</div>";var b='<div class="mui-mbarp-favor-detail">            <div class="mui-mbarp-favor-detail-hd">                <h2>\u642d\u914d/\u540c\u6b3e</h2>                <span class="mui-mbarp-favor-detail-back">\u6211\u7684\u6536\u85cf</span>            </div>            <div class="mui-mbarp-favor-detail-bd">                <div class="mui-mbarp-favor-item-b">                </div>                <div class="mui-mbarp-favor-recommand-box">                    <ul class="mui-mbarp-favor-recommand-tab">                        <li class="mui-mbarp-favor-recommand-tab-item mui-mbarp-favor-recommand-tab-item-match" data-type="match">\u627e\u642d\u914d<b></b></li>                        <li class="mui-mbarp-favor-recommand-tab-item mui-mbarp-favor-recommand-tab-item-fx" data-type="fx">\u627e\u540c\u6b3e<b></b></li>                    </ul>                    <div class="mui-mbar-favor-recommand-content mui-mbar-favor-recommand-content-match"></div>                    <div class="mui-mbar-favor-recommand-content mui-mbar-favor-recommand-content-fx"></div>                </div>            </div>        </div>';var d='<li class="mui-mbarp-favor-recommand-item">                <a target="_blank" href="{itemUrl}">                    <img src="{picUrl}" width="100" height="100"/>                    <p><span class="mui-price-font">&yen;</span>{promotionPrice}</p>                </a></li>';var p=[1,2,3,4];var f=0;a.extend(u,e,{_itemListCache:{},init:function(){var e=this;var t=this;var i=e.get(s.K.CONTAINER);var r=e.get(s.K.TIP_CONTAINER);var n=e.get(s.K.MALLBAR_ITEM);var m=n.get(s.K.MALLBAR);var l=n.get(s.K.BUBBLE);o.log(n,this);this._initBind();this._initDOMBind();a.later(function(){t._initRecommandDetail()},10)},_initDOMBind:function(){var e=this;var t=this.get(s.K.MALLBAR_ITEM);var i=t.get(s.K.MALLBAR);var r=this._pluginContainer=this._pluginContainer||a.one(".mui-mbar-plugin-favor");r.delegate("click",".mui-mbarp-favor-cancel",function(t){var r=a.one(t.currentTarget).parent("li");r.animate({opacity:0,width:0},{duration:.5,easing:"easeOut",complete:function(){r.remove();e._isDataChange=true}});var n=a.one(t.currentTarget).attr("data-itemId");i._deleteFavor(n,function(){});o.sendLog(s.ARR.FAVOR_DELETE);t.preventDefault()});r.delegate("mouseenter",".mui-mbarp-favor-item",function(e){var t=a.one(e.currentTarget);t.addClass("mui-mbarp-favor-item-hover")});r.delegate("mouseleave",".mui-mbarp-favor-item",function(e){var t=a.one(e.currentTarget);t.removeClass("mui-mbarp-favor-item-hover")});r.delegate("mouseenter mouseleave",".mui-mbarp-favor-item-sale",function(e){var t=a.one(e.currentTarget);t.toggleClass("mui-mbarp-favor-item-sale-hover")});this._bindDetail();this._initBindCateCheck()},_initBind:function(){var a=this;this.on("visibilityChange",function(e){if(e.visible&&e.first){a._initContainer()}else if(!e.visible&&a._isDataChange){a._isDataChange=false;a._initContainer()}});this.on(s.E.DATA_CHANGE,function(e){o.log("Plugin",e.type);a._initContainer()})},_initContainer:function(){var e=this;a.later(function(){e._initFavorList()},10)},_initRecommandDetail:function(){var e=this;var t=this._pluginContainer||a.one(".mui-mbar-plugin-favor");t.append(b);a.later(function(){e._initDetailBind()},10)},_initDetailBind:function(){var e=this._favorDetail=a.one(".mui-mbarp-favor-detail");var t=this._favorTabItems=a.all(".mui-mbarp-favor-recommand-tab-item");var i=this._favorTabContents=a.all(".mui-mbar-favor-recommand-content");var r=this;e.delegate("click",".mui-mbarp-favor-detail-back",function(a){r._switchBackToList();o.sendLog(s.ARR.FAVOR_BACK);a.halt()});e.delegate("click",".mui-mbarp-favor-recommand-tab-item",function(e){var r=a.one(e.currentTarget);t.removeClass("mui-mbarp-favor-recommand-tab-item-sellected");r.addClass("mui-mbarp-favor-recommand-tab-item-sellected");var n=r.attr("data-type");var s=a.one(".mui-mbar-favor-recommand-content-"+n);i.hide();s.show();e.halt()})},_initFavorList:function(){var a=this.get(s.K.MALLBAR_ITEM);var e=a.get(s.K.MALLBAR);var t=a.get(s.K.TAB);var i=this;var n=new r({dataType:"jsonp",scriptCharset:"gbk",type:"GET",url:s.URL.GET_PLUGIN_FAVOR_INFO,success:function(e){o.log("::favorList::",e);if(e.success&&e.status!=m){if(e.itemInfo&&e.cateInfo.length>1){if(e.cateInfo){i._initCateBox(e.cateInfo)}i._initItemListInner(e.itemInfo)}else{o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.favor.getFavorItem.data.empty","\u7528\u6237\u6536\u85cf\u5939\u4e3a\u7a7a");a.fire(s.E.ERROR,{tip:"\u54a6\uff0c\u4eb2\u8fd8\u6ca1\u6709\u6536\u85cf\u8fc7\u5546\u54c1\u54e6\uff01"})}}else{if(e.status==m){o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.favor.getFavorItem.user.not-login","\u7528\u6237\u767b\u9646\u8d85\u65f6")}else{o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.favor.getFavorItem.failure.bad-status-"+e.status,"\u6536\u85cf\u5939\u83b7\u53d6\u4fe1\u606f\u72b6\u6001\u5f02\u5e38")}a.fire(s.E.ERROR)}},error:function(){o.codeTracker.sendTrack(s.T.NUMLEV,"mallbar.favor.getFavorItem.data.error","\u6536\u85cf\u5939\u4fe1\u606f\u83b7\u53d6\u5931\u8d25");a.fire(s.E.ERROR)}})},_initCateBox:function(e){var t='<div class="mui-mbarp-favor-cate-trigger"><h3><i></i>\u5206\u7c7b</h3><div class="mui-mbarp-favor-cate-cont"><ul>{{content}}</ul></div></div>';var i='<li class="mui-mbarp-favor-cate-item" data-cateId="{cateId}"><a target="_blank" href="javascript:void(0);">{cateName}({number})</a></li>';var r=[];var n=a.one(".mui-mbarp-favor-cate-trigger");a.each(e,function(e,t){r.push(a.substitute(i,e))});if(n){n.one("ul").html(r.join(""))}else{t=t.replace("{{content}}",r.join(""));var s=a.one(".mui-mbar-plugin-favor").one(".mui-mbar-plugin-hd");s.append(t);a.later(function(){n=a.one(".mui-mbarp-favor-cate-trigger");n.on("mouseenter mouseleave",function(){n.toggleClass("mui-mbarp-favor-cate-trigger-hover")})},10)}},_initBindCateCheck:function(){var e=this;var t=this._pluginContainer;t.delegate("click",".mui-mbarp-favor-cate-item",function(t){var i=a.one(t.currentTarget);i.addClass("mui-mbar-favor-cate-item-sellected").siblings().removeClass("mui-mbar-favor-cate-item-sellected");var r=i.attr("data-cateId");var n=".mui-mbarp-favor-item-"+r;e._itemListAll=a.all(".mui-mbarp-favor-item");e._timeList.hide();if(r){e._itemListAll.hide();a.all(n).show();e._timeList.each(function(a){if(a.all(n).length>0){a.show()}})}else{a.all(".mui-mbarp-favor-item").show();e._timeList.show()}e._dataLazyloadIns.refresh();o.sendLog(s.ARR.FAVOR_CATE_CHECK);t.halt()})},_getPicHost:function(){var a=f++;if(a>3){a=0}return"http://gtms0"+p[a]+".alicdn.com/tps/"},_initItemListInner:function(e){var t=this;var i=["lastWeek","oneWeekAgo","oneMonthAgo","twoMonthAgo"];var r={lastWeek:"\u6700\u8fd1\u4e03\u5929",oneWeekAgo:"\u4e00\u5468\u524d",oneMonthAgo:"\u4e00\u4e2a\u6708\u524d",twoMonthAgo:"\u4e24\u4e2a\u6708\u524d"};var n=[];a.each(i,function(a,i){e[a].desc=r[a];e[a].name=a;n.push(t._renderSingleTime(e[a]))});this._renderItemList(n.join(""))},_renderItemList:function(e){var t=this;var i=this.get(s.K.CONTAINER);var r=c.replace("{{content}}",e);i.html(r);a.later(function(){t._dataLazyloadIns&&t._dataLazyloadIns.destroy();t._dataLazyloadIns=new n({container:i,diff:50});a.later(function(){n.loadCustomLazyData(i,"textarea")},500);t._timeList=a.all(".mui-mbarp-favor-item-time")},10)},_bindDetail:function(){var a=this;var e=this._pluginContainer;e.delegate("click",".mui-mbarp-favor-to-detail",function(e){a._toItemDetail(e)})},_toItemDetail:function(e){var t=a.one(e.currentTarget);var i=t.parent(".mui-mbarp-favor-item");var r=t.attr("data-type");var n=i.attr("data-itemId");var m=this._itemListCache[n];m.recommandType=r;if(r=="match"){o.sendLog(s.ARR.FAVOR_TO_MATCH)}else{o.sendLog(s.ARR.FAVOR_TO_FX)}this._initItemDetail(m);this._switchToFavorDetail(i);e.halt()},_switchToFavorDetail:function(e){var i=e.attr("data-itemId");var r=this._itemListCache[i];r.itemPicBig=r.itemPic+"_240x240.jpg";if(!(a.UA.ie<9)){var n='<img class="mui-mbarp-favor-flayer" src="'+r.itemPicBig+'"/>';var s=e.offset();var o=this._pluginContainer;s.top=s.top-a.one(window).scrollTop();s.left=s.left-o.offset().left;var m={left:0,top:40};n=t(n);n.css(s);o.append(n);n.animate({left:m.left,top:m.top,width:235,height:235},{duration:.3,easing:"easeOut",complete:function(){n.animate({opacity:0},{duration:.2,easing:"easeOut",complete:function(){n.remove()}})}})}var l=this._favorDetail||a.one(".mui-mbarp-favor-detail");l.animate({right:0},{duration:.3,easing:"easeOut"})},_switchBackToList:function(){var e=this._favorDetail||a.one(".mui-mbarp-favor-detail");e.animate({right:-235},{duration:.3,easing:"easeOut"})},_initItemDetail:function(a){o.log("::to item Detail::",a);this._initFavorDetailBig(a);this._initRecommandList(a)},_initFavorDetailBig:function(e){var t='<a target="_blank" href="{itemUrl}" class="mui-mbarp-favor-detail-big">                    <img src="{itemPicBig}" width="235" height="235"/>                    <p class="mui-text-overflow">{itemTitle}</p>                </a>';e.itemPicBig=e.itemPic+"_240x240.jpg";var i=a.substitute(t,e);if(!this._favorItemBigCont){this._favorItemBigCont=a.one(".mui-mbarp-favor-item-b")}this._favorItemBigCont.html(i)},_initRecommandList:function(e){this._tabItemMatch=this._tabItemMatch||a.one(".mui-mbarp-favor-recommand-tab-item-match");this._tabItemFx=this._tabItemFx||a.one(".mui-mbarp-favor-recommand-tab-item-fx");this._tabContentMatch=this._tabContentMatch||a.one(".mui-mbar-favor-recommand-content-match");this._tabContentFx=this._tabContentFx||a.one(".mui-mbar-favor-recommand-content-fx");if(e.recommandType=="match"){this._tabItemMatch.addClass("mui-mbarp-favor-recommand-tab-item-sellected");this._tabItemFx.removeClass("mui-mbarp-favor-recommand-tab-item-sellected")}else{this._tabItemMatch.removeClass("mui-mbarp-favor-recommand-tab-item-sellected");this._tabItemFx.addClass("mui-mbarp-favor-recommand-tab-item-sellected")}this._favorTabContents.html("");this._initTabContent("match",e);this._initTabContent("fx",e)},_initTabContent:function(e,t){var i=this;var n;var m;if(e=="match"){n=this._tabContentMatch;m=s.URL.GET_PLUGIN_FAVOR_MATCH}else{n=this._tabContentFx;m=s.URL.GET_PLUGIN_FAVOR_FX}new r({url:m,dataType:"jsonp",type:"GET",scriptCharset:"gbk",data:{itemId:t.itemId,categoryId:t.categoryId,sellerId:t.sellerId},success:function(r){o.log("::favor item recommand::",r);var s=[];if(r&&r.data&&r.data.length){s.push("<ul>");a.each(r.data,function(e,t){if(t>11){return}e.picUrl=l(e.picUrl)+"_100x100.jpg";s.push(a.substitute(d,e))});s.push("</ul>");n.html(s.join(""));if(e==t.recommandType){i._favorTabContents.hide();n.show()}if(r.exposureParam){o.sendLog(r.exposureParam)}}else{o.codeTracker.sendTrack(20,"mallbar.favor.getFavorItemAld.data.empty","\u6536\u85cf\u5939\u5546\u54c1\u63a8\u8350\u4e3a\u7a7a")}},error:function(a){o.codeTracker.sendTrack(20,"mallbar.favor.getFavorItemAld.data.error","\u6536\u85cf\u5939\u5546\u54c1\u63a8\u8350\u83b7\u53d6\u5931\u8d25|"+e)}})},_renderSingleTime:function(e){var t=this;if(e.length){var i=[];var r='<li class="mui-mbarp-favor-item mui-mbarp-favor-item-{cateFrontId} mui-mbarp-favor-item-index-{isOdd}" data-itemId="{itemId}" data-sellerId="{sellerId}" data-categoryId="{categoryId}">                <a target="_blank" href="{itemUrl}">                    <img src="{itemPicSmall}" width="100" height="100"/>                    <div class="mui-mbarp-favor-item-info">                        <em class="mui-mbarp-favor-item-sale {isDown}">                            <div class="mui-mbarp-favor-item-sale-info">                                <div class="mui-mbarp-favor-item-sale-info-cont">                                    <b></b>                                    <p>\u6bd4\u6536\u85cf\u65f6\u76f4\u964d\uff1a<span class="mui-price-font">&yen;{priceDown}</span></p>                                    <p>\u52a0\u5165\u6536\u85cf\u65f6\u4ef7\u683c\uff1a<span class="mui-price-font">&yen;{itemCollectPrice}</span></p>                                </div>                            </div>                        </em>                        <span class="mui-price-font">&yen;{itemPrice}</span>                    </div>                    <div class="mui-mbarp-favor-item-relation">                        <span class="mui-mbarp-favor-item-match mui-mbarp-favor-to-detail" data-type="match">\u627e\u642d\u914d</span>                        <span class="mui-mbarp-favor-item-fx mui-mbarp-favor-to-detail" data-type="fx">\u627e\u540c\u6b3e</span>                    </div>                    <span class="mui-mbarp-favor-cancel mui-favor-delete" title="\u53d6\u6d88\u6536\u85cf" data-itemId="{itemId}"></span>                </a>                </li>';i.push('<div class="mui-mbarp-favor-item-time mui-mbarp-favor-item-list-'+e.name+'">');i.push('<div class="mui-mbarp-favor-item-time-box"><span class="mui-mbarp-favor-item-time-info">'+e.desc+"</span></div>");i.push('<div class="mui-mbarp-favor-item-list mui-fix-float">');a.each(e,function(n,o){if(o%20==0){i.push('<textarea class="ks-datalazyload ks-datalazyload-custom"><ul>')}n.isOdd=""+o%2;t._itemListCache[n["itemId"]]=n;n.itemUrl=n.itemUrl+"&scm="+s.SCM.FAVOR_ITEM;if(n.itemPic&&n.itemPrice){n.itemPic=l(n.itemPic);if(n.priceDown>0){n.isDown=""}else{n.isDown="hidden"}n.itemPicSmall=n.itemPic+"_100x100.jpg";i.push(a.substitute(r,n))}if(o%20==19||o+1==e.length){i.push("</ul></textarea>")}});i.push("</div></div>");return i.join("")}else{return""}}});return u},{requires:["base","node","event","ajax","datalazyload","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/plugin-favor.css"]});KISSY.add("mui/mallbar/plugin/charge",function(a,e,t,i,r,s){var n=function(a){var e=this;n.superclass.constructor.call(e,a);e.init()};a.extend(n,e,{init:function(){var e=this;var t=e.get(r.K.MALLBAR_ITEM);var i=t.get(r.K.MALLBAR);var s=e.get(r.K.CONTAINER);var n=t.get(r.K.TAB);var o=i.get(r.K.G_CONFIG);if(o.bizId=="mallfp"){n.show()}e.on("visibilityChange",function(e){if(e.visible&&e.first){a.use("mui/chongzhi/index,mui/chongzhi/dianquan",function(a,e,t){s.html('<div id="J_MbarPhoneCharge" class="mui-mbar-plugin-phone-charge"></div><div id="J_MbarDianquanCharge" class="mui-mbar-plugin-dianquan-charge"></div>');setTimeout(function(){var i=a.one("#J_MbarPhoneCharge");if(!i)return;e(i);var r=a.one("#J_MbarDianquanCharge");if(!r)return;new t(r,{})},0)})}})}});return n},{requires:["base","node","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/plugin-charge.css"]});KISSY.add("mui/mallbar/plugin/promotion",function(a,e,i,t,r,s,n,o){var l=['<img class="mui-mbarp-promotion-logo mui-mbarp-promotion-logo-anim" src="{0}" />'].join("");var m=function(a){var e=this;m.superclass.constructor.call(e,a);e.init()};a.extend(m,e,{init:function(){var e=this;var i=e.get(s.K.CONTAINER);var t=e.mallbarItem=e.get(s.K.MALLBAR_ITEM);var r=t.get(s.K.MALLBAR);var l=t.get(s.K.TAB);function m(){i.one(".mui-mbarp-promotion-bd").height(i.height())}var u,c;var b=a.unparam(window.location.search.replace("?",""));function d(e){if(u&&c){e&&e({navUrl:u,navLogo:c})}else{window.__content_results=window.__content_results||[];new a.IO({url:"http://delta.taobao.com/home/delivery/AllContentByPage.do",type:"GET",dataType:"script",scriptCharset:"utf-8",data:{resourceIds:20140703,wfType:b["wfType"],wfCode:b["wfCode"],_mock_:b["_mock_"]},success:function(){if(a.unparam(window.location.search.replace("?",""))["promotion-mock"]==1){__content_results=[{content:"http://gtms01.alicdn.com/tps/i1/TB1Ne73FFXXXXXEapXXXOXwIpXX-70-70.gif",link:"http://www.tmall.com/go/rgn/promotion-act/public-block-toolbar.php",contentPicUrl:"http://gtms03.alicdn.com/tps/i3/TB1KrUZFFXXXXcoapXXF6kF2pXX-190-480.jpg",title:"\u590f\u65e5\u9017\u6bd45\u6298",rightDesc:"T100\u4e13\u4eab",actDesc:"\u5173\u6ce8\u54c1\u724c\u5373\u53ef\u4eab"}]}n.log("::content result::",__content_results);var i={};if(__content_results&&__content_results[0]&&__content_results[0].content&&__content_results[0].link){n.sendLog(s.ARR.PROMOTION_SHOW);n.sendLog(__content_results[0].exposureParam);i=__content_results[0];u=i.navUrl=__content_results[0].link;c=i.navLogo=__content_results[0].content;e&&e(i)}}})}}var p='<div class="mui-mbarp-promotion-bubble-cont">                    <div class="mui-mbarp-promotion-bubble-notice">                        <p>{nick}\u4e13\u4eab\u7684\u54c1\u724c\u7279\u6743</p>                        <p>\u9650\u65f6\u6d3e\u53d1\u4e2d</p>                    </div>                    <div class="mui-mbarp-promotion-bubble-brand">                        <img class="mui-mbarp-promotion-bubble-img" src="{navLogo}" width="90" height="45"/>                        <span class="mui-mbarp-promotion-bubble-get">\u7acb\u5373\u9886\u53d6</span>                    </div>                </div>';var f='<div class="mui-mbarp-promotion-content">                    <a class="mui-mbarp-promotion-content-link" href="{link}" target="_blank">                        <div class="mui-mbarp-promotion-content-img">                            <img src="{contentPicUrl}" width="200" height="360"/>                        </div>                        <div class="mui-mbarp-promotion-content-box">                        <h1 class="mui-mbarp-promotion-content-title" title="{title}">{title}</h1>                        <p class="mui-mbarp-promotion-content-desc">{actDesc}</p>                <p class="mui-mbarp-promotion-content-right"><span class="mui-mbarp-promotion-right"><i class="mui-mbar-iconfont">&#xe600;</i>{rightDesc}</span></p>                        <p class="mui-mbarp-promotion-content-brand-icon">                            <img src="{navLogo}" width="90" height="45"/>                        </p>                        <span class="mui-mbarp-promotion-content-button">\u7acb\u5373\u83b7\u53d6</span>                        </div>                    </a>                </div>';var v=a.one(".mui-mbar-tab-bubble-promotion");function h(t){d(function(m){if(m.navLogo){m.nick=t.nick;p=a.substitute(p,m);l.slideDown(.5);var u=a.one(".mui-mbar-tab-prof");var c=u.css("margin-top");u.animate({"margin-bottom":{value:5},"margin-top":{value:parseInt(c,10)-25}},{duration:.5});var b="mui/mbarp/promotion/"+m.acm;o.get({k:b,success:function(a){if(!a){r.bubble({show:true,content:p,customContentType:2,bubbleType:1,height:90,tab:"PROMOTION",showed:function(){n.sendLog(s.ARR.PROMOTION_BUBBLE_SHOW);o.set({k:b,v:1})},clicked:function(){l.fire("click");n.sendLog(s.ARR.PROMOTION_BUBBLE_CLICK)}})}}});l.on("mouseenter",function(){e.mallbarItem.fire(s.E.BUBBLE_CHANGE,{show:true,html:p,height:90,showDelay:500,isCustomContent:true,customContentType:2,bubbleType:1,isNotTabFire:true,tabMouseleave:true,showed:"",clicked:function(){l.fire("click");n.sendLog(s.ARR.PROMOTION_BUBBLE_CLICK)}})});e.on(s.E.VISIBILITY_CHANGE,function(e){if(m.navUrl){if(e.visible&&e.first){var t=a.substitute(f,m);i.html(t)}}})}})}n.getStaticConf({cb:function(){TB.Global.loginStatusReady(function(a){if(a.isLogin){h(a)}else{t.on(s.E.LOGIN_SUCCESS,function(e){h(a)})}})}})}});return m},{requires:["base","node","dom","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-promotion.css"]});KISSY.add("mui/mallbar/plugin/cart",function(a,e,t,i,r,s,n,o,l){var m=function(a){var e=this;m.superclass.constructor.call(e,a);e.init()};a.extend(m,e,{init:function(){var e=this;var t=e.get(r.K.CONTAINER);var i=e.get(r.K.MALLBAR_ITEM);var n=i.get(r.K.MALLBAR);var m=i.get(r.K.TAB);var u=a.all('<div class="mui-mbarp-tab-cart-border "></div>').appendTo(m);m.on("mouseenter",function(){u.hide()}).on("mouseleave",function(){if(!i.get(r.K.EXPAND)){u.show()}});n.on(r.E.MALLBAR_STATUS_CHANGE,function(a){r.S.STANDARD===a.status?u.show():u.hide()});i.on(r.E.LOGIN_SUCCESS,function(a){e._updateMiniCartNum(function(){})});l.set("_mallbarItem",i);l.set("_mallbarConf",r);e._bindCartModel();e._bindResize();e._updateMiniCartNum();e.on("visibilityChange",function(a){a.visible?u.hide():u.show();if(a.visible&&a.first){t.html('<div class="mui-mbarp-cart-wrap"><div id="J_MBarMiniCart" class="mui-mbarp-cart-bd"></div></div>');o.init("#J_MBarMiniCart")}else if(a.visible){o.strectch();e._resize()}if(a.visible){if(n.get("isBucket10")){s.sendLog(r.ARR.CART_TAB_CLICK_DOWN)}else{s.sendLog(r.ARR.CART_TAB_CLICK)}var i=e.total||0;if(i==0){l.record("tmalljy.2.5?action=open-with-size-zero")}}});e._contentReady(".tm-mcCartBtn",function(){var e=a.one(".tm-mcCartBtn");e.text("\u67e5\u770b\u5168\u90e8")});e.on("addCartItem",function(){e._updateMiniCartNum()});e.fire(r.E.ADD_CART_ITEM)},_contentReady:function(e,t){var i=false;setTimeout(function(){i=true},5e3);setTimeout(function(){var r=a.one(e);if(r&&r.children()){t()}else if(!i){setTimeout(arguments.callee,50)}},50)},_bindCartModel:function(){var a=this;var e=a.get(r.K.MALLBAR_ITEM);l.on("numChange",function(a){var t=e.getUserInfo();if(t&&t.isMallSeller){e.fire("suptipChange",{show:true,num:0});return}var i=l.get("totalSize");if(typeof i=="number"&&i!="-1"){e.fire("suptipChange",{show:true,num:i})}});l.on("numChangeCheckCount",function(){var a=e.getUserInfo();if(a&&a.isMallSeller){e.fire("suptipChange",{show:true,num:0});return}var t=l.get("__totalCount__");if(typeof t=="number"&&t!="-1"){e.fire("suptipChange",{show:true,num:t})}});l.on("mallBarMiniCartNum",function(t){var i=t.data;var r=i.callback;var s=l.getNum("total");a.total=s;var n=e.getUserInfo();if(n&&n.isMallSeller){e.fire("suptipChange",{show:true,num:0})}else{e.fire("suptipChange",{show:true,num:s})}if(!r){return}r(!n.isLogin&&0===s)})},needLogin:function(a){a()},disableExpand:function(){var a=this;var e=a.get(r.K.MALLBAR_ITEM);var t=e.getUserInfo();if(t&&t.isMallSeller){s.sendLog("http://log.mmstat.com/tmalljy.2.5?action=openmini_v101");e.fire(r.E.BUBBLE_CHANGE,{show:true,customContentType:1,bubbleType:0,showDelay:100,html:"\u60a8\u662f\u5929\u732b\u5356\u5bb6\uff0c\u4e0d\u80fd\u4f7f\u7528\u8d2d\u7269\u8f66"});return true}return false},_bindResize:function(){var e=this;var i=e.get(r.K.MALLBAR_ITEM);var s=i.get(r.K.MALLBAR);t.delegate(document,"renderMiniCartList","#J_MBarMiniCart",function(){e._resize()});t.delegate(document,"miniCartEmpty","#J_MBarMiniCart",function(){a.later(function(){s.collapse({status:2})},2e3)})},_bindScroll:function(){var e=a.one(".mui-mbar-plugin-cart").one(".mui-mbar-plugin-bd");t.on(e,"scroll",a.buffer(function(t){var i=a.one(".mui-mbar-plugin-cart").one(".tm-mcHandler");var r=a.one(".mui-mbar-plugin-cart").one(".tm-mcTop");var s=e.height();i.css({position:"absolute",top:t.currentTarget.scrollTop+s-85});r.css({position:"absolute",top:t.currentTarget.scrollTop})},8>i.ie?150:-1))},_resize:function(){m();var e=a.one(".mui-mbar-plugin-cart");var t=e.one(".mui-mbar-plugin-bd");var i=e.one(".tm-mcHandler");var r=e.one(".tm-mcTop");var s=e.height();var n=a.one(".mui-mbarp-cart-bd").innerHeight();var o=i.height()+15;t.height(s);if(n>=s-o){if(l.get("quickSettlement")){a.one(".tm-mcListBox").css({"padding-bottom":o})}}else{m()}function m(){a.one(".tm-mcListBox").css({"padding-bottom":"0px"})}},_updateMiniCartNum:function(e){var t=this;var s=i.ie==6||i.ie==7;var n=t.get(r.K.MALLBAR_ITEM);var o=n.get(r.K.MALLBAR);var m=function(t){var i=t.uid;var r="TCART_234_"+i+"_q";var s=function(t){t=t||{};var i=a.isNumber(t[r]);l.setNum({normal:i?l.formatNum(t[r]):0,invalid:0});l.fire("mallBarMiniCartNum",{data:{callback:e}})};if(i){l.xhr({api:"num",data:{keys:r},complete:s})}else{s()}};TB.Global.loginStatusReady(function(e){if(e.isLogin){var t=a.later(m,5e3);TB.Global.memberInfoReady(function(a){t.cancel();var e=a.memberInfo;m({uid:e.cookies&&e.cookies.unb?e.cookies.unb.value:""})})}else{m({uid:e.trackId})}})}});return m},{requires:["base","event","ua","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/minicart","mui/minicart/model","mui/mallbar/plugin-cart.css"]});KISSY.add("mui/minicart",function(t,a,e,i,n,r,s){var o={};var c=0;t.mix(o,{version:"%VERSION%",init:function(i,n){if(c){return}c++;var s=this;s.carttype=1;i=a.get(i);n=t.merge({},n);a.addClass(i,"tm-mCart");s.el=i;var o=function(){i.innerHTML='<div class="tm-mcRoot">'+'<div class="tm-mcListBox"><div class="tm-mcListInner"><div class="tm-mcList"></div></div><div class="tm-mcLoading"></div><div class="tm-mcMask"></div></div>'+'<div class="tm-mcHandler">'+'<div class="tm-mcApart"></div>'+'<div class="tm-mcGrace"></div>'+"</div>"+"</div>";s.handlerEl=a.get("div.tm-mcHandler",i);s.listBoxEl=a.get("div.tm-mcListBox",i);s.listInnerEl=a.get("div.tm-mcListInner",i);s.listEl=a.get("div.tm-mcList",i);s.rootEl=a.get("div.tm-mcRoot",i);s.graceEl=a.get("div.tm-mcGrace",i);s.apartEl=a.get("div.tm-mcApart",i);s.renderHandler();t.use("mui/minicart/fullext",function(){s.strectch()});e.on(s.rootEl,"click",function(t){t.stopPropagation();var e=t.target;do{if(e===this){return}var i=a.attr(e,"data-tmc");if("."===i){return}if(i){if("A"===e.nodeName){t.preventDefault()}return s[i](e)}e=a.parent(e)}while(true)});r.detach("numInit",o)};r.on("numInit",o);r.numInit();s.CartModel=r},login:function(a){var e=this;r.record("tmalljy.2.5?action=openmininotlogin_v102&ver="+e.carttype);var i=r.get("_mallbarItem");var n=r.get("_mallbarConf");if(i&&n){i.fire(n.E.LOGIN,{success:function(){r.set("_isLogin",true);if(t.isFunction(a)){return a()}if(TB&&TB.Global&&TB.Global.writeLoginInfo){TB._isMemberInfoReady=false;TB._isLoginStatusReady=false;TB.Global.writeLoginInfo()}}})}},cart:function(){window.open(r.getApi("bcart"),"_blank")},add:function(e,i,n){var s=this;s.addData={params:t.clone(e),success:i,error:n};var o=e.anim;delete e.anim;i=i||function(){};r.set("_cached",false);r.add({data:e,success:function(t){if(window.TB&&TB.Global&&TB.Global.mallbar){var n=o.startNode;var r=40;var s=40;TB.Global.mallbar.driving({e:{target:o.startNode,pageX:a.offset(n).left+(a.width(n)-r)/2,pageY:a.offset(n).top-s},type:"cart",flyer:o.img,width:r,height:s,params:e,speed:2,callback:function(){i(t)}})}},error:n||i})},invalidCache:function(){r.set("_cached",false)},loginThenAdd:function(){var t=this;t.login(function(){var a=t.addData;t.add(a.params,a.success,a.error)})},renderHandler:function(){var t=this;var e=r.getNum("total");var i="";if(r.get("_listFilled")&&!t.cartDegr){i+='<div class="tm-mcCashier-wrap">';i+=o();i+='<div class="tm-mcTotal clearfix">'+'<h3><span class="tm-e1">\u8d2d\u7269\u8f66</span><span class="tm-e2">\u5df2\u9009</span><strong class="tm-mcCartNumTotal">'+e+'</strong><strong class="tm-mcCheckedNum">'+(r.get("_checkedCount")||0)+'</strong><span class="tm-e2">\u4ef6</span></h3>'+'<span class="tm-mcTotalFeeWrap"><span class="tm-mcRmb">&yen;</span><strong class="tm-mcTotalFee">'+s.toMoney(r.get("_totalFee"))+"</strong></span>"+"</div>";i+='<div class="tm-mcCashier" data-tmc="go">';i+='<div class="tm-mcGo">\u7ed3 \u7b97<s></s></div>';i+="</div>";i+="</div>"}var n=t.handlerEl;a.remove(".tm-mcCashier-wrap",n);a.append(a.create(i),n);function o(){var t="";if(r.get("isDouble11Pre")){t='<div class="tianmaobao j_tianmaobao"><a href="http://chong.alipay.com/i/chong.htm" title="\u5929\u732b\u5b9d"><img src="http://gtms01.alicdn.com/tps/i1/TB1p6vmGpXXXXXPXFXXYZaeLVXX-280-46.png"/></a></div>'}return t}}});r.on("after_counterDownChange",function(t){a[t.newVal?"addClass":"removeClass"](o.el,"tm-mcCounterDown")});r.on("after_countMaxChange",function(t){a[t.newVal?"addClass":"removeClass"](o.el,"tm-mcCountMax")});window.MiniCartModel=r;window.TMiniCart=o;return o},{requires:["dom","event","anim","ua","mui/minicart/model","mui/minicart/util","mui/minicart/minicart.css"]});KISSY.add("mui/minicart/model",function(t,e,a,r,i,n,c){var s=function(){var e=false;var a=[];var r=new Image;window["_tmcr_"+t.now()]=r;r.onload=r.onerror=function(){e=false;i()};function i(){if(e){return}var i=a.shift();if(i){e=true;r.src="http://gm.mmstat.com/"+i+(i.indexOf("?")>-1?"&":"?")+t.now()}}return function(t){if(t){a.push(t);i()}}}();function o(){var t=this;var e=location.hostname;var a=e.match(/\b(daily|com\.hk)\b/);var r=e.match(/\.hk\b/);var i=e.match(/\.95095/);var n=e.match(/\.95095\.daily\.etao\.net/);t.isDaily=a;var c=a?"daily.tmall.com.hk":"tmall.hk";var s=a?"daily.tmall.net":"tmall.com";var l=a?"daily.taobao.net":"taobao.com";var m=a?"yao.95095.daily.tmall.net":"yao.95095.com";if(n){m="yao.95095.daily.etao.net"}o.superclass.constructor.call(t);t.set("_checkedMax",50);t.set("_numDanger",50);var d=r?c:i?m:s;t.set("host:fbuy","http://{hostprefix}fbuy."+d);t.set("host:cart","http://{hostprefix}cart."+s);t.set("host:buy","http://{hostprefix}buy."+s);t.set("host:buyYY","http://{hostprefix}buy."+m);t.set("host:buyHK","http://{hostprefix}buy."+c);t.set("api:num",(a?"http://count.config-vip.taobao.net:8888":"http://count.tbcdn.cn")+"/counter6");t.set("api:list","{fbuy}/cart/mini/trailMiniCart.htm");t.set("api:add","{fbuy}/cart/addCartItems.do");t.set("api:del","{fbuy}/cart/mini/delMini.do");t.set("api:update","{fbuy}/cart/mini/updateMini.do");t.set("api:check","{fbuy}/cart/mini/checkMini.do");t.set("api:sss","http://{hostprefix}cart."+l+"/sss.htm");t.set("api:bag","{fbuy}/auth/buyerRemoveReward.do");t.set("api:bcart","{cart}/cart/myCart.htm");t.set("api:buyTB","http://{hostprefix}buy."+l+"/auction/order/confirm_order.htm");t.set("api:buy","{buy}/order/confirmOrder.htm");t.set("api:buyHK","{buyHK}/order/confirmOrder.htm");t.set("api:buyYY","{buyYY}/order/confirm_order.htm");t.set("api:checkLogin","{buy}/login/buy.do");t.set("api:checkLoginYY","{buyYY}/login/buy.do");t.set("api:checkLoginHK","{buyHK}/login/buy.do");var u=window.TB&&TB.Global&&TB.Global.setCartNum?TB.Global.setCartNum:function(){};t.on("numChange",function(){u(this.get("_counterDown")||this.get("_countMax")?false:this.getNum("total"))})}t.extend(o,a);t.augment(o,i.Target||t.EventTarget,{DATA:{},NUM:{total:0,normal:0,invalid:0,primitive:true},TYPE:{bundle:{child:"main"},main:{parent:"bundle",child:"order"},order:{parent:"main"}},setNum:function(e,a){var r={};var i=false;if(!t.isPlainObject(e)){r[e]=a}else{r=e}var n=this.NUM;t.each(r,function(t,e){if(e in n){if(t!==n[e]){i=true}n[e]=t}});n.total=n.normal+n.invalid;if(n.total>=this.get("_numDanger")){this.set("_countMax",true)}if(n.primitive){i=true;n.primitive=false}if(i){this.fire("numChange")}this.fire("updateNum")},getNum:function(e){var a=this.NUM;if(e){return a[e]}return t.clone(a)},numInit:function(){var e=this;var a=false;var r=function(){if(a){return}a=true;var r=e.get("uid");var i="TCART_234_"+r+"_q";var n=function(a){a=a||{};e.set("__totalCount__",a[i]);var r=t.isNumber(a[i]);if(!r){e.set("_counterDown",true)}e.setNum({normal:r?e.formatNum(a[i]):0,invalid:0});e.fire("numInit")};if(r){e.xhr({api:"num",data:{keys:i},complete:n})}else{n()}};TB.Global.loginStatusReady(function(a){if(a.isLogin){e.set("_isLogin",true);var i=t.later(r,5e3);TB.Global.memberInfoReady(function(t){i.cancel();var a=t.memberInfo;e.set("uid",a.cookies&&a.cookies.unb?a.cookies.unb.value:"");r()})}else{e.set("uid",a.trackId);r()}})},dump:function(){if(window.console){window.console.log(this.getAttrVals());window.console.log(this.NUM);window.console.log(this.DATA)}},getApi:function(e){var a=this;if(-1===e.indexOf(":")){e="api:"+e}var r=a.get(e);if(r){t.each(["fbuy","buy","buyHK","cart","buyYY"],function(t){r=r.replace("{"+t+"}",a.get("host:"+t)||"")});r=r.replace("{hostprefix}",a.get("host:prefix")||"")}return r},record:s,add:function(e){var a=this;var i=0;var s=1;e=a.mixParams(e);o(e.data);l();function o(t){t.add=r.stringify(t.add);var e=a.get("_tb_token_");if(e){t._tb_token_=e}}function l(r){if(r){o(r)}else{r=e.data}a.xhr({api:"add",data:r,success:function(t){a.set("totalSize",t.cartNum);a.setNum({normal:t.cartNum,invalid:0});e.success(t)},error:function(o){if(i>=s){return}if("CsrfCheckFail"===o.errorCode&&o.tk){i++;e.data._tb_token_=o.tk;a.set("_tb_token_",o.tk);return l()}if(!o.errorCode){o.errorCode="SERVER_BUSY";o.error="\u5ba2\u5b98\uff0c\u7f51\u7edc\u62e5\u5835\uff0c\u6dfb\u52a0\u8d2d\u7269\u8f66\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}if(o.errorCode==="BuyerNeedLogin"){var m={check:false};if(r.proxyURL){m.proxyURL=r.proxyURL}c.show(function(){var c=r.getParams;if(o.tk){e.data._tb_token_=o.tk;a.set("_tb_token_",o.tk)}if(t.isFunction(c)){n.when(c(),function(t){i++;return l(t)})}else{i++;return l()}},m)}else{e.error(o)}}})}},xhr:function(a){var r=this;a=t.merge({data:{},type:"get",success:function(){},error:function(){},complete:function(){},wait:function(){},needMerge:false,timeout:5},a);var i=r.getApi(a.api);var n=t.later(function(){a.wait()},360);var c=function(e){n.cancel();a.responseData=e;r.onXhrResponse(a);var i=r.get("uid");if(a.api==="num"&&!i){t.each(e,function(t,e){if(t<0){r.record("tmalljy.2.5?action=tair-error")}})}};var s=a.data;var o=r.get("_tpId");if(o){s.tpId=o}a.data=s;if("get"===a.type){e({url:i,type:"get",scriptCharset:a.scriptCharset||"gbk",data:s,dataType:"jsonp",complete:c,timeout:a.timeout})}else{r.useProxy(function(t){t.post(i,s,c,a.timeout)})}},onXhrResponse:function(e){var a=this;var i=e.responseData;if(!t.isPlainObject(i)){i={success:false}}var n=i.globalData;var c;if(n){c=n.sss;a.set("_isLogin",n.login);if(!a.get("host:prefix")&&n.hostPrefix){a.set("host:prefix",n.hostPrefix+".")}if(n.cartUrl){a.set("api:bcart",n.cartUrl)}}try{c=c||r.parse(i.sss);if(t.isPlainObject(c)&&"quantity"in c){t.getScript(a.getApi("sss")+"?quantity="+c.quantity+"&tk="+c.token+"&"+t.now())}}catch(s){}if(i.success){if(e.needMerge){a.set(n);a.merge(i.list)}if(n&&n.bundRela){a.mergeBundleRelaPromo(n)}e.success(i);if(e.needMerge){a.calculate()}}else{e.error(i)}e.complete(i)},formatNum:function(t){t-=0;return t>0?t:0},read:function(t,e,a){if(!t){return null}var r;e=e.split("/");while(r=e.shift()){if(r in t){t=t[r]}else{return a}}return t},mixParams:function(e,a){return t.merge({success:function(){},error:function(){}},a,e)},useProxy:function(e){var a=this;t.use("mui/minicart/proxy",function(t,r){r.init(a.getApi("host:fbuy")+"/cart/mini/proxy.htm",function(){});if(e){e(r)}})}});return new o},{requires:["ajax","base","json","event","promise","mui/minilogin"]});KISSY.add("mui/minicart/util",function(t,e){var a={};t.mix(a,{toMoney:function(t){if("number"!==typeof t){t=t-0}t=t/100;return isNaN(t)?"":t.toFixed(2)},toWeight:function(t){if("number"!==typeof t){t=t-0}t/=1e3;return t||0},toTxt:function(t){var a=document.createElement("div");a.innerHTML=t;return e.text(a).replace(/\s+/g,"")},showLogin:function(e){t.use("mui/minilogin",function(t,a){a.show(e)})}});return a},{requires:["dom"]});KISSY.add("mui/mallbar/plugin/nav",function(a,e,i,t,r,s,n,o){var l=['<img class="mui-mbarp-nav-logo mui-mbarp-nav-logo-anim" src="{0}" />'].join("");var m="http://gtms01.alicdn.com/tps/i1/T19YwFFbVhXXcGUfcA-70-146.png";var u=[];var c='<img width="35" heigth="30" src="{0}" />';var b=function(a){var e=this;b.superclass.constructor.call(e,a);e.init()};a.extend(b,e,{init:function(){var a=this;var e=a.get(s.K.CONTAINER);var i=a.get(s.K.MALLBAR_ITEM);var t=i.get(s.K.TAB);var r=t.one(".mui-mbar-tab-txt");var o=t.one(".mui-mbar-tab-logo-nav");function l(){e.one(".mui-mbarp-nav-bd").height(e.height())}a.on(s.E.VISIBILITY_CHANGE,function(a){if(a.visible&&a.first){n.getStaticConf({cb:function(a){e.html(n.fm('<iframe src="{0}" class="mui-mbarp-nav-bd" frameborder="0"></iframe>',a.navUrl||s.U.NAV_TMS));l()}})}l()});n.getStaticConf({cb:function(a){a.navTxt&&r.html(a.navTxt);if(a.navTabLogo){o.append(n.fm(c,a.navTabLogo))}a.navBgColor&&t.css("background-color",a.navBgColor)}})}});return b},{requires:["base","node","ua","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-nav.css"]});KISSY.add("mui/mallbar/plugin/my1111",function(a,e,i,t,r,s,n,o){var l=function(a){var e=a.split("-");return new Date(e[0],parseInt(e[1],10)-1,e[2])};var m={};a.each(location.search.substr(1).split("&"),function(a){var e=a.split("=");m[e[0]]=e[1]});var u=m["__debug_my1111_mode__"];u=u?u.split(""):[];var c=u[0]=="a";var b=u[0]=="b";var d;var p;p="http://gtms04.alicdn.com/tps/i4/TB195e2GpXXXXaTXFXXj64lTXXX-200-200.jpg";var f="mallbar_my1111";var v="http://www.tmall.com/go/market/brand/my_db_eleven.php";var h="http://www.tmall.com/go/market/brand/other_db_eleven.php?userId=";var g={my1111:v,daiyan:"",main:"http://1111.tmall.com",tonghao:v+"#same",other1111:h,worth:"http://www.tmall.com/go/market/brand/worth.php"};var _={daiyan:"http://latour.tmall.com/avatar/getUsersInfo.do?num=0",brand:"http://brand.tmall.com/ajax/mybrands/findBrand20141111.ajsonp",worth2buy:"http://ald.taobao.com/recommend.htm",tonghao_user:"http://ald.taobao.com/recommend.htm?appId=911123",tonghao_goods:"http://ald.taobao.com/recommend.htm?appId=03501"};var T={wrap_a:'<div class="my1111-wrap">'+'<div data-spm="201411110101" class="daiyan-wrap"></div>'+'<div data-spm="201411110105" class="brand-follow-wrap"></div>'+'<div data-spm="201411110106" class="brand-find-wrap"></div>'+"</div>",wrap_b:'<div class="my1111-wrap">'+'<div data-spm="201411110101" class="daiyan-wrap"></div>'+'<div data-spm="201411110102" class="tonghao-user-wrap"></div>'+'<div data-spm="201411110103" class="tonghao-goods-wrap"></div>'+'<div data-spm="201411110104" class="worth2buy-wrap"></div>'+'<div data-spm="201411110105" class="brand-follow-wrap"></div>'+'<div data-spm="201411110106" class="brand-find-wrap"></div>'+"</div>",daiyan_not:'<div class="daiyan-not">'+"<h4>\u53cc11\u5168\u6c11\u4ee3\u8a00</h4>"+'<div class="bd">'+"<h3>\u4ee3\u8a00\u9080\u8bf7\u51fd</h3>"+'<p class="nick">Hi,{{nick}}!</p>'+"<p>\u4f60\u957f\u5f97\u8fd9\u4e48\u8d5e\uff0c\u4e0d\u6765\u505a\u4ee3\u8a00\u4eba\u53ef\u60dc\u4e86\u5462\uff0c\u53c2\u52a0\u5c31\u6709\u673a\u4f1a\u8d62</p>"+'<a href="http://vip.tmall.com/privilege/vipfirst" class="gift {{#if (level3)}}g-level3{{/if}}">\u5929\u732b\u4f1a\u5458\u4f18\u5148\u8d2d\u4e70\u5238<span>?</span></a>'+'{{#if (level3)}}<p class="t-level3">11.1-7\u65e5\u72c2\u6b22\u57ce\u6697\u53f7\u7ea2\u5305</p>{{/if}}'+"</div>"+'<a href="{{urlDaiyan}}" class="btn">\u6211\u8981\u4ee3\u8a00</a>'+"</div>",daiyan_yes:'<div class="">'+'{{#if benefit}}<a href="http://vip.tmall.com/privilege/all" class="my-gift"><span><em>\u6211\u7684\u4ee3\u8a00\u793c</em></span></a>{{/if}}'+'<div class="daiyan-yes">'+"<h2>\u6211\u662f{{nick}}</h2>"+'<p class="declare"><span>\u6211{{#if (daiyan)}}\u4e3a{{else}}\u7684{{/if}}</span><b></b><span>{{#if (daiyan)}}\u4ee3\u8a00{{else}}\u6765\u4e86{{/if}}</span></p>'+'<div class="avatar">'+"{{#if (isStepB)}}"+'<a href="{{url_my1111}}">'+"{{/if}}"+"{{#if (daiyan)}}"+'<div class="photo">'+'<img src="{{avatar}}">'+'<span class="cat"></span>'+"</div>"+"{{else}}"+'<div class="photo-not">'+'<img src="{{avatar}}">'+"</div>"+"{{/if}}"+"{{#if (isStepB)}}"+"</a>"+"{{/if}}"+"{{#if (avatarFail)}}"+'<div class="avatar-fail">'+"<i></i>"+"<p>\u60a8\u7684\u5934\u50cf\u8fdd\u53cd\u4e86\u4ee3\u8a00\u534f\u8bae</p>"+'<a href="{{urlReupload}}" class="reupload">\u91cd\u65b0\u4e0a\u4f20</a>'+"</div>"+"{{/if}}"+"</div>"+"{{#if (isStepB)}}"+'<a href="{{url_my1111}}" class="link">'+'<span class="entry">\u8fdb\u5165\u6211\u7684\u53cc\u5341\u4e00</span>'+"</a>"+"{{/if}}"+"</div>"+"</div>",tonghao_user:'<div class="tonghao-user">'+"<h3>\u6211\u7684\u540c\u597d<span>\u6211\u4eec<em>\u8d2d\u7269\u559c\u597d\u5f88\u76f8\u4f3c\u54e6~</em></span></h3>"+'<div class="users mui-mbarp-clearfix">'+"{{#each users}}"+'<div class="user {{#if (xindex%2)}}u-even{{else}}u-odd{{/if}} {{#if (this.isLastline)}}u-lastline{{/if}}">'+'<a href="{{this.url_my1111}}" class="link">'+"{{#if this.score>=30}}"+'<i class="score">{{#if (xindex===0)}}<span>\u76f8\u4f3c\u5ea6</span>{{/if}}{{this.score}}</i>'+"{{/if}}"+'<div class="img">'+'<img src="http://wwc.taobaocdn.com/avatar/getAvatar.do?userId={{this.id}}&width=60&height=60&type=sns">'+"</div>"+'<p class="tag">{{this.tag}}</p>'+"</a>"+"</div>"+"{{/each}}"+"</div>"+"</div>",tonghao_goods:'<div class="tonghao-goods">'+'<i class="arrow"></i>'+"<h4>\u540c\u597d\u6b63\u5728\u4e70</h4>"+'<div class="shops mui-mbarp-clearfix">'+"{{#each goods}}"+'<a class="good" href="{{this.itemUrl}}">'+'<img src="{{this.pictUrl}}_100x100.jpg">'+"<p>\uffe5{{this.promotionPrice}}</p>"+"</a>"+"{{/each}}"+"</div>"+'<a class="more" href="{{url_tonghao}}"><span>\u67e5\u770b\u5168\u90e8</span></a>'+"</div>",worth2buy:'<div class="worth2buy">'+"<h3><span>\u503c\u5f97\u4e70~</span></h3>"+'<ul class="mui-mbarp-clearfix">'+"{{#each items}}"+'<li class="{{#if xindex%2}}item-even{{else}}item-odd{{/if}}">'+'<a href="{{this.url}}">'+'<img src="{{this.pictUrl}}_100x100.jpg">'+"<span>\uffe5{{this.promotionPrice}}</span>"+"</a>"+"</li>"+"{{/each}}"+"</ul>"+'<a class="more" href="{{url_worth}}"><span>\u67e5\u770b\u5168\u90e8</span></a>'+"</div>",followBrand:'<div class="brand-follow">'+"<h3>\u6211\u5173\u6ce8\u7684\u54c1\u724c</h3>"+'<div class="brands mui-mbarp-clearfix">'+"{{#each favBrands}}"+'<div class="brand">'+'<a href="{{this.brandUrl}}">'+'<img src="{{this.logo}}">'+"</a>"+"</div>"+"{{/each}}"+"</div>"+'<a class="more" href="http://mybrand.tmall.com/brandFeedList.html"><span>\u67e5\u770b\u5168\u90e8</span></a>'+"</div>"};var A={tonghao_user:function(a){var e=['<div class="tonghao-user">',"<h3>\u6211\u7684\u540c\u597d<span>\u6211\u4eec<em>\u8d2d\u7269\u559c\u597d\u5f88\u76f8\u4f3c\u54e6~</em></span></h3>",'<div class="users mui-mbarp-clearfix">'];var a=a||[];for(var i=0,t=a.length;i<t;i++){var r=a[i],s="",n="u-odd";if(i%2!==0){n="u-even"}if(r.isLastline){n+=" u-lastline"}if(r.score>=30){if(i===0){s='<i class="score"><span>\u76f8\u4f3c\u5ea6</span>'+r.score+"%</i>"}else{s='<i class="score">'+r.score+"%</i>"}}e.push('<div class="user '+n+'">');e.push('<a href="'+r.url_my1111+'" class="link">');e.push(s);e.push('<div class="img">');e.push('<img src="'+r.picUrl+'">');e.push("</div>");e.push('<p class="tag">'+r.nickname+"</p>");e.push("</a>");e.push("</div>")}e.push("</div>");e.push("</div>");return e.join("")},tonghao_goods:function(a){var e=['<div class="tonghao-goods">','<i class="arrow"></i>',"<h4>\u540c\u597d\u6b63\u5728\u4e70</h4>",'<div class="shops mui-mbarp-clearfix">'];var i=a.goods||[];for(var t=0,r=i.length;t<r;t++){var s=i[t];e.push('<a class="good" href="'+s.itemUrl+'">');e.push('<img src="'+s.pictUrl+'_100x100.jpg"/>');e.push("<p>\uffe5"+s.promotionPrice+"</p>");e.push("</a>")}e.push("</div>");e.push('<a class="more" href="'+a.url_tonghao+'"><span>\u67e5\u770b\u5168\u90e8</span></a>');e.push("</div>");return e.join("")},worth2buy:function(a){var e=['<div class="worth2buy">',"<h3><span>\u503c\u5f97\u4e70~</span></h3>",'<ul class="mui-mbarp-clearfix">'];var i=a.items||[];for(var t=0,r=i.length;t<r;t++){var s=i[t],n="item-odd";if(t%2!==0){n="item-even"}e.push('<li class="'+n+'">');e.push('<a href="'+s.url+'">');e.push('<img src="'+s.pictUrl+'_100x100.jpg"/>');e.push("<span>\uffe5"+s.promotionPrice+"</span>");e.push("</li>")}e.push("</ul>");e.push('<a class="more" href="'+a.url_worth+'"><span>\u67e5\u770b\u5168\u90e8</span></a>');e.push("</div>");return e.join("")},followBrand:function(a){var e='<div class="brand-follow">'+"<h3>\u6211\u5173\u6ce8\u7684\u54c1\u724c</h3>"+'<div class="brands mui-mbarp-clearfix">';for(var i=0,t=a.length;i<t;i++){var r=a[i];e+='<div class="brand">'+'<a href="'+r.brandUrl+'">'+'<img src="'+r.logo+'">'+"</a>"+"</div>"}e+="</div>"+'<a class="more" href="http://mybrand.tmall.com/brandFeedList.html"><span>\u67e5\u770b\u5168\u90e8</span></a>'+"</div>";return e},findBrand:function(a){var e='<div class="brand-find">'+"<h3>\u53d1\u73b0\u54c1\u724c</h3>"+'<i class="point"></i>'+'<i class="point"></i>'+'<i class="stick-radius"></i>'+'<div class="brands">';for(var i=0,t=a.length;i<t;i++){var r=a[i];if(r.subjectLogo){e+='<div class="brand">'+'<a href="'+r.brandUrl+'">'+'<img class="img-subject" src="'+r.subjectLogo+'_200x200.jpg">'+"</a>"+'<p class="place"></p>'+'<div class="logo">'+'<a class="a-logo" href="'+r.brandUrl+'">'+'<img class="img-logo" src="'+r.logo+'">'+"</a>"+"</div>"+"</div>"+'<i class="stick"></i>'}}e+="</div>"+'<i class="stick-radius stick-btm"></i>'+'<i class="point point-btm"></i>'+'<i class="point point-btm"></i>'+'<a class="more" href="http://mybrand.tmall.com/findBrand.html">\u67e5\u770b\u5168\u90e8</a>'+"</div>";return e}};var I=function(a){var e=this;I.superclass.constructor.call(e,a);e.init()};a.extend(I,e,{init:function(){var e=this;var s=e.get(t.K.CONTAINER);var n=e.mallbarItem=e.get(t.K.MALLBAR_ITEM);var o=n.get(t.K.MALLBAR);var I=5;function C(){I-=1;if(I===0){n.fire(t.E.ERROR)}}var E={};var B=e.get(t.K.MALLBAR_ITEM).getServerTime()-0;function L(e){r.getStaticConf({cb:function(i){var t=i.my1111;var r=l(t.b)-0;var n=l(m["__debug_c__"]||t.c)-0;if(n<=B){v="http://www.tmall.com/go/market/brand/my_1111.php";h="http://www.tmall.com/go/market/brand/other_1111.php?userId=";g.my1111=v;g.tonghao=v+"#same";g.other1111=h}d=c?true:b?false:B>=r?false:true;s.html(d?T.wrap_a:T.wrap_b);E.daiyan=a.one(".daiyan-wrap",s);E.tonghao_user=a.one(".tonghao-user-wrap",s);E.tonghao_goods=a.one(".tonghao-goods-wrap",s);E.worth2buy=a.one(".worth2buy-wrap",s);E.brand_follow=a.one(".brand-follow-wrap",s);E.brand_find=a.one(".brand-find-wrap",s);e&&e(i,d)}})}var w=true;e.on(t.E.VISIBILITY_CHANGE,function(e){if(!e.visible||!e.first){return}if(e.visible&&w){n.fire(t.E.SUPTIP_CHANGE,{show:false});L(function(e,s){var n=o.get("model").get("userinfo");var l=n.nick;E.daiyan&&r.ajax({url:_.daiyan,success:function(a){if(a&&a.success){a=a.data[0];a.status=u[1]||a.status;var e;if(a.status==0&&s){var t=new i(T.daiyan_not);e=t.render({nick:l,tmallLevel:a.tmallLevel,level3:a.tmallLevel==3,urlDaiyan:g.main+"#daiyan"})}else if(a.status==1||a.status==2||a.status==0){var t=new i(T.daiyan_yes);var r=a.status==1?a.avatar||"http://wwc.taobaocdn.com/avatar/getAvatar.do?userId="+a.userId+"&width=60&height=60&type=sns":p;a.benefit=parseInt(u[2])||a.benefit;var n=a.status!=0;e=t.render({nick:l,avatar:r,url_my1111:g.my1111,avatarFail:a.status==2,daiyan:n,benefit:n&&a.benefit,isStepB:!s,urlReupload:s?g.main+"#daiyan":g.my1111+"?p=1"})}E.daiyan.html(e)}else{C()}},error:function(){C();r.codeTracker.sendTrack(t.T.NUMLEV,"my1111.mallbar.daiyan.get.failure","\u4ee3\u8a00\u63a5\u53e3\u5931\u8d25")}});E.tonghao_user&&r.ajax({url:_.tonghao_user,success:function(a){if(a&&a.data&&a.data.length){a.data=a.data.splice(0,4);var e=[];var i=0,t=a.data.length;var s=t%2?t-1:t-2;for(;i<t;i++){var n;if(n=a.data[i]){n.url_my1111=g.other1111+n.id;n.isLastline=i>=s;e.push(n)}}var o;o=A.tonghao_user(e);E.tonghao_user.html(o);!!a.exposureParam&&r.sendLog(a.exposureParam)}else{C()}},error:function(){C();r.codeTracker.sendTrack(t.T.NUMLEV,"my1111.mallbar.tonghao.user.get.failure","\u540c\u597d\u7528\u6237\u63a5\u53e3\u5931\u8d25")}});E.tonghao_goods&&r.ajax({url:_.tonghao_goods,success:function(a){if(a&&a.data&&a.data.length){var e;e=A.tonghao_goods({goods:a.data.splice(0,4),url_tonghao:g.tonghao});E.tonghao_goods.html(e);!!a.exposureParam&&r.sendLog(a.exposureParam)}else{C()}},error:function(){C();r.codeTracker.sendTrack(t.T.NUMLEV,"my1111.mallbar.tonghao.goods.get.failure","\u540c\u597d\u5546\u54c1\u63a5\u53e3\u5931\u8d25")}});E.worth2buy&&r.ajax({url:_.worth2buy,data:{appId:"03352",needCount:2},success:function(e){if(e&&e.itemList&&e.itemList.length){a.each(e.itemList,function(a){a.url=g.worth+"?from="+f+"&invalidItems="+a.invalidItems+"&scm="+a.scm+"&acm="+a.acm});var i;i=A.worth2buy({items:e.itemList,url_worth:e.itemList[0].url});E.worth2buy.html(i);!!e.exposureParam&&r.sendLog(e.exposureParam)}else{C()}},error:function(){C();r.codeTracker.sendTrack(t.T.NUMLEV,"my1111.mallbar.worth2buy.get.failure","\u503c\u5f97\u4e70\u63a5\u53e3\u5931\u8d25")}});E.brand_find&&E.brand_follow&&r.ajax({url:_.brand,data:{fav_brand_num:10,rec_brand_num:10},success:function(a){if(a&&a.success){var e,i,t,s;var n=a.favBrands||[];var o=[];for(var l=0,m=n.length;l<m;l++){var u=n[l];if(u.logo){o.push(u)}}if(o.length){t=A.followBrand(o);E.brand_follow.html(t)}var c;var b=a.recBrands||[];var d=[];for(var l=0,m=b.length;l<m;l++){var u=b[l];if(!c&&u.subjectLogo){c=true}if(u.logo){d.push(u)}}if(c&&d.length){e=A.findBrand(d);E.brand_find.html(e)}!!a.favBrandExposureParam&&r.sendLog(a.favBrandExposureParam);!!a.recBrandExposureParam&&r.sendLog(a.recBrandExposureParam)}else{C()}},error:function(){C();r.codeTracker.sendTrack(t.T.NUMLEV,"my1111.mallbar.brand.get.failure","\u54c1\u724c\u63a5\u53e3\u5931\u8d25")}})})}});e.on(t.E.DATA_CHANGE,function(a){w=true;if(n.get(t.K.EXPAND)){L()}})}});return I},{requires:["base","xtemplate","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-my1111.css","cookie"]});